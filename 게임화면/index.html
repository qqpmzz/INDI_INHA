<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lost Spells - ë„¤ë¹„ê²Œì´ì…˜</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
            color: white;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .nav-container {
            text-align: center;
            background: linear-gradient(135deg, rgba(26, 26, 46, 0.95), rgba(22, 33, 62, 0.95));
            border: 2px solid rgba(79, 195, 247, 0.4);
            border-radius: 20px;
            padding: 50px;
            backdrop-filter: blur(20px);
            box-shadow: 0 10px 50px rgba(79, 195, 247, 0.3);
            max-width: 600px;
            width: 90vw;
        }

        .nav-title {
            font-size: 3rem;
            margin-bottom: 20px;
            color: #4fc3f7;
            text-shadow: 0 0 20px rgba(79, 195, 247, 0.5);
        }

        .nav-subtitle {
            font-size: 1.2rem;
            margin-bottom: 40px;
            color: rgba(255, 255, 255, 0.8);
        }

        .nav-buttons {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .nav-btn {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 20px 30px;
            background: linear-gradient(135deg, rgba(138, 43, 226, 0.2), rgba(106, 27, 154, 0.2));
            border: 2px solid rgba(138, 43, 226, 0.4);
            border-radius: 15px;
            color: #e1bee7;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .nav-btn:hover {
            background: linear-gradient(135deg, rgba(138, 43, 226, 0.3), rgba(106, 27, 154, 0.3));
            border-color: rgba(138, 43, 226, 0.6);
            box-shadow: 0 0 25px rgba(138, 43, 226, 0.4);
            transform: translateY(-2px);
        }

        .btn-icon {
            font-size: 2rem;
            min-width: 40px;
        }

        .btn-content {
            flex: 1;
            text-align: left;
        }

        .btn-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .btn-desc {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .btn-key {
            background: rgba(79, 195, 247, 0.2);
            padding: 5px 10px;
            border-radius: 8px;
            font-size: 0.9rem;
            color: #4fc3f7;
            border: 1px solid rgba(79, 195, 247, 0.4);
        }

        .nav-info {
            margin-top: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .nav-info h3 {
            color: #4fc3f7;
            margin-bottom: 10px;
        }

        .nav-info p {
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.5;
        }
    </style>
</head>

<body>
    <script>
        // ìë™ìœ¼ë¡œ ê¸°ë³¸ê²Œì„í™”ë©´ìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
        window.location.href = 'ê¸°ë³¸ê²Œì„í™”ë©´/index.html';
    </script>
    <div class="nav-container">
        <div class="nav-title">ğŸ® Lost Spells</div>
        <div class="nav-subtitle">UI ë„¤ë¹„ê²Œì´ì…˜ - ì›í•˜ëŠ” í™”ë©´ì„ ì„ íƒí•˜ì„¸ìš”</div>

        <div class="nav-buttons">
            <a href="ê¸°ë³¸ê²Œì„í™”ë©´/index.html" class="nav-btn">
                <div class="btn-icon">ğŸ®</div>
                <div class="btn-content">
                    <div class="btn-title">ê¸°ë³¸ ê²Œì„í™”ë©´</div>
                    <div class="btn-desc">ë©”ì¸ ê²Œì„ UI, HP/MP ë°”, ìŠ¤í‚¬ ìŠ¬ë¡¯</div>
                </div>
                <div class="btn-key">ì‹œì‘ì </div>
            </a>

            <a href="ìŒì„±ì¸ì‹í™”ë©´/index.html" class="nav-btn">
                <div class="btn-icon">ğŸ¤</div>
                <div class="btn-content">
                    <div class="btn-title">ìŒì„±ì¸ì‹ í™”ë©´</div>
                    <div class="btn-desc">2ë‹¨ê³„ ìë™ ìŒì„±ì¸ì‹ ì‹œìŠ¤í…œ</div>
                </div>
                <div class="btn-key">Space</div>
            </a>

            <a href="ìŠ¤í‚¬ë¶í™”ë©´/index.html" class="nav-btn">
                <div class="btn-icon">âœ¨</div>
                <div class="btn-content">
                    <div class="btn-title">ìŠ¤í‚¬ë¶ í™”ë©´</div>
                    <div class="btn-desc">ìŠ¤í‚¬ ì¹´ë“œ ë¸Œë¼ìš°ì§•, ì¹´í…Œê³ ë¦¬ í•„í„°ë§</div>
                </div>
                <div class="btn-key">Shift</div>
            </a>

            <a href="ë£¬ì—…ê·¸ë ˆì´ë“œí™”ë©´/index.html" class="nav-btn">
                <div class="btn-icon">ğŸ”®</div>
                <div class="btn-content">
                    <div class="btn-title">ë£¬ ì—…ê·¸ë ˆì´ë“œ í™”ë©´</div>
                    <div class="btn-desc">ë£¬ì„ìœ¼ë¡œ ìŠ¤í‚¬ ê°•í™” ë° í•´ê¸ˆ</div>
                </div>
                <div class="btn-key">R</div>
            </a>
        </div>

        <div class="nav-info">
            <h3>ğŸ“ ì‚¬ìš©ë²•</h3>
            <p>
                ê° í™”ë©´ì€ ë…ë¦½ì ìœ¼ë¡œ ì‘ë™í•©ë‹ˆë‹¤. ëª¨ë“  í™”ë©´ì—ì„œ "â† ê²Œì„ìœ¼ë¡œ ëŒì•„ê°€ê¸°" ë²„íŠ¼ìœ¼ë¡œ
                ê¸°ë³¸ ê²Œì„í™”ë©´ìœ¼ë¡œ ëŒì•„ê°ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê¸°ë³¸ ê²Œì„í™”ë©´ì—ì„œ í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ë¡œ
                ë‹¤ë¥¸ í™”ë©´ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            </p>
        </div>
    </div>

</html>
<div class="skill-card unlocked" data-category="attack">
    <div class="skill-card-icon">ğŸ”¥</div>
    <div class="skill-card-name">Fireball</div>
    <div class="skill-card-level">Lv.3</div>
    <div class="skill-card-pronunciation">ğŸ”Š "íŒŒì´ì–´ë³¼"</div>
    <div class="skill-card-desc">í™”ì—¼ êµ¬ì²´ë¥¼ ë°œì‚¬í•˜ì—¬ ì ì„ ê³µê²©í•©ë‹ˆë‹¤</div>
    <div class="skill-card-stats">
        <div class="stat">ê³µê²©ë ¥: <span class="stat-damage">120</span></div>
        <div class="stat">ë§ˆë‚˜: <span class="stat-mana">25</span></div>
    </div>
</div>

<div class="skill-card unlocked" data-category="attack">
    <div class="skill-card-icon">â„ï¸</div>
    <div class="skill-card-name">Ice Bolt</div>
    <div class="skill-card-level">Lv.2</div>
    <div class="skill-card-pronunciation">ğŸ”Š "ì•„ì´ìŠ¤ ë³¼íŠ¸"</div>
    <div class="skill-card-desc">ì–¼ìŒ í™”ì‚´ì„ ë°œì‚¬í•˜ì—¬ ì ì„ ë§ˆë¹„ì‹œí‚µë‹ˆë‹¤</div>
    <div class="skill-card-stats">
        <div class="stat">ê³µê²©ë ¥: <span class="stat-damage">100</span></div>
        <div class="stat">ë§ˆë‚˜: <span class="stat-mana">20</span></div>
    </div>
</div>

<div class="skill-card unlocked" data-category="attack">
    <div class="skill-card-icon">âš¡</div>
    <div class="skill-card-name">Lightning Bolt</div>
    <div class="skill-card-level">Lv.2</div>
    <div class="skill-card-pronunciation">ğŸ”Š "ë¼ì´íŠ¸ë‹ ë³¼íŠ¸"</div>
    <div class="skill-card-desc">ë²ˆê°œë¥¼ ë°œì‚¬í•˜ì—¬ ì ì„ ê°ì „ì‹œí‚µë‹ˆë‹¤</div>
    <div class="skill-card-stats">
        <div class="stat">ê³µê²©ë ¥: <span class="stat-damage">140</span></div>
        <div class="stat">ë§ˆë‚˜: <span class="stat-mana">30</span></div>
    </div>
</div>

<div class="skill-card locked" data-category="attack">
    <div class="skill-card-icon">ğŸ”’</div>
    <div class="skill-card-name">Meteor</div>
    <div class="skill-card-level">ì ê¹€</div>
    <div class="skill-card-pronunciation">ğŸ”Š "ë©”í…Œì˜¤"</div>
    <div class="skill-card-desc">ë ˆë²¨ 15 ë‹¬ì„± ì‹œ í•´ì œë©ë‹ˆë‹¤</div>
    <div class="skill-card-stats">
        <div class="stat">ê³µê²©ë ¥: <span class="stat-damage">300</span></div>
        <div class="stat">ë§ˆë‚˜: <span class="stat-mana">60</span></div>
    </div>
</div>

<!-- ë°©ì–´ ìŠ¤í‚¬ -->
<div class="skill-card unlocked" data-category="defense">
    <div class="skill-card-icon">ğŸ›¡ï¸</div>
    <div class="skill-card-name">Magic Shield</div>
    <div class="skill-card-level">Lv.2</div>
    <div class="skill-card-pronunciation">ğŸ”Š "ë§¤ì§ ì‹¤ë“œ"</div>
    <div class="skill-card-desc">ë§ˆë²• ë°©ì–´ë§‰ì„ ìƒì„±í•©ë‹ˆë‹¤</div>
    <div class="skill-card-stats">
        <div class="stat">ë°©ì–´ë ¥: <span class="stat-defense">+50</span></div>
        <div class="stat">ë§ˆë‚˜: <span class="stat-mana">20</span></div>
    </div>
</div>

<div class="skill-card unlocked" data-category="defense">
    <div class="skill-card-icon">âœ¨</div>
    <div class="skill-card-name">Barrier</div>
    <div class="skill-card-level">Lv.1</div>
    <div class="skill-card-pronunciation">ğŸ”Š "ë°°ë¦¬ì–´"</div>
    <div class="skill-card-desc">ë¬¼ë¦¬ ê³µê²©ì„ ë§‰ëŠ” ë³´í˜¸ë§‰ì„ ìƒì„±í•©ë‹ˆë‹¤</div>
    <div class="skill-card-stats">
        <div class="stat">ë°©ì–´ë ¥: <span class="stat-defense">+30</span></div>
        <div class="stat">ë§ˆë‚˜: <span class="stat-mana">15</span></div>
    </div>
</div>

<div class="skill-card locked" data-category="defense">
    <div class="skill-card-icon">ğŸ”’</div>
    <div class="skill-card-name">Fortress</div>
    <div class="skill-card-level">ì ê¹€</div>
    <div class="skill-card-pronunciation">ğŸ”Š "í¬íŠ¸ë¦¬ìŠ¤"</div>
    <div class="skill-card-desc">ë°©ì–´ ë ˆë²¨ 10 ë‹¬ì„± ì‹œ í•´ì œ</div>
    <div class="skill-card-stats">
        <div class="stat">ë°©ì–´ë ¥: <span class="stat-defense">+100</span></div>
        <div class="stat">ë§ˆë‚˜: <span class="stat-mana">40</span></div>
    </div>
</div>

<!-- ì¹˜ìœ  ìŠ¤í‚¬ -->
<div class="skill-card unlocked" data-category="healing">
    <div class="skill-card-icon">ğŸ’š</div>
    <div class="skill-card-name">Heal</div>
    <div class="skill-card-level">Lv.3</div>
    <div class="skill-card-pronunciation">ğŸ”Š "í"</div>
    <div class="skill-card-desc">ì²´ë ¥ì„ ì¦‰ì‹œ íšŒë³µí•©ë‹ˆë‹¤</div>
    <div class="skill-card-stats">
        <div class="stat">íšŒë³µëŸ‰: <span class="stat-healing">80</span></div>
        <div class="stat">ë§ˆë‚˜: <span class="stat-mana">15</span></div>
    </div>
</div>

<div class="skill-card unlocked" data-category="healing">
    <div class="skill-card-icon">ğŸ’™</div>
    <div class="skill-card-name">Mana Recovery</div>
    <div class="skill-card-level">Lv.2</div>
    <div class="skill-card-pronunciation">ğŸ”Š "ë§ˆë‚˜ ë¦¬ì»¤ë²„ë¦¬"</div>
    <div class="skill-card-desc">ë§ˆë‚˜ë¥¼ íšŒë³µí•©ë‹ˆë‹¤</div>
    <div class="skill-card-stats">
        <div class="stat">ë§ˆë‚˜ íšŒë³µ: <span class="stat-healing">+40</span></div>
        <div class="stat">ì†Œëª¨: <span class="stat-mana">10</span></div>
    </div>
</div>

<div class="skill-card locked" data-category="healing">
    <div class="skill-card-icon">ğŸ”’</div>
    <div class="skill-card-name">Resurrection</div>
    <div class="skill-card-level">ì ê¹€</div>
    <div class="skill-card-pronunciation">ğŸ”Š "ë ˆì €ë ‰ì…˜"</div>
    <div class="skill-card-desc">ì¹˜ìœ  ë§ˆìŠ¤í„°ë¦¬ ë‹¬ì„± ì‹œ í•´ì œ</div>
    <div class="skill-card-stats">
        <div class="stat">íš¨ê³¼: <span class="stat-special">ì™„ì „ íšŒë³µ</span></div>
        <div class="stat">ë§ˆë‚˜: <span class="stat-mana">100</span></div>
    </div>
</div>
</div>
</div>
</div>
</div>

<!-- ë£¬ì—…ê·¸ë ˆì´ë“œ ì˜¤ë²„ë ˆì´ -->
<div class="rune-overlay" id="runeOverlay">
    <div class="rune-container">
        <div class="rune-header">
            <div class="rune-title">
                <span class="rune-icon">ï¿½</span>
                <h2>ë£¬ ì—…ê·¸ë ˆì´ë“œ</h2>
            </div>
            <div class="rune-currency">
                <span class="rune-stone-icon">ğŸ”®</span>
                <span class="rune-count" id="runeCount">12</span>
                <span class="rune-text">ë£¬ì„</span>
            </div>
            <button class="rune-close" id="runeClose">âœ•</button>
        </div>

        <div class="rune-content">
            <div class="rune-description">
                <p>ì›¨ì´ë¸Œ í´ë¦¬ì–´ ë³´ìƒìœ¼ë¡œ ë£¬ì„ì„ íšë“í–ˆìŠµë‹ˆë‹¤!</p>
                <p>ìŠ¤í‚¬ì„ ê°•í™”í•˜ê±°ë‚˜ ìƒˆë¡œìš´ ìŠ¤í‚¬ì„ í•´ì œí•˜ì„¸ìš”.</p>
            </div>

            <!-- ë£¸ì—…ê·¸ë ˆì´ë“œ ìŠ¤í‚¬ ë¦¬ìŠ¤íŠ¸ -->
            <div class="rune-skills" id="runeSkills">
                <!-- í•´ì œëœ ìŠ¤í‚¬ë“¤ -->
                <div class="skill-upgrade-card" data-skill="fireball" data-category="unlocked">
                    <div class="skill-header">
                        <div class="skill-info">
                            <span class="skill-icon">ğŸ”¥</span>
                            <div class="skill-details">
                                <div class="skill-name">Fireball</div>
                                <div class="skill-level">Lv.<span id="fireball-level">3</span></div>
                            </div>
                        </div>
                        <div class="skill-enhancement">
                            <div class="enhancement-count">ê°•í™” <span id="fireball-enhancement">2</span>íšŒ</div>
                        </div>
                    </div>
                    <div class="skill-stats">
                        <div class="current-stats">
                            <span>ê³µê²©ë ¥: <span class="stat-value" id="fireball-damage">120</span></span>
                            <span>ë§ˆë‚˜: <span class="stat-value">25</span></span>
                        </div>
                    </div>
                    <div class="skill-upgrade-controls">
                        <button class="upgrade-btn minus-btn" data-action="decrease" data-skill="fireball">-</button>
                        <div class="upgrade-info">
                            <span class="upgrade-amount" id="fireball-upgrade-amount">0</span>
                            <span class="upgrade-cost">
                                ğŸ”® <span id="fireball-total-cost">0</span>
                            </span>
                        </div>
                        <button class="upgrade-btn plus-btn" data-action="increase" data-skill="fireball">+</button>
                    </div>
                    <div class="next-stats" id="fireball-next-stats" style="display: none;">
                        â†’ ê³µê²©ë ¥: <span class="next-value" id="fireball-next-damage">120</span>
                    </div>
                </div>

                <div class="skill-upgrade-card" data-skill="ice-bolt" data-category="unlocked">
                    <div class="skill-header">
                        <div class="skill-info">
                            <span class="skill-icon">â„ï¸</span>
                            <div class="skill-details">
                                <div class="skill-name">Ice Bolt</div>
                                <div class="skill-level">Lv.<span id="ice-bolt-level">2</span></div>
                            </div>
                        </div>
                        <div class="skill-enhancement">
                            <div class="enhancement-count">ê°•í™” <span id="ice-bolt-enhancement">1</span>íšŒ</div>
                        </div>
                    </div>
                    <div class="skill-stats">
                        <div class="current-stats">
                            <span>ê³µê²©ë ¥: <span class="stat-value" id="ice-bolt-damage">100</span></span>
                            <span>ë§ˆë‚˜: <span class="stat-value">20</span></span>
                        </div>
                    </div>
                    <div class="skill-upgrade-controls">
                        <button class="upgrade-btn minus-btn" data-action="decrease" data-skill="ice-bolt">-</button>
                        <div class="upgrade-info">
                            <span class="upgrade-amount" id="ice-bolt-upgrade-amount">0</span>
                            <span class="upgrade-cost">
                                ğŸ”® <span id="ice-bolt-total-cost">0</span>
                            </span>
                        </div>
                        <button class="upgrade-btn plus-btn" data-action="increase" data-skill="ice-bolt">+</button>
                    </div>
                    <div class="next-stats" id="ice-bolt-next-stats" style="display: none;">
                        â†’ ê³µê²©ë ¥: <span class="next-value" id="ice-bolt-next-damage">100</span>
                    </div>
                </div>

                <div class="skill-upgrade-card" data-skill="heal" data-category="unlocked">
                    <div class="skill-header">
                        <div class="skill-info">
                            <span class="skill-icon">ğŸ’š</span>
                            <div class="skill-details">
                                <div class="skill-name">Heal</div>
                                <div class="skill-level">Lv.<span id="heal-level">3</span></div>
                            </div>
                        </div>
                        <div class="skill-enhancement">
                            <div class="enhancement-count">ê°•í™” <span id="heal-enhancement">0</span>íšŒ</div>
                        </div>
                    </div>
                    <div class="skill-stats">
                        <div class="current-stats">
                            <span>íšŒë³µëŸ‰: <span class="stat-value" id="heal-amount">80</span></span>
                            <span>ë§ˆë‚˜: <span class="stat-value">15</span></span>
                        </div>
                    </div>
                    <div class="skill-upgrade-controls">
                        <button class="upgrade-btn minus-btn" data-action="decrease" data-skill="heal">-</button>
                        <div class="upgrade-info">
                            <span class="upgrade-amount" id="heal-upgrade-amount">0</span>
                            <span class="upgrade-cost">
                                ğŸ”® <span id="heal-total-cost">0</span>
                            </span>
                        </div>
                        <button class="upgrade-btn plus-btn" data-action="increase" data-skill="heal">+</button>
                    </div>
                    <div class="next-stats" id="heal-next-stats" style="display: none;">
                        â†’ íšŒë³µëŸ‰: <span class="next-value" id="heal-next-amount">80</span>
                    </div>
                </div>

                <!-- ì ê¸´ ìŠ¤í‚¬ë“¤ -->
                <div class="skill-upgrade-card locked" data-skill="meteor" data-category="locked">
                    <div class="skill-header">
                        <div class="skill-info">
                            <span class="skill-icon">ï¿½</span>
                            <div class="skill-details">
                                <div class="skill-name">Meteor</div>
                                <div class="skill-level">ì ê¹€</div>
                            </div>
                        </div>
                    </div>
                    <div class="unlock-info">
                        <div class="unlock-desc">ê°•ë ¥í•œ ìš´ì„ ê³µê²© ìŠ¤í‚¬</div>
                        <button class="unlock-btn" data-skill="meteor" data-cost="8">
                            ğŸ”® 8 - í•´ì œí•˜ê¸°
                        </button>
                    </div>
                </div>

                <div class="skill-upgrade-card locked" data-skill="fortress" data-category="locked">
                    <div class="skill-header">
                        <div class="skill-info">
                            <span class="skill-icon">ï¿½</span>
                            <div class="skill-details">
                                <div class="skill-name">Fortress</div>
                                <div class="skill-level">ì ê¹€</div>
                            </div>
                        </div>
                    </div>
                    <div class="unlock-info">
                        <div class="unlock-desc">ìµœê°• ë°©ì–´ë§‰ ìŠ¤í‚¬</div>
                        <button class="unlock-btn" data-skill="fortress" data-cost="15">
                            ğŸ”® 15 - í•´ì œí•˜ê¸°
                        </button>
                    </div>
                </div>
            </div>

            <div class="rune-actions">
                <button class="rune-action-btn skip-btn" id="skipUpgrade">ë‚˜ì¤‘ì—</button>
                <button class="rune-action-btn continue-btn" id="continueGame">ê³„ì†í•˜ê¸°</button>
            </div>
        </div>
    </div>
</div>

<!-- ë©”ë‰´ ì˜¤ë²„ë ˆì´ -->
<div class="menu-overlay" id="menuOverlay">
    <div class="menu-container">
        <div class="menu-header">
            <h2>ê²Œì„ ë©”ë‰´</h2>
            <button class="menu-close" id="menuClose">âœ•</button>
        </div>
        <div class="menu-options">
            <button class="menu-option" id="continueBtn">
                <span>â–¶ï¸</span> ê³„ì†í•˜ê¸°
            </button>
            <button class="menu-option" id="restartBtn">
                <span>ğŸ”„</span> ì²˜ìŒë¶€í„°
            </button>
            <button class="menu-option" id="optionsBtn">
                <span>âš™ï¸</span> ì˜µì…˜
            </button>
            <button class="menu-option" id="mainMenuBtn">
                <span>ğŸ </span> ë©”ì¸ ë©”ë‰´
            </button>
        </div>
    </div>
</div>
</div>
</main>
</div>

<script>
    // ì „ì—­ ë³€ìˆ˜
    let voiceStage = 'idle'; // idle, listening, analyzing, result
    let skillPageVisible = false;
    let currentCategory = 'all';
    let selectedSkillIndex = 0;
    let progressInterval = null;
    let runeStones = 12; // ë£¬ì„ ê°œìˆ˜
    let runeUpgradeVisible = false;

    // ìŠ¤í‚¬ ë°ì´í„° ê´€ë¦¬
    let skillData = {
        'fireball': { level: 3, enhancement: 2, baseDamage: 100, upgradeAmount: 0, cost: 3 },
        'ice-bolt': { level: 2, enhancement: 1, baseDamage: 80, upgradeAmount: 0, cost: 3 },
        'heal': { level: 3, enhancement: 0, baseAmount: 80, upgradeAmount: 0, cost: 2 },
        'meteor': { unlocked: false, cost: 8 },
        'fortress': { unlocked: false, cost: 15 }
    };

    // DOM ìš”ì†Œë“¤
    const voiceOverlay = document.getElementById('voiceOverlay');
    const skillOverlay = document.getElementById('skillOverlay');
    const runeOverlay = document.getElementById('runeOverlay');
    const menuOverlay = document.getElementById('menuOverlay');
    const menuBtn = document.querySelector('.menu-btn');
    const menuClose = document.getElementById('menuClose');

    // ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', () => {
        initializeEventListeners();
        initializeSkillCategories();
        filterSkillsByCategory('all');
    });

    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì´ˆê¸°í™”
    function initializeEventListeners() {
        // í‚¤ë³´ë“œ ì´ë²¤íŠ¸
        document.addEventListener('keydown', handleKeyDown);
        document.addEventListener('keyup', handleKeyUp);

        // ë©”ë‰´ ë²„íŠ¼
        menuBtn.addEventListener('click', () => showOverlay('menu'));
        menuClose.addEventListener('click', () => hideOverlay('menu'));

        // ë£¬ì—…ê·¸ë ˆì´ë“œ ë²„íŠ¼ë“¤
        document.getElementById('runeClose').addEventListener('click', () => hideOverlay('rune'));
        document.getElementById('skipUpgrade').addEventListener('click', () => hideOverlay('rune'));
        document.getElementById('continueGame').addEventListener('click', () => applyUpgrades());

        // ì¹´í…Œê³ ë¦¬ ì „í™˜ ì´ë²¤íŠ¸ ì œê±°ë¨

        // ì—…ê·¸ë ˆì´ë“œ ë²„íŠ¼ ì´ë²¤íŠ¸
        document.querySelectorAll('.upgrade-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const action = btn.dataset.action;
                const skill = btn.dataset.skill;
                handleSkillUpgrade(skill, action);
            });
        });

        // ìŠ¤í‚¬ í•´ì œ ë²„íŠ¼ ì´ë²¤íŠ¸
        document.querySelectorAll('.unlock-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const skill = btn.dataset.skill;
                const cost = parseInt(btn.dataset.cost);
                handleSkillUnlock(skill, cost);
            });
        });

        // ë©”ë‰´ ì˜µì…˜ë“¤
        document.getElementById('continueBtn').addEventListener('click', () => hideOverlay('menu'));
        document.getElementById('restartBtn').addEventListener('click', () => {
            if (confirm('ì •ë§ë¡œ ì²˜ìŒë¶€í„° ì‹œì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                location.reload();
            }
        });

        // í…ŒìŠ¤íŠ¸ìš©: Rí‚¤ë¡œ ë£¬ì—…ê·¸ë ˆì´ë“œ í™”ë©´ ì—´ê¸°
        document.addEventListener('keydown', (e) => {
            if (e.code === 'KeyR' && !runeUpgradeVisible) {
                showRuneUpgrade();
            }
        });
    }

    // í‚¤ë³´ë“œ ì´ë²¤íŠ¸ ì²˜ë¦¬
    let spaceKeyDown = false;
    function handleKeyDown(e) {
        switch (e.code) {
            case 'Space':
                e.preventDefault();
                if (!spaceKeyDown) {
                    spaceKeyDown = true;
                    handleVoiceRecognition();
                }
                break;

            case 'ShiftLeft':
            case 'ShiftRight':
                e.preventDefault();
                toggleSkillBook();
                break;

            case 'Escape':
                hideAllOverlays();
                break;
        }

        // ìŠ¤í‚¬ë¶ì´ ì—´ë ¤ìˆì„ ë•Œ ë„¤ë¹„ê²Œì´ì…˜
        if (skillPageVisible) {
            switch (e.code) {
                case 'KeyW': navigateSkill('up'); break;
                case 'KeyS': navigateSkill('down'); break;
                case 'KeyA': navigateSkill('left'); break;
                case 'KeyD': navigateSkill('right'); break;
                case 'KeyQ': switchCategory('prev'); break;
                case 'KeyE': switchCategory('next'); break;
            }
        }
    }

    function handleKeyUp(e) {
        if (e.code === 'Space') {
            spaceKeyDown = false;
        }
    }

    // ìŒì„± ì¸ì‹ ì²˜ë¦¬ (ìë™ ì§„í–‰ ì‹œìŠ¤í…œ)
    function handleVoiceRecognition() {
        if (voiceStage === 'idle') {
            startVoiceRecognition();
        }
        // listening ìƒíƒœì¼ ë•ŒëŠ” ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•ŠìŒ (ìë™ ì§„í–‰)
    }

    function startVoiceRecognition() {
        voiceStage = 'listening';
        showOverlay('voice');
        showVoiceStage('listening');
        console.log('ìŒì„± ì¸ì‹ ì‹œì‘ - ìŠ¤í‚¬ ì´ë¦„ì„ ë§í•´ì£¼ì„¸ìš”');

        // 2ì´ˆ í›„ ìë™ìœ¼ë¡œ ê²°ê³¼ í™”ë©´ìœ¼ë¡œ ì „í™˜
        setTimeout(() => {
            processVoiceAndShowResult();
        }, 2000);
    }

    function processVoiceAndShowResult() {
        voiceStage = 'result';
        showVoiceStage('result');

        // ëœë¤ ìŠ¤í‚¬ ì´ë¦„ ìƒì„±
        const skillNames = ['íŒŒì´ì–´ë³¼', 'ì•„ì´ìŠ¤ë³¼íŠ¸', 'ë¼ì´íŠ¸ë‹', 'íë§', 'ì‰´ë“œ', 'ë©”í…Œì˜¤'];
        const randomSkill = skillNames[Math.floor(Math.random() * skillNames.length)];

        // ìŠ¤í‚¬ ì´ë¦„ì„ ê¸€ìë³„ë¡œ ë¶„ë¦¬í•˜ì—¬ HTML ìƒì„±
        const skillNameResult = document.getElementById('skillNameResult');
        skillNameResult.innerHTML = '';

        const chars = randomSkill.split('');
        chars.forEach((char, index) => {
            const charSpan = document.createElement('span');
            charSpan.className = 'char';
            charSpan.textContent = char;
            skillNameResult.appendChild(charSpan);
        });

        // ì „ì²´ ì •í™•ë„ ê³„ì‚°
        let totalAccuracy = 0;

        // ê° ê¸€ìë³„ ì •í™•ë„ ì ìš© (ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼)
        setTimeout(() => {
            const charElements = document.querySelectorAll('.char');
            charElements.forEach((char, index) => {
                setTimeout(() => {
                    const charAccuracy = Math.floor(Math.random() * 101);
                    totalAccuracy += charAccuracy;

                    // ì •í™•ë„ë³„ í´ë˜ìŠ¤ ì ìš©
                    const accuracyClass = getAccuracyClass(charAccuracy);
                    char.className = `char ${accuracyClass}`;

                    // ë§ˆì§€ë§‰ ê¸€ì ì²˜ë¦¬ í›„ ì „ì²´ ì •í™•ë„ í‘œì‹œ
                    if (index === charElements.length - 1) {
                        const avgAccuracy = Math.floor(totalAccuracy / charElements.length);
                        document.getElementById('accuracyPercent').textContent = avgAccuracy + '%';
                    }
                }, index * 200);
            });
        }, 500);

        // 3ì´ˆ í›„ íŒì—… ë‹«ê¸°
        setTimeout(() => {
            hideOverlay('voice');
            voiceStage = 'idle';
        }, 4000);
    }

    function getAccuracyClass(accuracy) {
        if (accuracy >= 95) return 'accuracy-100';
        else if (accuracy >= 85) return 'accuracy-90';
        else if (accuracy >= 75) return 'accuracy-80';
        else if (accuracy >= 65) return 'accuracy-70';
        else if (accuracy >= 55) return 'accuracy-60';
        else if (accuracy >= 45) return 'accuracy-50';
        else if (accuracy >= 35) return 'accuracy-40';
        else if (accuracy >= 25) return 'accuracy-30';
        else if (accuracy >= 15) return 'accuracy-20';
        else if (accuracy >= 5) return 'accuracy-10';
        else return 'accuracy-0';
    }

    // ìŠ¤í‚¬ë¶ í† ê¸€
    function toggleSkillBook() {
        if (skillPageVisible) {
            hideOverlay('skill');
            skillPageVisible = false;
        } else {
            showOverlay('skill');
            skillPageVisible = true;
            updateSelectedSkill();
        }
    }

    // ìŠ¤í‚¬ ë„¤ë¹„ê²Œì´ì…˜
    function navigateSkill(direction) {
        const visibleCards = getVisibleSkillCards();
        const gridCols = 3;

        switch (direction) {
            case 'up':
                if (selectedSkillIndex >= gridCols) {
                    selectedSkillIndex -= gridCols;
                }
                break;
            case 'down':
                if (selectedSkillIndex + gridCols < visibleCards.length) {
                    selectedSkillIndex += gridCols;
                }
                break;
            case 'left':
                if (selectedSkillIndex > 0) {
                    selectedSkillIndex--;
                }
                break;
            case 'right':
                if (selectedSkillIndex < visibleCards.length - 1) {
                    selectedSkillIndex++;
                }
                break;
        }
        updateSelectedSkill();
    }

    // ì¹´í…Œê³ ë¦¬ ì „í™˜
    function switchCategory(direction) {
        const categories = ['all', 'attack', 'defense', 'healing'];
        let currentIndex = categories.indexOf(currentCategory);

        if (direction === 'next') {
            currentIndex = (currentIndex + 1) % categories.length;
        } else {
            currentIndex = (currentIndex - 1 + categories.length) % categories.length;
        }

        currentCategory = categories[currentIndex];
        selectedSkillIndex = 0;

        // ì¹´í…Œê³ ë¦¬ UI ì—…ë°ì´íŠ¸
        document.querySelectorAll('.skill-category').forEach(cat => {
            cat.classList.remove('active');
            if (cat.dataset.category === currentCategory) {
                cat.classList.add('active');
            }
        });

        filterSkillsByCategory(currentCategory);
        updateSelectedSkill();
    }

    // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
    function showOverlay(type) {
        hideAllOverlays();
        switch (type) {
            case 'voice':
                voiceOverlay.classList.add('show');
                break;
            case 'skill':
                skillOverlay.classList.add('show');
                break;
            case 'menu':
                menuOverlay.classList.add('show');
                break;
        }
    }

    function hideOverlay(type) {
        switch (type) {
            case 'voice':
                voiceOverlay.classList.remove('show');
                break;
            case 'skill':
                skillOverlay.classList.remove('show');
                break;
            case 'menu':
                menuOverlay.classList.remove('show');
                break;
        }
    }

    function hideAllOverlays() {
        voiceOverlay.classList.remove('show');
        skillOverlay.classList.remove('show');
        menuOverlay.classList.remove('show');
        skillPageVisible = false;
        voiceStage = 'idle';
    }

    function showVoiceStage(stage) {
        document.getElementById('listeningStage').style.display = stage === 'listening' ? 'block' : 'none';
        document.getElementById('resultStage').style.display = stage === 'result' ? 'block' : 'none';
    }

    function initializeSkillCategories() {
        document.querySelectorAll('.skill-category').forEach(category => {
            category.addEventListener('click', () => {
                const categoryName = category.dataset.category;
                currentCategory = categoryName;
                selectedSkillIndex = 0;

                document.querySelectorAll('.skill-category').forEach(c => c.classList.remove('active'));
                category.classList.add('active');

                filterSkillsByCategory(categoryName);
                updateSelectedSkill();
            });
        });
    }

    function filterSkillsByCategory(category) {
        document.querySelectorAll('.skill-card').forEach(card => {
            if (category === 'all' || card.dataset.category === category) {
                card.style.display = 'block';
            } else {
                card.style.display = 'none';
            }
        });
    }

    function getVisibleSkillCards() {
        return Array.from(document.querySelectorAll('.skill-card'))
            .filter(card => card.style.display !== 'none');
    }

    function updateSelectedSkill() {
        const visibleCards = getVisibleSkillCards();

        // ëª¨ë“  ì¹´ë“œì—ì„œ ì„ íƒ ìƒíƒœ ì œê±°
        document.querySelectorAll('.skill-card').forEach(card => {
            card.classList.remove('selected');
        });

        // í˜„ì¬ ì„ íƒëœ ì¹´ë“œì— ì„ íƒ ìƒíƒœ ì¶”ê°€
        if (visibleCards[selectedSkillIndex]) {
            visibleCards[selectedSkillIndex].classList.add('selected');
        }
    }

    // ë£¬ì—…ê·¸ë ˆì´ë“œ ê´€ë ¨ í•¨ìˆ˜ë“¤
    function showRuneUpgrade() {
        runeUpgradeVisible = true;
        updateRuneCount();
        updateAllSkillDisplays();
        showAllSkills();
        showOverlay('rune');
    }

    function updateRuneCount() {
        document.getElementById('runeCount').textContent = runeStones;
    }

    function updateAllSkillDisplays() {
        Object.keys(skillData).forEach(skillName => {
            updateSkillDisplay(skillName);
        });
        updateUnlockButtons();
    }

    function updateSkillDisplay(skillName) {
        const skill = skillData[skillName];
        if (!skill.unlocked && skill.hasOwnProperty('unlocked')) return;

        // í˜„ì¬ ìŠ¤íƒ¯ ì—…ë°ì´íŠ¸
        const levelElement = document.getElementById(`${skillName}-level`);
        const enhancementElement = document.getElementById(`${skillName}-enhancement`);
        const upgradeAmountElement = document.getElementById(`${skillName}-upgrade-amount`);
        const totalCostElement = document.getElementById(`${skillName}-total-cost`);

        if (levelElement) levelElement.textContent = skill.level;
        if (enhancementElement) enhancementElement.textContent = skill.enhancement;
        if (upgradeAmountElement) upgradeAmountElement.textContent = skill.upgradeAmount;
        if (totalCostElement) totalCostElement.textContent = skill.upgradeAmount * skill.cost;

        // ìŠ¤íƒ¯ ê°’ ì—…ë°ì´íŠ¸
        if (skillName === 'fireball') {
            const damageElement = document.getElementById('fireball-damage');
            const nextDamageElement = document.getElementById('fireball-next-damage');
            if (damageElement) damageElement.textContent = skill.baseDamage + (skill.enhancement * 30);
            if (nextDamageElement) nextDamageElement.textContent = skill.baseDamage + ((skill.enhancement + skill.upgradeAmount) * 30);
        } else if (skillName === 'ice-bolt') {
            const damageElement = document.getElementById('ice-bolt-damage');
            const nextDamageElement = document.getElementById('ice-bolt-next-damage');
            if (damageElement) damageElement.textContent = skill.baseDamage + (skill.enhancement * 20);
            if (nextDamageElement) nextDamageElement.textContent = skill.baseDamage + ((skill.enhancement + skill.upgradeAmount) * 20);
        } else if (skillName === 'heal') {
            const amountElement = document.getElementById('heal-amount');
            const nextAmountElement = document.getElementById('heal-next-amount');
            if (amountElement) amountElement.textContent = skill.baseAmount + (skill.enhancement * 40);
            if (nextAmountElement) nextAmountElement.textContent = skill.baseAmount + ((skill.enhancement + skill.upgradeAmount) * 40);
        }

        // ë‹¤ìŒ ìŠ¤íƒ¯ í‘œì‹œ/ìˆ¨ê¹€
        const nextStatsElement = document.getElementById(`${skillName}-next-stats`);
        if (nextStatsElement) {
            nextStatsElement.style.display = skill.upgradeAmount > 0 ? 'block' : 'none';
        }

        // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
        const minusBtn = document.querySelector(`[data-action="decrease"][data-skill="${skillName}"]`);
        const plusBtn = document.querySelector(`[data-action="increase"][data-skill="${skillName}"]`);

        if (minusBtn) minusBtn.disabled = skill.upgradeAmount <= 0;
        if (plusBtn) plusBtn.disabled = runeStones < skill.cost;
    }

    function updateUnlockButtons() {
        document.querySelectorAll('.unlock-btn').forEach(btn => {
            const cost = parseInt(btn.dataset.cost);
            btn.disabled = runeStones < cost;
            if (runeStones < cost) {
                btn.style.opacity = '0.6';
            } else {
                btn.style.opacity = '1';
            }
        });
    }

    function handleSkillUpgrade(skillName, action) {
        const skill = skillData[skillName];

        if (action === 'increase') {
            // ìŠ¤í‚¬ì´ ì ê²¨ìˆë‹¤ë©´ ë¨¼ì € í•´ê¸ˆ
            if (!skill.unlocked && runeStones >= skill.unlockCost) {
                runeStones -= skill.unlockCost;
                skill.unlocked = true;
                unlockSkill(skillName);
            }
            // í•´ê¸ˆëœ ìŠ¤í‚¬ì´ë©´ ì—…ê·¸ë ˆì´ë“œ
            else if (skill.unlocked && runeStones >= skill.cost) {
                skill.upgradeAmount++;
                runeStones -= skill.cost;
            }
        } else if (action === 'decrease') {
            if (skill.upgradeAmount > 0) {
                skill.upgradeAmount--;
                runeStones += skill.cost;
            }
        }

        updateRuneCount();
        updateSkillDisplay(skillName);
        updateAllSkillDisplays();
    }

    function handleSkillUnlock(skillName, cost) {
        if (runeStones >= cost) {
            runeStones -= cost;
            skillData[skillName].unlocked = true;

            updateRuneCount();
            unlockSkill(skillName);
            updateSkillDisplay(skillName);

            console.log(`${skillName} ìŠ¤í‚¬ í•´ì œë¨, ë‚¨ì€ ë£¬ì„: ${runeStones}`);
        } else {
            alert(`ë£¬ì„ì´ ë¶€ì¡±í•©ë‹ˆë‹¤! (í•„ìš”: ${cost}, ë³´ìœ : ${runeStones})`);
        }
    }

    function showAllSkills() {
        // ëª¨ë“  ìŠ¤í‚¬ ì¹´ë“œ í‘œì‹œ
        document.querySelectorAll('.skill-upgrade-card').forEach(card => {
            card.style.display = 'block';
        });
    }

    function applyUpgrades() {
        let totalCost = 0;
        let upgradeCount = 0;

        // ëª¨ë“  ì—…ê·¸ë ˆì´ë“œ ì ìš©
        Object.keys(skillData).forEach(skillName => {
            const skill = skillData[skillName];
            if (skill.upgradeAmount > 0) {
                skill.enhancement += skill.upgradeAmount;
                totalCost += skill.upgradeAmount * skill.cost;
                upgradeCount += skill.upgradeAmount;
                skill.upgradeAmount = 0; // ì—…ê·¸ë ˆì´ë“œ ì„ì‹œ ì¹´ìš´í„° ë¦¬ì…‹
            }
        });

        if (upgradeCount > 0) {
            alert(`${upgradeCount}ê°œì˜ ì—…ê·¸ë ˆì´ë“œê°€ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤! (ì‚¬ìš©ëœ ë£¬ì„: ${totalCost})`);
        }

        hideOverlay('rune');
    }

    function enhanceSkill(skillName) {
        // ìŠ¤í‚¬ ê°•í™” ë¡œì§ (ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ìŠ¤í‚¬ ë°ì´í„° ì—…ë°ì´íŠ¸)
        console.log(`${skillName} ìŠ¤í‚¬ ê°•í™”ë¨`);

        // UIì—ì„œ í•´ë‹¹ ìŠ¤í‚¬ ì¹´ë“œ ì°¾ì•„ì„œ ë ˆë²¨ì—… í‘œì‹œ
        const skillCards = document.querySelectorAll('.skill-card');
        skillCards.forEach(card => {
            const cardName = card.querySelector('.skill-card-name').textContent.toLowerCase();
            if (cardName.includes(skillName.toLowerCase())) {
                const levelElement = card.querySelector('.skill-card-level');
                if (levelElement) {
                    // ë ˆë²¨ ì—…ê·¸ë ˆì´ë“œ í‘œì‹œ
                    levelElement.style.color = '#4fc3f7';
                    levelElement.style.textShadow = '0 0 10px #4fc3f7';
                }
            }
        });
    }

    function unlockSkill(skillName) {
        // ìŠ¤í‚¬ í•´ì œ ë¡œì§
        console.log(`${skillName} ìŠ¤í‚¬ í•´ì œë¨`);

        // UIì—ì„œ í•´ë‹¹ ìŠ¤í‚¬ ì¹´ë“œë¥¼ ì ê¸ˆí•´ì œ ìƒíƒœë¡œ ë³€ê²½
        const skillCards = document.querySelectorAll('.skill-card');
        skillCards.forEach(card => {
            const cardName = card.querySelector('.skill-card-name').textContent.toLowerCase();
            if (cardName.includes(skillName.toLowerCase())) {
                card.classList.remove('locked');
                card.classList.add('unlocked');

                // ì•„ì´ì½˜ ë³€ê²½
                const iconElement = card.querySelector('.skill-card-icon');
                if (skillName === 'meteor') {
                    iconElement.textContent = 'â˜„ï¸';
                } else if (skillName === 'fortress') {
                    iconElement.textContent = 'ğŸ°';
                }

                // ë ˆë²¨ í‘œì‹œ ë³€ê²½
                const levelElement = card.querySelector('.skill-card-level');
                if (levelElement) {
                    levelElement.textContent = 'Lv.1';
                    levelElement.style.color = '#4fc3f7';
                }
            }
        });
    }

    // ì˜¤ë²„ë ˆì´ í‘œì‹œ/ìˆ¨ê¹€ í•¨ìˆ˜ ìˆ˜ì •
    function showOverlay(type) {
        switch (type) {
            case 'voice':
                voiceOverlay.classList.add('show');
                break;
            case 'skill':
                skillOverlay.classList.add('show');
                break;
            case 'rune':
                runeOverlay.classList.add('show');
                break;
            case 'menu':
                menuOverlay.classList.add('show');
                break;
        }
    }

    function hideOverlay(type) {
        switch (type) {
            case 'voice':
                voiceOverlay.classList.remove('show');
                break;
            case 'skill':
                skillOverlay.classList.remove('show');
                break;
            case 'rune':
                runeOverlay.classList.remove('show');
                runeUpgradeVisible = false;
                break;
            case 'menu':
                menuOverlay.classList.remove('show');
                break;
        }
    }

    function hideAllOverlays() {
        voiceOverlay.classList.remove('show');
        skillOverlay.classList.remove('show');
        runeOverlay.classList.remove('show');
        menuOverlay.classList.remove('show');
        skillPageVisible = false;
        runeUpgradeVisible = false;
        voiceStage = 'idle';
    }
</script>
</body>

</html>