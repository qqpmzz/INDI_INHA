<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lost Spells - ë£¬ ì—…ê·¸ë ˆì´ë“œ</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <script>
        // iframe ë‚´ë¶€ì—ì„œ ì‹¤í–‰ë˜ëŠ”ì§€ í™•ì¸í•˜ê³ , ì•„ë‹ˆë©´ ê¸°ë³¸ê²Œì„í™”ë©´ìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
        if (window.parent === window) {
            window.location.href = '../ê¸°ë³¸ê²Œì„í™”ë©´/index.html';
        }
    </script>
    <div class="rune-container">
        <!-- ë’¤ë¡œê°€ê¸° ë²„íŠ¼ -->
        <button class="back-btn" onclick="goBack()">
            <span class="back-icon">â†</span>
            <span class="back-text">ê²Œì„ìœ¼ë¡œ ëŒì•„ê°€ê¸°</span>
        </button>

        <!-- ë£¬ ì—…ê·¸ë ˆì´ë“œ í—¤ë” -->
        <div class="rune-header">
            <div class="rune-title">
                <span class="rune-icon">ğŸ”®</span>
                <h2>ë£¬ ì—…ê·¸ë ˆì´ë“œ</h2>
            </div>
            <div class="rune-currency">
                <span class="rune-stone-icon">ğŸ”®</span>
                <span class="rune-count" id="runeCount">50</span>
                <span class="rune-text">ë£¬ì„</span>
            </div>
        </div>

        <div class="rune-content">
            <div class="rune-description">
                <p>ì›¨ì´ë¸Œ í´ë¦¬ì–´ ë³´ìƒìœ¼ë¡œ ë£¬ì„ì„ íšë“í–ˆìŠµë‹ˆë‹¤!</p>
                <p>ìŠ¤í‚¬ì„ ê°•í™”í•˜ê±°ë‚˜ ìƒˆë¡œìš´ ìŠ¤í‚¬ì„ í•´ì œí•˜ì„¸ìš”.</p>
            </div>

            <!-- ìŠ¤í‚¬ ì—…ê·¸ë ˆì´ë“œ ë¦¬ìŠ¤íŠ¸ -->
            <div class="rune-skills" id="runeSkills">
                <!-- í•´ì œëœ ìŠ¤í‚¬ë“¤ -->
                <div class="skill-upgrade-card" data-skill="fireball">
                    <div class="skill-header">
                        <div class="skill-info">
                            <span class="skill-icon">ğŸ”¥</span>
                            <div class="skill-details">
                                <div class="skill-name">Fireball</div>
                                <div class="skill-level">Lv.<span id="fireball-level">3</span></div>
                            </div>
                        </div>
                        <div class="skill-enhancement">
                            <div class="enhancement-count">ê°•í™” <span id="fireball-enhancement">2</span>íšŒ</div>
                        </div>
                    </div>
                    <div class="skill-stats">
                        <div class="current-stats">
                            <span>ê³µê²©ë ¥: <span class="stat-value" id="fireball-damage">120</span></span>
                            <span>ë§ˆë‚˜: <span class="stat-value">25</span></span>
                        </div>
                    </div>
                    <div class="skill-upgrade-controls">
                        <button class="upgrade-btn minus-btn" data-action="decrease" data-skill="fireball">-</button>
                        <div class="upgrade-info">
                            <span class="upgrade-amount" id="fireball-upgrade-amount">0</span>
                            <span class="upgrade-cost">ğŸ”® <span id="fireball-total-cost">0</span></span>
                        </div>
                        <button class="upgrade-btn plus-btn" data-action="increase" data-skill="fireball">+</button>
                    </div>
                    <div class="next-stats" id="fireball-next-stats" style="display: none;">
                        â†’ ê³µê²©ë ¥: <span class="next-value" id="fireball-next-damage">120</span>
                    </div>
                </div>

                <div class="skill-upgrade-card" data-skill="ice-bolt">
                    <div class="skill-header">
                        <div class="skill-info">
                            <span class="skill-icon">â„ï¸</span>
                            <div class="skill-details">
                                <div class="skill-name">Ice Bolt</div>
                                <div class="skill-level">Lv.<span id="ice-bolt-level">2</span></div>
                            </div>
                        </div>
                        <div class="skill-enhancement">
                            <div class="enhancement-count">ê°•í™” <span id="ice-bolt-enhancement">1</span>íšŒ</div>
                        </div>
                    </div>
                    <div class="skill-stats">
                        <div class="current-stats">
                            <span>ê³µê²©ë ¥: <span class="stat-value" id="ice-bolt-damage">100</span></span>
                            <span>ë§ˆë‚˜: <span class="stat-value">20</span></span>
                        </div>
                    </div>
                    <div class="skill-upgrade-controls">
                        <button class="upgrade-btn minus-btn" data-action="decrease" data-skill="ice-bolt">-</button>
                        <div class="upgrade-info">
                            <span class="upgrade-amount" id="ice-bolt-upgrade-amount">0</span>
                            <span class="upgrade-cost">ğŸ”® <span id="ice-bolt-total-cost">0</span></span>
                        </div>
                        <button class="upgrade-btn plus-btn" data-action="increase" data-skill="ice-bolt">+</button>
                    </div>
                    <div class="next-stats" id="ice-bolt-next-stats" style="display: none;">
                        â†’ ê³µê²©ë ¥: <span class="next-value" id="ice-bolt-next-damage">100</span>
                    </div>
                </div>

                <div class="skill-upgrade-card" data-skill="heal">
                    <div class="skill-header">
                        <div class="skill-info">
                            <span class="skill-icon">ğŸ’š</span>
                            <div class="skill-details">
                                <div class="skill-name">Heal</div>
                                <div class="skill-level">Lv.<span id="heal-level">3</span></div>
                            </div>
                        </div>
                        <div class="skill-enhancement">
                            <div class="enhancement-count">ê°•í™” <span id="heal-enhancement">0</span>íšŒ</div>
                        </div>
                    </div>
                    <div class="skill-stats">
                        <div class="current-stats">
                            <span>íšŒë³µëŸ‰: <span class="stat-value" id="heal-amount">80</span></span>
                            <span>ë§ˆë‚˜: <span class="stat-value">15</span></span>
                        </div>
                    </div>
                    <div class="skill-upgrade-controls">
                        <button class="upgrade-btn minus-btn" data-action="decrease" data-skill="heal">-</button>
                        <div class="upgrade-info">
                            <span class="upgrade-amount" id="heal-upgrade-amount">0</span>
                            <span class="upgrade-cost">ğŸ”® <span id="heal-total-cost">0</span></span>
                        </div>
                        <button class="upgrade-btn plus-btn" data-action="increase" data-skill="heal">+</button>
                    </div>
                    <div class="next-stats" id="heal-next-stats" style="display: none;">
                        â†’ íšŒë³µëŸ‰: <span class="next-value" id="heal-next-amount">80</span>
                    </div>
                </div>

                <!-- ì ê¸´ ìŠ¤í‚¬ë“¤ -->
                <div class="skill-upgrade-card locked" data-skill="meteor">
                    <div class="skill-header">
                        <div class="skill-info">
                            <span class="skill-icon">ğŸ”’</span>
                            <div class="skill-details">
                                <div class="skill-name">Meteor</div>
                                <div class="skill-level">ì ê¹€</div>
                            </div>
                        </div>
                        <div class="unlock-cost">í•´ê¸ˆ: ğŸ”® 20</div>
                    </div>
                    <div class="skill-stats">
                        <div class="current-stats">
                            <span>ê³µê²©ë ¥: <span class="stat-value">300</span></span>
                            <span>ë§ˆë‚˜: <span class="stat-value">60</span></span>
                        </div>
                    </div>
                    <div class="skill-upgrade-controls">
                        <button class="upgrade-btn unlock-btn" data-action="increase" data-skill="meteor">í•´ê¸ˆ</button>
                    </div>
                </div>

                <div class="skill-upgrade-card locked" data-skill="lightning">
                    <div class="skill-header">
                        <div class="skill-info">
                            <span class="skill-icon">ğŸ”’</span>
                            <div class="skill-details">
                                <div class="skill-name">Lightning</div>
                                <div class="skill-level">ì ê¹€</div>
                            </div>
                        </div>
                        <div class="unlock-cost">í•´ê¸ˆ: ğŸ”® 15</div>
                    </div>
                    <div class="skill-stats">
                        <div class="current-stats">
                            <span>ê³µê²©ë ¥: <span class="stat-value">180</span></span>
                            <span>ë§ˆë‚˜: <span class="stat-value">35</span></span>
                        </div>
                    </div>
                    <div class="skill-upgrade-controls">
                        <button class="upgrade-btn unlock-btn" data-action="increase" data-skill="lightning">í•´ê¸ˆ</button>
                    </div>
                </div>
            </div>

            <!-- ì ìš© ë²„íŠ¼ -->
            <div class="rune-footer">
                <button class="apply-btn" id="applyBtn" onclick="applyUpgrades()">
                    <span class="apply-icon">âœ¨</span>
                    <span class="apply-text">ì—…ê·¸ë ˆì´ë“œ ì ìš©</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        let runeStones = 50;

        // ìŠ¤í‚¬ ë°ì´í„°
        const skillData = {
            fireball: { unlocked: true, level: 3, enhancement: 2, upgradeAmount: 0, cost: 5, unlockCost: 0, baseDamage: 120, damagePerUpgrade: 15 },
            "ice-bolt": { unlocked: true, level: 2, enhancement: 1, upgradeAmount: 0, cost: 4, unlockCost: 0, baseDamage: 100, damagePerUpgrade: 12 },
            heal: { unlocked: true, level: 3, enhancement: 0, upgradeAmount: 0, cost: 3, unlockCost: 0, baseHealing: 80, healingPerUpgrade: 10 },
            meteor: { unlocked: false, level: 1, enhancement: 0, upgradeAmount: 0, cost: 10, unlockCost: 20, baseDamage: 300, damagePerUpgrade: 25 },
            lightning: { unlocked: false, level: 1, enhancement: 0, upgradeAmount: 0, cost: 7, unlockCost: 15, baseDamage: 180, damagePerUpgrade: 20 }
        };

        // í‚¤ë³´ë“œ ì´ë²¤íŠ¸ ì²˜ë¦¬
        document.addEventListener('keydown', function (event) {
            if (event.key === 'Escape') {
                goBack();
            }
        });

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.addEventListener('load', function () {
            updateRuneCount();
            initializeUpgradeButtons();
        });

        function initializeUpgradeButtons() {
            document.querySelectorAll('.upgrade-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const skill = btn.dataset.skill;
                    const action = btn.dataset.action;
                    handleSkillUpgrade(skill, action);
                });
            });
        }

        function handleSkillUpgrade(skillName, action) {
            const skill = skillData[skillName];

            if (action === 'increase') {
                // ìŠ¤í‚¬ì´ ì ê²¨ìˆë‹¤ë©´ ë¨¼ì € í•´ê¸ˆ
                if (!skill.unlocked && runeStones >= skill.unlockCost) {
                    runeStones -= skill.unlockCost;
                    skill.unlocked = true;
                    unlockSkill(skillName);
                }
                // í•´ê¸ˆëœ ìŠ¤í‚¬ì´ë©´ ì—…ê·¸ë ˆì´ë“œ
                else if (skill.unlocked && runeStones >= skill.cost) {
                    skill.upgradeAmount++;
                    runeStones -= skill.cost;
                }
            } else if (action === 'decrease') {
                if (skill.upgradeAmount > 0) {
                    skill.upgradeAmount--;
                    runeStones += skill.cost;
                }
            }

            updateRuneCount();
            updateSkillDisplay(skillName);
        }

        function unlockSkill(skillName) {
            const card = document.querySelector(`[data-skill="${skillName}"]`);
            card.classList.remove('locked');

            const skillIcon = card.querySelector('.skill-icon');
            const unlockCostElement = card.querySelector('.unlock-cost');
            const controls = card.querySelector('.skill-upgrade-controls');

            // ì•„ì´ì½˜ ë³€ê²½
            if (skillName === 'meteor') skillIcon.textContent = 'â˜„ï¸';
            if (skillName === 'lightning') skillIcon.textContent = 'âš¡';

            // í•´ê¸ˆ ë¹„ìš© ì œê±°
            if (unlockCostElement) unlockCostElement.remove();

            // ì—…ê·¸ë ˆì´ë“œ ì»¨íŠ¸ë¡¤ë¡œ ë³€ê²½
            controls.innerHTML = `
                <button class="upgrade-btn minus-btn" data-action="decrease" data-skill="${skillName}">-</button>
                <div class="upgrade-info">
                    <span class="upgrade-amount" id="${skillName}-upgrade-amount">0</span>
                    <span class="upgrade-cost">ğŸ”® <span id="${skillName}-total-cost">0</span></span>
                </div>
                <button class="upgrade-btn plus-btn" data-action="increase" data-skill="${skillName}">+</button>
            `;

            // ìƒˆë¡œìš´ ë²„íŠ¼ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            controls.querySelectorAll('.upgrade-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const skill = btn.dataset.skill;
                    const action = btn.dataset.action;
                    handleSkillUpgrade(skill, action);
                });
            });

            updateSkillDisplay(skillName);
        }

        function updateSkillDisplay(skillName) {
            const skill = skillData[skillName];
            const upgradeAmountEl = document.getElementById(`${skillName}-upgrade-amount`);
            const totalCostEl = document.getElementById(`${skillName}-total-cost`);
            const nextStatsEl = document.getElementById(`${skillName}-next-stats`);

            if (upgradeAmountEl) upgradeAmountEl.textContent = skill.upgradeAmount;
            if (totalCostEl) totalCostEl.textContent = skill.upgradeAmount * skill.cost;

            // ë‹¤ìŒ ìŠ¤íƒ¯ í‘œì‹œ
            if (nextStatsEl && skill.upgradeAmount > 0) {
                nextStatsEl.style.display = 'block';
                const nextDamageEl = document.getElementById(`${skillName}-next-damage`);
                const nextAmountEl = document.getElementById(`${skillName}-next-amount`);

                if (nextDamageEl) {
                    const newDamage = skill.baseDamage + (skill.damagePerUpgrade * skill.upgradeAmount);
                    nextDamageEl.textContent = newDamage;
                }
                if (nextAmountEl) {
                    const newHealing = skill.baseHealing + (skill.healingPerUpgrade * skill.upgradeAmount);
                    nextAmountEl.textContent = newHealing;
                }
            } else if (nextStatsEl) {
                nextStatsEl.style.display = 'none';
            }
        }

        function updateRuneCount() {
            document.getElementById('runeCount').textContent = runeStones;
        }

        function applyUpgrades() {
            let totalCost = 0;
            let upgradesApplied = false;

            // ì´ ë¹„ìš© ê³„ì‚°
            Object.values(skillData).forEach(skill => {
                if (skill.upgradeAmount > 0) {
                    totalCost += skill.upgradeAmount * skill.cost;
                    upgradesApplied = true;
                }
            });

            if (!upgradesApplied) {
                alert('ì ìš©í•  ì—…ê·¸ë ˆì´ë“œê°€ ì—†ìŠµë‹ˆë‹¤!');
                return;
            }

            // ì—…ê·¸ë ˆì´ë“œ ì ìš©
            Object.entries(skillData).forEach(([skillName, skill]) => {
                if (skill.upgradeAmount > 0) {
                    skill.enhancement += skill.upgradeAmount;
                    skill.upgradeAmount = 0;

                    // UI ì—…ë°ì´íŠ¸
                    const enhancementEl = document.getElementById(`${skillName}-enhancement`);
                    if (enhancementEl) enhancementEl.textContent = skill.enhancement;

                    updateSkillDisplay(skillName);
                }
            });

            alert(`ì—…ê·¸ë ˆì´ë“œê°€ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤! (ì´ ë¹„ìš©: ${totalCost} ë£¬ì„)`);

            // ê²Œì„ìœ¼ë¡œ ëŒì•„ê°€ê¸°
            setTimeout(() => {
                goBack();
            }, 1000);
        }

        function goBack() {
            // íŒì—…ì—ì„œ í˜¸ì¶œëœ ê²½ìš° ë¶€ëª¨ ìœˆë„ìš°ì—ê²Œ ë‹«ê¸° ë©”ì‹œì§€ ì „ì†¡
            if (window.parent !== window) {
                window.parent.postMessage('closePopup', '*');
            } else {
                window.location.href = '../ê¸°ë³¸ê²Œì„í™”ë©´/index.html';
            }
        }
    </script>
</body>

</html>