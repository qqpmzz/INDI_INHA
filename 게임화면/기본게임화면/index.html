<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lost Spells - ê²Œì„ í”Œë ˆì´</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="game-container">
        <!-- ìƒë‹¨ í—¤ë” -->
        <header class="game-header">
            <div class="header-left">
                <button class="menu-btn">
                    <span class="menu-icon">â˜°</span>
                </button>
                <div class="chapter-info">
                    <span class="chapter-icon">ğŸ“š</span>
                    <span class="chapter-name">Chapter 1: ìŠí˜€ì§„ ìˆ²</span>
                </div>
            </div>

            <div class="header-center">
                <div class="wave-info">
                    <span class="wave-icon">âš¡</span>
                    <span class="wave-text">Wave</span>
                    <span class="wave-number">3</span>
                    <span class="wave-separator">/</span>
                    <span class="wave-total">10</span>
                </div>
                <div class="enemies-info">
                    <span class="enemies-icon">ğŸ‘¹</span>
                    <span class="enemies-text">ë‚¨ì€ ì </span>
                    <span class="enemies-number">7</span>
                </div>
            </div>

            <div class="header-right">
                <div class="score-info">
                    <span class="score-icon">â­</span>
                    <span class="score-label">Score</span>
                    <span class="score-number">12,450</span>
                </div>
            </div>
        </header>

        <!-- ë©”ì¸ ê²Œì„ ì˜ì—­ -->
        <main class="game-area">
            <!-- HP/MP ë°” -->
            <div class="health-mana-bars">
                <div class="health-bar-container">
                    <span class="bar-icon">â¤ï¸</span>
                    <span class="bar-text">HP</span>
                    <div class="health-bar">
                        <div class="health-fill" style="width: 85%"></div>
                        <span class="bar-value-overlay">85 / 100</span>
                    </div>
                </div>

                <div class="mana-bar-container">
                    <span class="bar-icon">ğŸ§ª</span>
                    <span class="bar-text">MP</span>
                    <div class="mana-bar">
                        <div class="mana-fill" style="width: 56.25%"></div>
                        <span class="bar-value-overlay">45 / 80</span>
                    </div>
                </div>
            </div>

            <div class="game-screen">
                <!-- ê²Œì„ í™”ë©´ -->
                <div class="game-placeholder">
                    <!-- ê²Œì„ í™”ë©´ì´ ì—¬ê¸°ì— ë Œë”ë§ë©ë‹ˆë‹¤ -->
                </div>


            </div>

            <!-- íŒì—… ì˜¤ë²„ë ˆì´ë“¤ -->
            <div class="popup-overlay" id="voicePopup">
                <div class="voice-container">
                    <!-- ì™¼ìª½: ì‹œê°ì  í”¼ë“œë°± -->
                    <div class="voice-left-panel">
                        <div class="voice-header">
                            <div class="voice-icon" id="voiceIcon">MIC</div>
                            <div class="voice-status-text" id="voiceMainTitle">ìŒì„± ì¸ì‹ ì¤‘...</div>
                        </div>

                        <div class="sound-waves" id="soundWaves">
                            <div class="wave-bar"></div>
                            <div class="wave-bar"></div>
                            <div class="wave-bar"></div>
                            <div class="wave-bar"></div>
                            <div class="wave-bar"></div>
                            <div class="wave-bar"></div>
                            <div class="wave-bar"></div>
                            <div class="wave-bar"></div>
                            <div class="wave-bar"></div>
                            <div class="wave-bar"></div>
                            <div class="wave-bar"></div>
                            <div class="wave-bar"></div>
                            <div class="wave-bar"></div>
                            <div class="wave-bar"></div>
                            <div class="wave-bar"></div>
                        </div>

                        <div class="voice-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" id="progressFill"></div>
                            </div>
                            <div class="progress-percent" id="progressPercent">0%</div>
                        </div>
                    </div>

                    <!-- ì˜¤ë¥¸ìª½: ê²°ê³¼ ë° ì •ë³´ -->
                    <div class="voice-right-panel">
                        <!-- ì¸ì‹ ê²°ê³¼ -->
                        <div class="result-display">
                            <div class="result-title" id="resultTitle">ìŠ¤í‚¬ ë¶„ì„ ì¤‘...</div>
                            <div class="skill-name-result" id="skillNameResult">
                                <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë  ê¸€ìë“¤ -->
                            </div>
                        </div>

                        <!-- ì •í™•ë„ -->
                        <div class="accuracy-info" id="accuracySection" style="display: none;">
                            <div class="accuracy-title">ì •í™•ë„: <span id="accuracyPercent">0%</span></div>
                            <div class="accuracy-grid">
                                <div class="accuracy-item">
                                    <span class="label">ë°œìŒ</span>
                                    <span id="pronunciationScore" class="value">0%</span>
                                </div>
                                <div class="accuracy-item">
                                    <span class="label">ì†ë„</span>
                                    <span id="speedScore" class="value">0%</span>
                                </div>
                                <div class="accuracy-item">
                                    <span class="label">ëª…ë£Œë„</span>
                                    <span id="clarityScore" class="value">0%</span>
                                </div>
                            </div>
                        </div>

                        <!-- ìŠ¤í‚¬ ì •ë³´ -->
                        <div class="skill-info" id="skillInfoSection" style="display: none;">
                            <div id="skillElement" class="skill-element">í™”ì—¼ ì†ì„±</div>
                            <div id="skillDescription" class="skill-desc">ìŠ¤í‚¬ ì„¤ëª…ì´ í‘œì‹œë©ë‹ˆë‹¤</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ëŒ€í™”ì°½ UI -->
            <div class="dialogue-overlay" id="dialogueBox" style="display: none;">
                <div class="dialogue-container">
                    <div class="dialogue-content">
                        <!-- ìºë¦­í„° ì •ë³´ -->
                        <div class="dialogue-character">
                            <div class="character-portrait" id="characterPortrait">
                                <!-- ìºë¦­í„° ì´ë¯¸ì§€ê°€ ë“¤ì–´ê°ˆ ê³³ -->
                            </div>
                            <div class="character-info">
                                <div class="character-name" id="characterName">ë‚˜ë ˆì´ì…˜</div>
                                <div class="character-type" id="characterType">NARRATOR</div>
                            </div>
                        </div>

                        <!-- ëŒ€ì‚¬ ì˜ì—­ -->
                        <div class="dialogue-text-area">
                            <div class="dialogue-text" id="dialogueText">
                                ì•ˆë…•í•˜ì„¸ìš”. ì´ê²ƒì€ ëŒ€í™” ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ì…ë‹ˆë‹¤.
                            </div>
                        </div>

                        <!-- ì»¨íŠ¸ë¡¤ ì˜ì—­ -->
                        <div class="dialogue-controls">
                            <div class="dialogue-progress">
                                <span class="dialogue-counter" id="dialogueCounter">1 / 5</span>
                            </div>
                            <div class="dialogue-hints">
                                <span class="control-hint">SPACE: ë‹¤ìŒ ëŒ€í™”</span>
                                <span class="control-hint">ESC: ëŒ€í™” ê±´ë„ˆë›°ê¸°</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>



            <div class="popup-overlay" id="skillPopup">
                <div class="skill-container">
                    <!-- ë’¤ë¡œê°€ê¸° ë²„íŠ¼ -->
                    <button class="back-btn" onclick="hidePopup('skillPopup')">
                        <span class="back-icon">â†</span>
                        <span class="back-text">ê²Œì„ìœ¼ë¡œ ëŒì•„ê°€ê¸°</span>
                    </button>

                    <!-- ìŠ¤í‚¬ë¶ í—¤ë” -->
                    <div class="skill-header">
                        <h2 class="skill-title">
                            <span class="skill-icon">âœ¨</span>
                            ìŠ¤í‚¬ ë¶
                        </h2>
                        <div class="skill-controls">
                            <span>WASD: ì´ë™ | Q/E: ì¹´í…Œê³ ë¦¬ | ESC: ëŒì•„ê°€ê¸°</span>
                        </div>
                    </div>

                    <div class="skill-content">
                        <!-- ì¹´í…Œê³ ë¦¬ -->
                        <div class="skill-categories">
                            <div class="skill-category active" data-category="all">
                                <span class="category-icon">ğŸ“‹</span>
                                <span class="category-name">ì „ì²´</span>
                            </div>
                            <div class="skill-category" data-category="attack">
                                <span class="category-icon">âš”ï¸</span>
                                <span class="category-name">ê³µê²©</span>
                            </div>
                            <div class="skill-category" data-category="defense">
                                <span class="category-icon">ğŸ›¡ï¸</span>
                                <span class="category-name">ë°©ì–´</span>
                            </div>
                            <div class="skill-category" data-category="healing">
                                <span class="category-icon">ğŸ’š</span>
                                <span class="category-name">ì¹˜ìœ </span>
                            </div>
                        </div>

                        <!-- ìŠ¤í‚¬ ê·¸ë¦¬ë“œ -->
                        <div class="skill-grid" id="skillGrid">
                            <!-- ê³µê²© ìŠ¤í‚¬ -->
                            <div class="skill-card unlocked" data-category="attack">
                                <div class="skill-card-icon">ğŸ”¥</div>
                                <div class="skill-card-name">Fireball</div>
                                <div class="skill-card-level">Lv.3</div>
                                <div class="skill-card-pronunciation">ğŸ”Š "íŒŒì´ì–´ë³¼"</div>
                                <div class="skill-card-desc">í™”ì—¼ êµ¬ì²´ë¥¼ ë°œì‚¬í•˜ì—¬ ì ì„ ê³µê²©í•©ë‹ˆë‹¤</div>
                                <div class="skill-card-stats">
                                    <div class="stat">ê³µê²©ë ¥: <span class="stat-damage">120</span></div>
                                    <div class="stat">ë§ˆë‚˜: <span class="stat-mana">25</span></div>
                                </div>
                            </div>

                            <div class="skill-card unlocked" data-category="attack">
                                <div class="skill-card-icon">â„ï¸</div>
                                <div class="skill-card-name">Ice Bolt</div>
                                <div class="skill-card-level">Lv.2</div>
                                <div class="skill-card-pronunciation">ğŸ”Š "ì•„ì´ìŠ¤ ë³¼íŠ¸"</div>
                                <div class="skill-card-desc">ì–¼ìŒ í™”ì‚´ì„ ë°œì‚¬í•˜ì—¬ ì ì„ ë§ˆë¹„ì‹œí‚µë‹ˆë‹¤</div>
                                <div class="skill-card-stats">
                                    <div class="stat">ê³µê²©ë ¥: <span class="stat-damage">100</span></div>
                                    <div class="stat">ë§ˆë‚˜: <span class="stat-mana">20</span></div>
                                </div>
                            </div>

                            <div class="skill-card unlocked" data-category="attack">
                                <div class="skill-card-icon">âš¡</div>
                                <div class="skill-card-name">Lightning Bolt</div>
                                <div class="skill-card-level">Lv.2</div>
                                <div class="skill-card-pronunciation">ğŸ”Š "ë¼ì´íŠ¸ë‹ ë³¼íŠ¸"</div>
                                <div class="skill-card-desc">ë²ˆê°œë¥¼ ë°œì‚¬í•˜ì—¬ ì ì„ ê°ì „ì‹œí‚µë‹ˆë‹¤</div>
                                <div class="skill-card-stats">
                                    <div class="stat">ê³µê²©ë ¥: <span class="stat-damage">140</span></div>
                                    <div class="stat">ë§ˆë‚˜: <span class="stat-mana">30</span></div>
                                </div>
                            </div>

                            <div class="skill-card locked" data-category="attack">
                                <div class="skill-card-icon">ğŸ”’</div>
                                <div class="skill-card-name">Meteor</div>
                                <div class="skill-card-level">ì ê¹€</div>
                                <div class="skill-card-pronunciation">ğŸ”Š "ë©”í…Œì˜¤"</div>
                                <div class="skill-card-desc">ë ˆë²¨ 15 ë‹¬ì„± ì‹œ í•´ì œë©ë‹ˆë‹¤</div>
                                <div class="skill-card-stats">
                                    <div class="stat">ê³µê²©ë ¥: <span class="stat-damage">300</span></div>
                                    <div class="stat">ë§ˆë‚˜: <span class="stat-mana">60</span></div>
                                </div>
                            </div>

                            <!-- ë°©ì–´ ìŠ¤í‚¬ -->
                            <div class="skill-card unlocked" data-category="defense">
                                <div class="skill-card-icon">ğŸ›¡ï¸</div>
                                <div class="skill-card-name">Magic Shield</div>
                                <div class="skill-card-level">Lv.4</div>
                                <div class="skill-card-pronunciation">ğŸ”Š "ë§¤ì§ ì‰´ë“œ"</div>
                                <div class="skill-card-desc">ë§ˆë²• ë°©ì–´ë§‰ì„ ìƒì„±í•˜ì—¬ í”¼í•´ë¥¼ ê°ì†Œì‹œí‚µë‹ˆë‹¤</div>
                                <div class="skill-card-stats">
                                    <div class="stat">ë°©ì–´ë ¥: <span class="stat-defense">80</span></div>
                                    <div class="stat">ë§ˆë‚˜: <span class="stat-mana">35</span></div>
                                </div>
                            </div>

                            <div class="skill-card unlocked" data-category="defense">
                                <div class="skill-card-icon">ğŸ’¨</div>
                                <div class="skill-card-name">Wind Barrier</div>
                                <div class="skill-card-level">Lv.2</div>
                                <div class="skill-card-pronunciation">ğŸ”Š "ìœˆë“œ ë°°ë¦¬ì–´"</div>
                                <div class="skill-card-desc">ë°”ëŒ ë°©ë²½ì„ ë§Œë“¤ì–´ íˆ¬ì‚¬ì²´ë¥¼ ë§‰ìŠµë‹ˆë‹¤</div>
                                <div class="skill-card-stats">
                                    <div class="stat">ë°©ì–´ë ¥: <span class="stat-defense">60</span></div>
                                    <div class="stat">ë§ˆë‚˜: <span class="stat-mana">25</span></div>
                                </div>
                            </div>

                            <!-- ì¹˜ìœ  ìŠ¤í‚¬ -->
                            <div class="skill-card unlocked" data-category="healing">
                                <div class="skill-card-icon">ğŸ’š</div>
                                <div class="skill-card-name">Heal</div>
                                <div class="skill-card-level">Lv.5</div>
                                <div class="skill-card-pronunciation">ğŸ”Š "í"</div>
                                <div class="skill-card-desc">ì²´ë ¥ì„ íšŒë³µí•©ë‹ˆë‹¤</div>
                                <div class="skill-card-stats">
                                    <div class="stat">íšŒë³µëŸ‰: <span class="stat-healing">150</span></div>
                                    <div class="stat">ë§ˆë‚˜: <span class="stat-mana">40</span></div>
                                </div>
                            </div>

                            <div class="skill-card unlocked" data-category="healing">
                                <div class="skill-card-icon">ğŸŒŸ</div>
                                <div class="skill-card-name">Regeneration</div>
                                <div class="skill-card-level">Lv.3</div>
                                <div class="skill-card-pronunciation">ğŸ”Š "ë¦¬ì œë„ˆë ˆì´ì…˜"</div>
                                <div class="skill-card-desc">ì§€ì†ì ìœ¼ë¡œ ì²´ë ¥ì„ íšŒë³µí•©ë‹ˆë‹¤</div>
                                <div class="skill-card-stats">
                                    <div class="stat">íšŒë³µëŸ‰: <span class="stat-healing">30/ì´ˆ</span></div>
                                    <div class="stat">ë§ˆë‚˜: <span class="stat-mana">50</span></div>
                                </div>
                            </div>

                            <div class="skill-card locked" data-category="healing">
                                <div class="skill-card-icon">ğŸ”’</div>
                                <div class="skill-card-name">Resurrection</div>
                                <div class="skill-card-level">ì ê¹€</div>
                                <div class="skill-card-pronunciation">ğŸ”Š "ë ˆì €ë ‰ì…˜"</div>
                                <div class="skill-card-desc">ë ˆë²¨ 20 ë‹¬ì„± ì‹œ í•´ì œë©ë‹ˆë‹¤</div>
                                <div class="skill-card-stats">
                                    <div class="stat">íšŒë³µëŸ‰: <span class="stat-healing">Full</span></div>
                                    <div class="stat">ë§ˆë‚˜: <span class="stat-mana">100</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="popup-overlay" id="runePopup">
                <div class="rune-container">
                    <!-- ë’¤ë¡œê°€ê¸° ë²„íŠ¼ -->
                    <button class="back-btn" onclick="hidePopup('runePopup')">
                        <span class="back-icon">â†</span>
                        <span class="back-text">ê²Œì„ìœ¼ë¡œ ëŒì•„ê°€ê¸°</span>
                    </button>

                    <!-- ë£¬ ì—…ê·¸ë ˆì´ë“œ í—¤ë” -->
                    <div class="rune-header">
                        <div class="rune-title">
                            <span class="rune-icon">ğŸ”®</span>
                            <h2>ë£¬ ì—…ê·¸ë ˆì´ë“œ</h2>
                        </div>
                        <div class="rune-currency">
                            <span class="rune-stone-icon">ğŸ”®</span>
                            <span class="rune-count" id="runeCount">50</span>
                            <span class="rune-text">ë£¬ì„</span>
                        </div>
                    </div>

                    <div class="rune-content">
                        <div class="rune-description">
                            <p>ì›¨ì´ë¸Œ í´ë¦¬ì–´ ë³´ìƒìœ¼ë¡œ ë£¬ì„ì„ íšë“í–ˆìŠµë‹ˆë‹¤!</p>
                            <p>ìŠ¤í‚¬ì„ ê°•í™”í•˜ê±°ë‚˜ ìƒˆë¡œìš´ ìŠ¤í‚¬ì„ í•´ì œí•˜ì„¸ìš”.</p>
                        </div>

                        <!-- ìŠ¤í‚¬ ì—…ê·¸ë ˆì´ë“œ ë¦¬ìŠ¤íŠ¸ -->
                        <div class="rune-skills" id="runeSkills">
                            <!-- í•´ì œëœ ìŠ¤í‚¬ë“¤ -->
                            <div class="skill-upgrade-card" data-skill="fireball">
                                <div class="skill-upgrade-header">
                                    <div class="skill-upgrade-info">
                                        <span class="skill-upgrade-icon">ğŸ”¥</span>
                                        <div class="skill-upgrade-details">
                                            <div class="skill-upgrade-name">íŒŒì´ì–´ë³¼</div>
                                            <div class="skill-upgrade-level">Level 3</div>
                                        </div>
                                    </div>
                                    <div class="skill-upgrade-cost">
                                        <span class="cost-icon">ğŸ”®</span>
                                        <span class="cost-amount">15</span>
                                    </div>
                                </div>
                                <div class="skill-upgrade-desc">ê³µê²©ë ¥: 120 â†’ 150 (+25%)</div>
                                <button class="upgrade-btn" onclick="upgradeSkill('fireball', 15)">ì—…ê·¸ë ˆì´ë“œ</button>
                            </div>

                            <div class="skill-upgrade-card" data-skill="icebolt">
                                <div class="skill-upgrade-header">
                                    <div class="skill-upgrade-info">
                                        <span class="skill-upgrade-icon">â„ï¸</span>
                                        <div class="skill-upgrade-details">
                                            <div class="skill-upgrade-name">ì•„ì´ìŠ¤ ë³¼íŠ¸</div>
                                            <div class="skill-upgrade-level">Level 2</div>
                                        </div>
                                    </div>
                                    <div class="skill-upgrade-cost">
                                        <span class="cost-icon">ğŸ”®</span>
                                        <span class="cost-amount">10</span>
                                    </div>
                                </div>
                                <div class="skill-upgrade-desc">ê³µê²©ë ¥: 100 â†’ 130 (+30%)</div>
                                <button class="upgrade-btn" onclick="upgradeSkill('icebolt', 10)">ì—…ê·¸ë ˆì´ë“œ</button>
                            </div>

                            <div class="skill-upgrade-card locked" data-skill="meteor">
                                <div class="skill-upgrade-header">
                                    <div class="skill-upgrade-info">
                                        <span class="skill-upgrade-icon">ğŸ”’</span>
                                        <div class="skill-upgrade-details">
                                            <div class="skill-upgrade-name">ë©”í…Œì˜¤</div>
                                            <div class="skill-upgrade-level">ì ê¸ˆë¨</div>
                                        </div>
                                    </div>
                                    <div class="skill-upgrade-cost">
                                        <span class="cost-icon">ğŸ”®</span>
                                        <span class="cost-amount">30</span>
                                    </div>
                                </div>
                                <div class="skill-upgrade-desc">ë ˆë²¨ 15 ë‹¬ì„± ì‹œ í•´ì œ ê°€ëŠ¥</div>
                                <button class="upgrade-btn disabled" disabled>ì ê¸ˆë¨</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ìŠ¹ë¦¬ íŒì—… -->
            <div class="popup-overlay" id="victoryPopup">
                <div class="victory-container">
                    <!-- ìŠ¹ë¦¬ í—¤ë” -->
                    <div class="victory-header">
                        <div class="victory-title">
                            <span class="victory-crown">ğŸ‘‘</span>
                            <h2>VICTORY!</h2>
                            <span class="victory-crown">ğŸ‘‘</span>
                        </div>
                        <div class="victory-subtitle">ì±•í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤!</div>
                    </div>

                    <!-- ìŠ¹ë¦¬ í†µê³„ -->
                    <div class="victory-stats">
                        <div class="stat-card score-stat">
                            <div class="stat-icon">â­</div>
                            <div class="stat-content">
                                <div class="stat-label">ìµœì¢… ì ìˆ˜</div>
                                <div class="stat-value" id="finalScore">127,450</div>
                            </div>
                        </div>

                        <div class="stat-card wave-stat">
                            <div class="stat-icon">ğŸŒŠ</div>
                            <div class="stat-content">
                                <div class="stat-label">í´ë¦¬ì–´í•œ ì›¨ì´ë¸Œ</div>
                                <div class="stat-value" id="clearedWaves">10 / 10</div>
                            </div>
                        </div>

                        <div class="stat-card time-stat">
                            <div class="stat-icon">â°</div>
                            <div class="stat-content">
                                <div class="stat-label">í”Œë ˆì´ ì‹œê°„</div>
                                <div class="stat-value" id="playTime">15:34</div>
                            </div>
                        </div>
                    </div>

                    <!-- ì‚¬ìš©í•œ ìŠ¤í‚¬ -->
                    <div class="used-skills-section">
                        <h3 class="skills-title">
                            <span class="skills-icon">âœ¨</span>
                            ì‚¬ìš©í•œ ìŠ¤í‚¬
                        </h3>
                        <div class="skills-grid" id="usedSkillsGrid">
                            <div class="skill-usage-item">
                                <span class="skill-emoji">ğŸ”¥</span>
                                <div class="skill-info">
                                    <span class="skill-name">íŒŒì´ì–´ë³¼</span>
                                    <span class="skill-count">23íšŒ</span>
                                </div>
                                <div class="skill-accuracy">87%</div>
                            </div>
                            <div class="skill-usage-item">
                                <span class="skill-emoji">â„ï¸</span>
                                <div class="skill-info">
                                    <span class="skill-name">ì•„ì´ìŠ¤ë³¼íŠ¸</span>
                                    <span class="skill-count">18íšŒ</span>
                                </div>
                                <div class="skill-accuracy">92%</div>
                            </div>
                            <div class="skill-usage-item">
                                <span class="skill-emoji">âš¡</span>
                                <div class="skill-info">
                                    <span class="skill-name">ë¼ì´íŠ¸ë‹</span>
                                    <span class="skill-count">15íšŒ</span>
                                </div>
                                <div class="skill-accuracy">84%</div>
                            </div>
                            <div class="skill-usage-item">
                                <span class="skill-emoji">ğŸ’š</span>
                                <div class="skill-info">
                                    <span class="skill-name">í</span>
                                    <span class="skill-count">7íšŒ</span>
                                </div>
                                <div class="skill-accuracy">95%</div>
                            </div>
                        </div>
                    </div>

                    <!-- ë³´ìƒ ì •ë³´ -->
                    <div class="rewards-section">
                        <h3 class="rewards-title">ğŸ íšë“í•œ ë³´ìƒ</h3>
                        <div class="rewards-grid">
                            <div class="reward-item">
                                <span class="reward-icon">ğŸ”®</span>
                                <div class="reward-info">
                                    <span class="reward-name">ë£¬ì„</span>
                                    <span class="reward-amount" id="earnedRunes">+15</span>
                                </div>
                            </div>
                            <div class="reward-item">
                                <span class="reward-icon">ğŸ’</span>
                                <div class="reward-info">
                                    <span class="reward-name">í¬ë¦¬ìŠ¤íƒˆ</span>
                                    <span class="reward-amount" id="earnedCrystals">+2</span>
                                </div>
                            </div>
                            <div class="reward-item">
                                <span class="reward-icon">â­</span>
                                <div class="reward-info">
                                    <span class="reward-name">ê²½í—˜ì¹˜</span>
                                    <span class="reward-amount" id="earnedExp">+850</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ì•¡ì…˜ ë²„íŠ¼ë“¤ -->
                    <div class="victory-actions">
                        <button class="victory-btn retry-btn" onclick="retryChapter()">
                            <span class="btn-icon">ğŸ”„</span>
                            <span class="btn-text">ë‹¤ì‹œí•˜ê¸°</span>
                        </button>
                        <button class="victory-btn next-btn" onclick="nextChapter()">
                            <span class="btn-icon">â¡ï¸</span>
                            <span class="btn-text">ë‹¤ìŒ ì±•í„°</span>
                        </button>
                        <button class="victory-btn menu-btn" onclick="goToMainMenu()">
                            <span class="btn-icon">ğŸ </span>
                            <span class="btn-text">ë©”ì¸ìœ¼ë¡œ</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- ê²Œì„ì˜¤ë²„ íŒì—… -->
            <div class="popup-overlay" id="gameOverPopup">
                <div class="gameover-container">
                    <!-- ê²Œì„ì˜¤ë²„ í—¤ë” -->
                    <div class="gameover-header">
                        <div class="gameover-title">
                            <span class="gameover-skull">ğŸ’€</span>
                            <h2>GAME OVER</h2>
                            <span class="gameover-skull">ğŸ’€</span>
                        </div>
                        <div class="gameover-subtitle">ë‹¤ìŒì—ëŠ” ë” ì˜í•  ìˆ˜ ìˆì„ ê±°ì˜ˆìš”!</div>
                    </div>

                    <!-- ê²Œì„ì˜¤ë²„ í†µê³„ -->
                    <div class="gameover-stats">
                        <div class="stat-card score-stat">
                            <div class="stat-icon">â­</div>
                            <div class="stat-content">
                                <div class="stat-label">ìµœì¢… ì ìˆ˜</div>
                                <div class="stat-value" id="gameOverScore">45,230</div>
                            </div>
                        </div>

                        <div class="stat-card wave-stat">
                            <div class="stat-icon">ğŸŒŠ</div>
                            <div class="stat-content">
                                <div class="stat-label">ë„ë‹¬í•œ ì›¨ì´ë¸Œ</div>
                                <div class="stat-value" id="gameOverWave">7 / 10</div>
                            </div>
                        </div>

                        <div class="stat-card time-stat">
                            <div class="stat-icon">â°</div>
                            <div class="stat-content">
                                <div class="stat-label">í”Œë ˆì´ ì‹œê°„</div>
                                <div class="stat-value" id="gameOverTime">8:42</div>
                            </div>
                        </div>
                    </div>

                    <!-- ì‹¤íŒ¨ ì›ì¸ -->
                    <div class="failure-reason-section">
                        <h3 class="failure-title">
                            <span class="failure-icon">ğŸ’¥</span>
                            íŒ¨ë°° ì›ì¸
                        </h3>
                        <div class="failure-info">
                            <div class="failure-item">
                                <span class="failure-label">HP ì†Œëª¨:</span>
                                <span class="failure-value" id="hpLost">100%</span>
                            </div>
                            <div class="failure-item">
                                <span class="failure-label">ë§ˆì§€ë§‰ ì :</span>
                                <span class="failure-value" id="lastEnemy">ê³ ë¸”ë¦° ì›Œë¦¬ì–´</span>
                            </div>
                        </div>
                    </div>

                    <!-- ë¶€í™œì„ ì •ë³´ -->
                    <div class="revival-stone-section">
                        <h3 class="revival-title">
                            <span class="revival-icon">ğŸ”®</span>
                            ë¶€í™œì„ìœ¼ë¡œ ì´ì–´ì„œ í•˜ê¸°
                        </h3>
                        <div class="revival-info">
                            <div class="stone-count">
                                <span class="stone-icon">ğŸ”®</span>
                                <span class="stone-text">ë³´ìœ  ë¶€í™œì„:</span>
                                <span class="stone-number" id="revivalStoneCount">3</span>
                                <span class="stone-cost" id="stoneCostIndicator">-1</span>
                            </div>
                            <div class="revival-benefit">
                                <span class="benefit-text">HP 100% íšŒë³µí•˜ì—¬ í˜„ì¬ ì›¨ì´ë¸Œì—ì„œ ì¬ì‹œì‘</span>
                            </div>
                        </div>
                    </div>

                    <!-- ì•¡ì…˜ ë²„íŠ¼ë“¤ -->
                    <div class="gameover-actions">
                        <button class="gameover-btn retry-btn" onclick="retryGame()">
                            <span class="btn-icon">ğŸ”„</span>
                            <span class="btn-text">ë‹¤ì‹œí•˜ê¸°</span>
                        </button>
                        <button class="gameover-btn revival-btn" onclick="reviveWithStone()" id="revivalBtn">
                            <span class="btn-icon">ğŸ”®</span>
                            <span class="btn-text">ë¶€í™œ</span>
                        </button>
                        <button class="gameover-btn menu-btn" onclick="goToMainFromGameOver()">
                            <span class="btn-icon">ğŸ </span>
                            <span class="btn-text">ë©”ì¸ìœ¼ë¡œ</span>
                        </button>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <script>
        // í‚¤ë³´ë“œ ì´ë²¤íŠ¸ ì²˜ë¦¬
        document.addEventListener('keydown', function (event) {
            const key = event.key.toLowerCase();

            // ëŒ€í™” ì‹œìŠ¤í…œ ìš°ì„  ì²˜ë¦¬
            if (dialogueSystem.isActive) {
                switch (key) {
                    case ' ':
                        event.preventDefault();
                        nextDialogue();
                        break;
                    case 'escape':
                        event.preventDefault();
                        skipDialogue();
                        break;
                }
                return; // ëŒ€í™” ì¤‘ì¼ ë•ŒëŠ” ë‹¤ë¥¸ í‚¤ ë¬´ì‹œ
            }

            // ì¼ë°˜ ê²Œì„ í‚¤ ì²˜ë¦¬
            switch (key) {
                case 'w':
                    console.log('ìœ„ë¡œ ì´ë™');
                    break;
                case 'a':
                    console.log('ì™¼ìª½ìœ¼ë¡œ ì´ë™');
                    break;
                case 's':
                    console.log('ì•„ë˜ë¡œ ì´ë™');
                    break;
                case 'd':
                    console.log('ì˜¤ë¥¸ìª½ìœ¼ë¡œ ì´ë™');
                    break;
                case 'q':
                    console.log('ì™¼ìª½ ëŒê¸°');
                    break;
                case 'e':
                    console.log('ì˜¤ë¥¸ìª½ ëŒê¸°');
                    break;
                case ' ':
                    event.preventDefault();
                    goToVoice();
                    break;
                case 'shift':
                    event.preventDefault();
                    goToSkillBook();
                    break;
                case 'r':
                    goToRuneUpgrade();
                    break;
                case 't':
                    // í…ŒìŠ¤íŠ¸ìš©: Tí‚¤ë¡œ ëŒ€í™” ì‹œì‘
                    event.preventDefault();
                    startDialogue('intro');
                    break;
                case 'y':
                    // í…ŒìŠ¤íŠ¸ìš©: Yí‚¤ë¡œ ì „íˆ¬ ëŒ€í™” ì‹œì‘
                    event.preventDefault();
                    startDialogue('battle');
                    break;
                case 'v':
                    // Ví‚¤ë¡œ ìŠ¹ë¦¬ í™”ë©´ í‘œì‹œ (í…ŒìŠ¤íŠ¸ìš©)
                    event.preventDefault();
                    showVictory();
                    break;
                case 'g':
                    // Gí‚¤ë¡œ ê²Œì„ì˜¤ë²„ í™”ë©´ í‘œì‹œ (í…ŒìŠ¤íŠ¸ìš©)
                    event.preventDefault();
                    showGameOver();
                    break;
            }
        });

        // íŒì—… ì œì–´ í•¨ìˆ˜ë“¤
        function goToVoice() {
            showPopup('voicePopup');
        }

        function goToSkillBook() {
            showPopup('skillPopup');
        }

        function goToRuneUpgrade() {
            showPopup('runePopup');
        }

        // ìŠ¹ë¦¬ ê´€ë ¨ í•¨ìˆ˜ë“¤
        function showVictory() {
            showPopup('victoryPopup');
            updateVictoryStats();
        }

        function updateVictoryStats() {
            // ì‹¤ì œ ê²Œì„ì—ì„œëŠ” ì‹¤ì œ í”Œë ˆì´ ë°ì´í„°ë¥¼ ì‚¬ìš©
            const gameStats = {
                finalScore: Math.floor(Math.random() * 200000) + 100000,
                clearedWaves: '10 / 10',
                playTime: generateRandomTime(),
                earnedRunes: Math.floor(Math.random() * 20) + 10,
                earnedCrystals: Math.floor(Math.random() * 5) + 1,
                earnedExp: Math.floor(Math.random() * 1000) + 500
            };

            // UI ì—…ë°ì´íŠ¸
            document.getElementById('finalScore').textContent = gameStats.finalScore.toLocaleString();
            document.getElementById('clearedWaves').textContent = gameStats.clearedWaves;
            document.getElementById('playTime').textContent = gameStats.playTime;
            document.getElementById('earnedRunes').textContent = '+' + gameStats.earnedRunes;
            document.getElementById('earnedCrystals').textContent = '+' + gameStats.earnedCrystals;
            document.getElementById('earnedExp').textContent = '+' + gameStats.earnedExp;

            // ì‚¬ìš©í•œ ìŠ¤í‚¬ ë°ì´í„° ì—…ë°ì´íŠ¸
            updateUsedSkills();
        }

        function updateUsedSkills() {
            const skillsData = [
                { emoji: 'ğŸ”¥', name: 'íŒŒì´ì–´ë³¼', count: Math.floor(Math.random() * 30) + 10, accuracy: Math.floor(Math.random() * 20) + 80 },
                { emoji: 'â„ï¸', name: 'ì•„ì´ìŠ¤ë³¼íŠ¸', count: Math.floor(Math.random() * 25) + 8, accuracy: Math.floor(Math.random() * 20) + 80 },
                { emoji: 'âš¡', name: 'ë¼ì´íŠ¸ë‹', count: Math.floor(Math.random() * 20) + 5, accuracy: Math.floor(Math.random() * 20) + 80 },
                { emoji: 'ğŸ’š', name: 'í', count: Math.floor(Math.random() * 10) + 3, accuracy: Math.floor(Math.random() * 15) + 85 },
                { emoji: 'ğŸ›¡ï¸', name: 'ì‰´ë“œ', count: Math.floor(Math.random() * 8) + 2, accuracy: Math.floor(Math.random() * 10) + 90 }
            ];

            const container = document.getElementById('usedSkillsGrid');
            container.innerHTML = '';

            // ì‹¤ì œë¡œ ì‚¬ìš©í•œ ìŠ¤í‚¬ë§Œ í‘œì‹œ (count > 0)
            const usedSkills = skillsData.filter(skill => skill.count > 0).slice(0, 4); // ìµœëŒ€ 4ê°œ

            usedSkills.forEach(skill => {
                const skillElement = document.createElement('div');
                skillElement.className = 'skill-usage-item';
                skillElement.innerHTML = `
                    <span class="skill-emoji">${skill.emoji}</span>
                    <div class="skill-info">
                        <span class="skill-name">${skill.name}</span>
                        <span class="skill-count">${skill.count}íšŒ</span>
                    </div>
                    <div class="skill-accuracy">${skill.accuracy}%</div>
                `;
                container.appendChild(skillElement);
            });
        }

        function retryChapter() {
            hidePopup('victoryPopup');
            // í˜„ì¬ ì±•í„° ë‹¤ì‹œ ì‹œì‘ ë¡œì§
            console.log('ì±•í„° ì¬ì‹œì‘');
            // ì‹¤ì œë¡œëŠ” ê²Œì„ ìƒíƒœë¥¼ ì´ˆê¸°í™”í•˜ê³  ë‹¤ì‹œ ì‹œì‘
        }

        function nextChapter() {
            hidePopup('victoryPopup');
            // ë‹¤ìŒ ì±•í„°ë¡œ ì´ë™ ë¡œì§
            console.log('ë‹¤ìŒ ì±•í„°ë¡œ ì´ë™');
            // ì‹¤ì œë¡œëŠ” ë‹¤ìŒ ì±•í„° ë°ì´í„°ë¥¼ ë¡œë“œí•˜ê³  ì‹œì‘
        }

        function goToMainMenu() {
            hidePopup('victoryPopup');
            // ë©”ì¸ ë©”ë‰´ë¡œ ì´ë™
            window.location.href = '../../ë©”ì¸ë©”ë‰´/ê¸°ë³¸ìƒíƒœ/index.html';
        }

        // ê²Œì„ì˜¤ë²„ ê´€ë ¨ í•¨ìˆ˜ë“¤
        function showGameOver() {
            showPopup('gameOverPopup');
            updateGameOverStats();
        }

        function updateGameOverStats() {
            // ì‹¤ì œ ê²Œì„ì—ì„œëŠ” ì‹¤ì œ í”Œë ˆì´ ë°ì´í„°ë¥¼ ì‚¬ìš©
            const gameOverStats = {
                finalScore: Math.floor(Math.random() * 100000) + 20000,
                reachedWave: Math.floor(Math.random() * 8) + 3,
                totalWaves: 10,
                playTime: generateRandomTime(),
                hpLost: '100%',
                lastEnemy: getRandomEnemy()
            };

            // UI ì—…ë°ì´íŠ¸
            document.getElementById('gameOverScore').textContent = gameOverStats.finalScore.toLocaleString();
            document.getElementById('gameOverWave').textContent = `${gameOverStats.reachedWave} / ${gameOverStats.totalWaves}`;
            document.getElementById('gameOverTime').textContent = gameOverStats.playTime;
            document.getElementById('hpLost').textContent = gameOverStats.hpLost;
            document.getElementById('lastEnemy').textContent = gameOverStats.lastEnemy;
            
            // ë¶€í™œì„ í‘œì‹œ ì—…ë°ì´íŠ¸
            updateRevivalStoneDisplay();
        }

        function getRandomEnemy() {
            const enemies = ['ê³ ë¸”ë¦° ì „ì‚¬', 'ì˜¤í¬ ì›Œë¦¬ì–´', 'ë‹¤í¬ ë©”ì´ì§€', 'ìŠ¤ì¼ˆë ˆí†¤ ì•„ì²˜', 'íŠ¸ë¡¤ ê°€ë””ì–¸', 'ë“œë˜ê³¤ ìŠ¤í°'];
            return enemies[Math.floor(Math.random() * enemies.length)];
        }

        function retryGame() {
            hidePopup('gameOverPopup');
            // ê²Œì„ ì¬ì‹œì‘ ë¡œì§
            console.log('ê²Œì„ ì¬ì‹œì‘');
            // ì‹¤ì œë¡œëŠ” ê²Œì„ ìƒíƒœë¥¼ ì´ˆê¸°í™”í•˜ê³  ë‹¤ì‹œ ì‹œì‘
        }

        function goToMainFromGameOver() {
            hidePopup('gameOverPopup');
            // ë©”ì¸ ë©”ë‰´ë¡œ ì´ë™
            window.location.href = '../../ë©”ì¸ë©”ë‰´/ê¸°ë³¸ìƒíƒœ/index.html';
        }

        // ë¶€í™œì„ ê´€ë ¨ ë³€ìˆ˜ (ì‹¤ì œ ê²Œì„ì—ì„œëŠ” ê²Œì„ ë°ì´í„°ì—ì„œ ê°€ì ¸ì˜´)
        let revivalStones = 3; // ì´ˆê¸° ë¶€í™œì„ ê°œìˆ˜

        function reviveWithStone() {
            if (revivalStones > 0) {
                revivalStones--;
                hidePopup('gameOverPopup');
                console.log('ë¶€í™œì„ ì‚¬ìš©! ë‚¨ì€ ê°œìˆ˜:', revivalStones);
                // ì‹¤ì œë¡œëŠ” HPë¥¼ 100%ë¡œ íšŒë³µí•˜ê³  í˜„ì¬ ì›¨ì´ë¸Œì—ì„œ ì¬ì‹œì‘
                alert(`ë¶€í™œì„ì„ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤! HPê°€ 100% íšŒë³µë˜ì—ˆìŠµë‹ˆë‹¤.\në‚¨ì€ ë¶€í™œì„: ${revivalStones}ê°œ`);
            } else {
                alert('ë¶€í™œì„ì´ ë¶€ì¡±í•©ë‹ˆë‹¤!');
            }
        }

        function updateRevivalStoneDisplay() {
            // ë¶€í™œì„ ê°œìˆ˜ ì—…ë°ì´íŠ¸
            const stoneCountElement = document.getElementById('revivalStoneCount');
            const revivalBtn = document.getElementById('revivalBtn');
            const stoneCostIndicator = document.getElementById('stoneCostIndicator');
            
            if (stoneCountElement) {
                stoneCountElement.textContent = revivalStones;
            }
            
            // -1 í‘œì‹œ ì—…ë°ì´íŠ¸
            if (stoneCostIndicator) {
                if (revivalStones <= 0) {
                    stoneCostIndicator.style.display = 'none';
                } else {
                    stoneCostIndicator.style.display = 'inline';
                }
            }
            
            // ë¶€í™œì„ì´ ì—†ìœ¼ë©´ ë²„íŠ¼ ë¹„í™œì„±í™”
            if (revivalBtn) {
                if (revivalStones <= 0) {
                    revivalBtn.disabled = true;
                    revivalBtn.classList.add('disabled');
                    revivalBtn.innerHTML = `
                        <span class="btn-icon">ğŸ”®</span>
                        <span class="btn-text">ë¶€í™œ ë¶ˆê°€</span>
                    `;
                } else {
                    revivalBtn.disabled = false;
                    revivalBtn.classList.remove('disabled');
                    revivalBtn.innerHTML = `
                        <span class="btn-icon">ğŸ”®</span>
                        <span class="btn-text">ë¶€í™œ</span>
                    `;
                }
            }
        }



        // ì¤‘ë³µ í•¨ìˆ˜ ì œê±°ë¨ - ì•„ë˜ì˜ í†µí•©ëœ showPopup í•¨ìˆ˜ë¥¼ ì‚¬ìš©

        // íŒì—… ì™¸ë¶€ í´ë¦­ì‹œ ë‹«ê¸°
        document.querySelectorAll('.popup-overlay').forEach(overlay => {
            overlay.addEventListener('click', function (e) {
                if (e.target === overlay) {
                    overlay.classList.remove('show');
                }
            });
        });

        // ESC í‚¤ë¡œ íŒì—… ë‹«ê¸°
        document.addEventListener('keydown', function (event) {
            if (event.key === 'Escape') {
                document.querySelectorAll('.popup-overlay.show').forEach(overlay => {
                    overlay.classList.remove('show');
                });
            }
        });

        // íŒì—…ì—ì„œ ë‹«ê¸° ë©”ì‹œì§€ ìˆ˜ì‹ 
        window.addEventListener('message', function (event) {
            if (event.data === 'closePopup') {
                document.querySelectorAll('.popup-overlay.show').forEach(overlay => {
                    overlay.classList.remove('show');
                });
            }
        });

        // ìŠ¤í‚¬ë¶ ê´€ë ¨ ë³€ìˆ˜
        let currentCategory = 'all';
        let selectedCardIndex = 0;
        let skillPopupActive = false;

        // ìŠ¤í‚¬ë¶ í‚¤ë³´ë“œ ì´ë²¤íŠ¸ ì²˜ë¦¬
        document.addEventListener('keydown', function (event) {
            if (skillPopupActive && document.getElementById('skillPopup').classList.contains('show')) {
                const key = event.key.toLowerCase();

                switch (key) {
                    case 'w':
                        event.preventDefault();
                        navigateSkillCards('up');
                        break;
                    case 'a':
                        event.preventDefault();
                        navigateSkillCards('left');
                        break;
                    case 's':
                        event.preventDefault();
                        navigateSkillCards('down');
                        break;
                    case 'd':
                        event.preventDefault();
                        navigateSkillCards('right');
                        break;
                    case 'q':
                        event.preventDefault();
                        switchSkillCategory(-1);
                        break;
                    case 'e':
                        event.preventDefault();
                        switchSkillCategory(1);
                        break;
                }
            }
        });

        // ìŠ¤í‚¬ë¶ íŒì—… í‘œì‹œ ì‹œ ì´ˆê¸°í™”
        function showPopup(popupId) {
            document.getElementById(popupId).classList.add('show');
            if (popupId === 'skillPopup') {
                skillPopupActive = true;
                showSkillCategory('all');
                selectedCardIndex = 0;
                highlightSelectedSkillCard();
            } else if (popupId === 'voicePopup') {
                startVoiceRecognition();
            }
        }

        function hidePopup(popupId) {
            document.getElementById(popupId).classList.remove('show');
            if (popupId === 'skillPopup') {
                skillPopupActive = false;
            } else if (popupId === 'voicePopup') {
                // ìŒì„± ì¸ì‹ ìƒíƒœ ë¦¬ì…‹
                voiceIsProcessing = false;

                // UI ì´ˆê¸°í™”
                const soundWaves = document.getElementById('soundWaves');
                if (soundWaves) {
                    soundWaves.style.display = 'none';
                    soundWaves.classList.remove('listening', 'processing', 'completed');
                }

                // ì§„í–‰ë¥  ë¦¬ì…‹
                updateProgressStatus('STANDBY', 0);

                // ê²°ê³¼ ì„¹ì…˜ ìˆ¨ê¸°ê¸°
                const accuracySection = document.getElementById('accuracySection');
                const skillInfoSection = document.getElementById('skillInfoSection');
                if (accuracySection) accuracySection.style.display = 'none';
                if (skillInfoSection) skillInfoSection.style.display = 'none';

                // ìŠ¤í‚¬ ê²°ê³¼ ì´ˆê¸°í™”
                const skillNameResult = document.getElementById('skillNameResult');
                const resultTitle = document.getElementById('resultTitle');
                if (skillNameResult) skillNameResult.innerHTML = '';
                if (resultTitle) {
                    resultTitle.textContent = 'ANALYZING...';
                    resultTitle.style.color = 'rgba(255, 255, 255, 0.8)';
                    resultTitle.style.textShadow = 'none';
                }
            }
        }

        // ìŠ¤í‚¬ ì¹´í…Œê³ ë¦¬ ì „í™˜
        function switchSkillCategory(direction) {
            const categories = ['all', 'attack', 'defense', 'healing'];
            const currentIndex = categories.indexOf(currentCategory);
            let newIndex = currentIndex + direction;

            if (newIndex < 0) newIndex = categories.length - 1;
            if (newIndex >= categories.length) newIndex = 0;

            currentCategory = categories[newIndex];
            showSkillCategory(currentCategory);
            selectedCardIndex = 0;
            highlightSelectedSkillCard();
        }

        function showSkillCategory(category) {
            // ì¹´í…Œê³ ë¦¬ ë²„íŠ¼ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.skill-category').forEach(cat => {
                cat.classList.remove('active');
            });
            const activeCategory = document.querySelector(`[data-category="${category}"]`);
            if (activeCategory) {
                activeCategory.classList.add('active');
            }

            // ìŠ¤í‚¬ ì¹´ë“œ í•„í„°ë§
            const skillCards = document.querySelectorAll('.skill-card');
            skillCards.forEach(card => {
                if (category === 'all' || card.dataset.category === category) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });

            currentCategory = category;
        }

        function navigateSkillCards(direction) {
            const visibleCards = Array.from(document.querySelectorAll('.skill-card'))
                .filter(card => card.style.display !== 'none');

            if (visibleCards.length === 0) return;

            const cols = 3; // í•œ ì¤„ì— 3ê°œì”©

            switch (direction) {
                case 'up':
                    selectedCardIndex = Math.max(0, selectedCardIndex - cols);
                    break;
                case 'down':
                    selectedCardIndex = Math.min(visibleCards.length - 1, selectedCardIndex + cols);
                    break;
                case 'left':
                    selectedCardIndex = Math.max(0, selectedCardIndex - 1);
                    break;
                case 'right':
                    selectedCardIndex = Math.min(visibleCards.length - 1, selectedCardIndex + 1);
                    break;
            }

            highlightSelectedSkillCard();
        }

        function highlightSelectedSkillCard() {
            const visibleCards = Array.from(document.querySelectorAll('.skill-card'))
                .filter(card => card.style.display !== 'none');

            // ëª¨ë“  ì¹´ë“œì—ì„œ selected í´ë˜ìŠ¤ ì œê±°
            document.querySelectorAll('.skill-card').forEach(card => {
                card.classList.remove('selected');
            });

            // ì„ íƒëœ ì¹´ë“œì— selected í´ë˜ìŠ¤ ì¶”ê°€
            if (visibleCards[selectedCardIndex]) {
                visibleCards[selectedCardIndex].classList.add('selected');
                visibleCards[selectedCardIndex].scrollIntoView({
                    behavior: 'smooth',
                    block: 'center'
                });
            }
        }

        // ìŒì„±ì¸ì‹ ê´€ë ¨ ë³€ìˆ˜
        let voiceCurrentStage = 1;
        let voiceIsProcessing = false;

        // ì‚¬ìš© ê°€ëŠ¥í•œ ìŠ¤í‚¬ ëª©ë¡ (ì˜ì–´ ì´ë¦„)
        const availableSkills = [
            { name: 'Fireball', korean: 'íŒŒì´ì–´ë³¼', pronunciation: 'íŒŒì´ì–´ë³¼', element: 'fire' },
            { name: 'Ice Bolt', korean: 'ì•„ì´ìŠ¤ ë³¼íŠ¸', pronunciation: 'ì•„ì´ìŠ¤ ë³¼íŠ¸', element: 'ice' },
            { name: 'Lightning', korean: 'ë¼ì´íŠ¸ë‹', pronunciation: 'ë¼ì´íŠ¸ë‹', element: 'lightning' },
            { name: 'Heal', korean: 'í', pronunciation: 'í', element: 'holy' },
            { name: 'Shield', korean: 'ì‰´ë“œ', pronunciation: 'ì‰´ë“œ', element: 'holy' },
            { name: 'Meteor', korean: 'ë©”í…Œì˜¤', pronunciation: 'ë©”í…Œì˜¤', element: 'fire' },
            { name: 'Blizzard', korean: 'ë¸”ë¦¬ìë“œ', pronunciation: 'ë¸”ë¦¬ìë“œ', element: 'ice' },
            { name: 'Earthquake', korean: 'ì–´ìŠ¤í€˜ì´í¬', pronunciation: 'ì–´ìŠ¤í€˜ì´í¬', element: 'earth' },
            { name: 'Wind Blade', korean: 'ìœˆë“œ ë¸”ë ˆì´ë“œ', pronunciation: 'ìœˆë“œ ë¸”ë ˆì´ë“œ', element: 'wind' },
            { name: 'Holy Light', korean: 'í™€ë¦¬ ë¼ì´íŠ¸', pronunciation: 'í™€ë¦¬ ë¼ì´íŠ¸', element: 'holy' },
            { name: 'Dark Magic', korean: 'ë‹¤í¬ ë§¤ì§', pronunciation: 'ë‹¤í¬ ë§¤ì§', element: 'dark' },
            { name: 'Teleport', korean: 'í…”ë ˆí¬íŠ¸', pronunciation: 'í…”ë ˆí¬íŠ¸', element: 'arcane' },
            { name: 'Time Stop', korean: 'íƒ€ì„ ìŠ¤í†±', pronunciation: 'íƒ€ì„ ìŠ¤í†±', element: 'arcane' },
            { name: 'Phoenix', korean: 'í”¼ë‹‰ìŠ¤', pronunciation: 'í”¼ë‹‰ìŠ¤', element: 'fire' },
            { name: 'Dragon Breath', korean: 'ë“œë˜ê³¤ ë¸Œë ˆìŠ¤', pronunciation: 'ë“œë˜ê³¤ ë¸Œë ˆìŠ¤', element: 'fire' }
        ];

        function startVoiceRecognition() {
            if (voiceIsProcessing) return;
            voiceIsProcessing = true;

            // ì´ˆê¸°í™”
            const accuracySection = document.getElementById('accuracySection');
            const skillInfoSection = document.getElementById('skillInfoSection');
            const skillNameResult = document.getElementById('skillNameResult');
            const resultTitle = document.getElementById('resultTitle');

            if (accuracySection) accuracySection.style.display = 'none';
            if (skillInfoSection) skillInfoSection.style.display = 'none';
            if (skillNameResult) skillNameResult.innerHTML = '';
            if (resultTitle) {
                resultTitle.textContent = 'ANALYZING...';
                resultTitle.style.color = 'rgba(255, 255, 255, 0.8)';
                resultTitle.style.textShadow = 'none';
            }

            voiceCurrentStage = 1;
            showVoiceStage(1);

            // 4ì´ˆ í›„ ì¸ì‹ ì‹œì‘
            setTimeout(() => {
                if (voiceCurrentStage === 1) {
                    simulateVoiceRecognition();
                }
            }, 4000);
        }

        function simulateVoiceRecognition() {
            // ìŒì„± ë“£ê¸° ìƒíƒœë¡œ ì „í™˜
            showListeningState();

            setTimeout(() => {
                // ìŒì„± ë¶„ì„ ìƒíƒœë¡œ ì „í™˜
                showProcessingState();

                // ì‹¤ì‹œê°„ ìŠ¤í‚¬ ë¶„ì„ ì‹œì‘
                startRealTimeSkillAnalysis();

            }, 2000); // 2ì´ˆ ë“£ê¸°
        }

        function startRealTimeSkillAnalysis() {
            // ìµœì¢… ëª©í‘œ ìŠ¤í‚¬ ì„ íƒ
            const finalSkill = availableSkills[Math.floor(Math.random() * availableSkills.length)];
            const finalAccuracy = Math.floor(Math.random() * 30) + 70; // 70-100% ìµœì¢… ì •í™•ë„

            // ë¶„ì„ ê³¼ì •ì—ì„œ ë³´ì—¬ì¤„ í›„ë³´ ìŠ¤í‚¬ë“¤ (ìµœì¢… ìŠ¤í‚¬ í¬í•¨)
            const candidateSkills = [];

            // ëœë¤í•œ í›„ë³´ë“¤ ì¶”ê°€ (3-5ê°œ)
            const numCandidates = Math.floor(Math.random() * 3) + 3;
            for (let i = 0; i < numCandidates - 1; i++) {
                let randomSkill;
                do {
                    randomSkill = availableSkills[Math.floor(Math.random() * availableSkills.length)];
                } while (randomSkill === finalSkill || candidateSkills.includes(randomSkill));
                candidateSkills.push(randomSkill);
            }

            // ìµœì¢… ìŠ¤í‚¬ì„ ë§ˆì§€ë§‰ì— ì¶”ê°€
            candidateSkills.push(finalSkill);

            // ì •í™•ë„ ë° ìŠ¤í‚¬ ì •ë³´ ì„¹ì…˜ í‘œì‹œ
            const accuracySection = document.getElementById('accuracySection');
            const skillInfoSection = document.getElementById('skillInfoSection');
            if (accuracySection) accuracySection.style.display = 'block';
            if (skillInfoSection) skillInfoSection.style.display = 'block';

            let currentIndex = 0;

            function showNextCandidate() {
                if (currentIndex < candidateSkills.length) {
                    const currentSkill = candidateSkills[currentIndex];
                    const isLastSkill = currentIndex === candidateSkills.length - 1;

                    // ì •í™•ë„ ê³„ì‚° (ë§ˆì§€ë§‰ ìŠ¤í‚¬ì´ë©´ ìµœì¢… ì •í™•ë„, ì•„ë‹ˆë©´ ë‚®ì€ ì •í™•ë„)
                    const accuracy = isLastSkill ? finalAccuracy : Math.floor(Math.random() * 40) + 30;

                    // ìŠ¤í‚¬ ì´ë¦„ê³¼ ì •ë³´ ì—…ë°ì´íŠ¸
                    displaySkillCandidate(currentSkill, accuracy, isLastSkill);

                    currentIndex++;

                    if (isLastSkill) {
                        // ìµœì¢… ìŠ¤í‚¬ ë°œê²¬ - ì™„ë£Œ ìƒíƒœë¡œ ì „í™˜
                        setTimeout(() => {
                            showCompletedState();
                            displayFinalSkillResult(currentSkill, accuracy);

                            // 4ì´ˆ í›„ ìë™ìœ¼ë¡œ ê²Œì„ìœ¼ë¡œ ëŒì•„ê°€ê¸°
                            autoCloseVoice();
                        }, 1000);
                    } else {
                        // ë‹¤ìŒ í›„ë³´ë¡œ ì´ë™
                        setTimeout(showNextCandidate, Math.random() * 800 + 400); // 0.4-1.2ì´ˆ ê°„ê²©
                    }
                }
            }

            // ì²« ë²ˆì§¸ í›„ë³´ í‘œì‹œ
            showNextCandidate();
        }

        function displaySkillNameWithAnimation(skill, overallAccuracy) {
            const container = document.getElementById('skillNameResult');
            container.innerHTML = '';

            // ì†ì„±ë³„ ê¸°ë³¸ ìƒ‰ìƒ ì •ì˜
            const elementColors = {
                fire: { r: 255, g: 71, b: 87 },      // ë¹¨ê°„ìƒ‰ (íŒŒì´ì–´ë³¼)
                ice: { r: 79, g: 195, b: 247 },      // íŒŒë€ìƒ‰ (ì•„ì´ìŠ¤)
                lightning: { r: 255, g: 235, b: 59 }, // ë…¸ë€ìƒ‰ (ë¼ì´íŠ¸ë‹)
                holy: { r: 255, g: 255, b: 255 },    // í°ìƒ‰ (í, ì‰´ë“œ)
                earth: { r: 139, g: 69, b: 19 },     // ê°ˆìƒ‰ (ì–´ìŠ¤í€˜ì´í¬)
                wind: { r: 144, g: 238, b: 144 },    // ì—°í•œ ë…¹ìƒ‰ (ìœˆë“œ)
                dark: { r: 138, g: 43, b: 226 },     // ë³´ë¼ìƒ‰ (ë‹¤í¬ ë§¤ì§)
                arcane: { r: 255, g: 20, b: 147 }    // ë§ˆì  íƒ€ (í…”ë ˆí¬íŠ¸, íƒ€ì„ìŠ¤í†±)
            };

            const baseColor = elementColors[skill.element] || { r: 255, g: 255, b: 255 };
            const letters = skill.name.split('');

            letters.forEach((letter, index) => {
                const span = document.createElement('span');
                span.className = 'skill-letter';
                span.textContent = letter === ' ' ? '\u00A0' : letter; // ê³µë°± ì²˜ë¦¬
                span.style.animationDelay = (index * 0.1) + 's';

                // ê° ê¸€ìë³„ ê°œë³„ ì •í™•ë„ (ì „ì²´ ì •í™•ë„ ê¸°ì¤€ìœ¼ë¡œ Â±20% ëœë¤)
                const letterAccuracy = Math.max(20, Math.min(100, overallAccuracy + (Math.random() - 0.5) * 40));

                // ì •í™•ë„ì— ë”°ë¥¸ íˆ¬ëª…ë„ ë° ì±„ë„ ì¡°ì •
                const opacity = letterAccuracy / 100; // 20% = 0.2, 100% = 1.0
                const saturation = letterAccuracy / 100; // ì •í™•ë„ê°€ ë‚®ìœ¼ë©´ ì±„ë„ë„ ë‚®ì•„ì§

                // ì–´ë‘ìš´ ìƒ‰ìƒìœ¼ë¡œ ë³€í™˜ (ì •í™•ë„ê°€ ë‚®ì„ìˆ˜ë¡ ì–´ë‘ì›Œì§)
                const darkR = Math.floor(baseColor.r * saturation);
                const darkG = Math.floor(baseColor.g * saturation);
                const darkB = Math.floor(baseColor.b * saturation);

                span.style.color = `rgba(${darkR}, ${darkG}, ${darkB}, ${opacity})`;
                span.style.textShadow = `0 0 15px rgba(${darkR}, ${darkG}, ${darkB}, ${opacity * 0.6})`;

                container.appendChild(span);
            });

            // ìš°ì¸¡ íŒ¨ë„ ì •ë³´ ì—…ë°ì´íŠ¸
            updateRightPanelInfo(skill, overallAccuracy);
        }

        function displaySkillCandidate(skill, accuracy, isFinal = false) {
            // ê²°ê³¼ ì œëª© ì—…ë°ì´íŠ¸
            const resultTitle = document.getElementById('resultTitle');
            if (resultTitle) {
                if (isFinal) {
                    resultTitle.textContent = 'ì¸ì‹ ì™„ë£Œ!';
                    resultTitle.style.color = '#4fc3f7';
                    resultTitle.style.textShadow = '0 0 15px rgba(79, 195, 247, 0.6)';
                } else {
                    resultTitle.textContent = `ìŠ¤í‚¬ ë¶„ì„ ì¤‘... (${Math.floor(accuracy)}% ì¼ì¹˜)`;
                    resultTitle.style.color = 'rgba(255, 255, 255, 0.8)';
                    resultTitle.style.textShadow = 'none';
                }
            }

            // ìŠ¤í‚¬ ì´ë¦„ì„ ë¹ ë¥´ê²Œ ë³€í™”ì‹œí‚¤ë©° í‘œì‹œ
            const container = document.getElementById('skillNameResult');
            container.innerHTML = '';

            // í›„ë³´ ìŠ¤í‚¬ ì´ë¦„ì„ í…ìŠ¤íŠ¸ë¡œ í‘œì‹œ (ì• ë‹ˆë©”ì´ì…˜ ì—†ì´)
            const skillText = document.createElement('div');
            skillText.className = isFinal ? 'skill-final' : 'skill-candidate';
            skillText.textContent = skill.name;
            skillText.style.cssText = `
                font-size: ${isFinal ? '1.8rem' : '1.4rem'};
                color: ${isFinal ? '#4fc3f7' : 'rgba(255, 255, 255, 0.7)'};
                text-align: center;
                font-weight: bold;
                transition: all 0.3s ease;
                ${isFinal ? 'text-shadow: 0 0 20px rgba(79, 195, 247, 0.6);' : ''}
                ${!isFinal ? 'animation: skillFlicker 0.3s ease-in-out;' : ''}
            `;
            container.appendChild(skillText);

            // ì •í™•ë„ ì—…ë°ì´íŠ¸
            updateAccuracyDisplay(accuracy, isFinal);

            // ìŠ¤í‚¬ ì •ë³´ ì—…ë°ì´íŠ¸
            updateSkillInfo(skill, isFinal);
        }

        function updateAccuracyDisplay(accuracy, isFinal = false) {
            // ì „ì²´ ì •í™•ë„ í‘œì‹œ
            const accuracyElement = document.getElementById('accuracyPercent');
            if (accuracyElement) {
                accuracyElement.textContent = accuracy + '%';
                accuracyElement.style.color = isFinal ? '#4fc3f7' : 'rgba(255, 255, 255, 0.7)';
            }

            // ì„¸ë¶€ ì ìˆ˜ ê³„ì‚° (ì‹¤ì‹œê°„ìœ¼ë¡œ ë³€í™”)
            const pronunciationScore = Math.max(20, Math.min(100, accuracy + (Math.random() - 0.5) * 30));
            const speedScore = Math.max(20, Math.min(100, accuracy + (Math.random() - 0.5) * 40));
            const clarityScore = Math.max(20, Math.min(100, accuracy + (Math.random() - 0.5) * 35));

            // ì •í™•ë„ ì •ë³´ ì—…ë°ì´íŠ¸
            const pronElement = document.getElementById('pronunciationScore');
            const speedElement = document.getElementById('speedScore');
            const clarityElement = document.getElementById('clarityScore');

            if (pronElement) {
                pronElement.textContent = Math.round(pronunciationScore) + '%';
                pronElement.style.color = isFinal ? '#4fc3f7' : 'rgba(255, 255, 255, 0.7)';
            }
            if (speedElement) {
                speedElement.textContent = Math.round(speedScore) + '%';
                speedElement.style.color = isFinal ? '#4fc3f7' : 'rgba(255, 255, 255, 0.7)';
            }
            if (clarityElement) {
                clarityElement.textContent = Math.round(clarityScore) + '%';
                clarityElement.style.color = isFinal ? '#4fc3f7' : 'rgba(255, 255, 255, 0.7)';
            }
        }

        function updateSkillInfo(skill, isFinal = false) {
            // ìŠ¤í‚¬ ì •ë³´ ì—…ë°ì´íŠ¸
            const elementNames = {
                fire: 'FIRE í™”ì—¼ ì†ì„±',
                ice: 'ICE ë¹™ê²° ì†ì„±',
                lightning: 'LIGHTNING ì „ê¸° ì†ì„±',
                holy: 'HOLY ì‹ ì„± ì†ì„±',
                earth: 'EARTH ëŒ€ì§€ ì†ì„±',
                wind: 'WIND ë°”ëŒ ì†ì„±',
                dark: 'DARK ì–´ë‘  ì†ì„±',
                arcane: 'ARCANE ë¹„ì „ ì†ì„±'
            };

            const skillDescriptions = {
                'Fireball': 'ê°•ë ¥í•œ í™”ì—¼ êµ¬ì²´ë¥¼ ë°œì‚¬í•˜ì—¬ ì ì—ê²Œ í™”ìƒ í”¼í•´ë¥¼ ì…í™ë‹ˆë‹¤.',
                'Ice Bolt': 'ì–¼ìŒ í™”ì‚´ì„ ë°œì‚¬í•˜ì—¬ ì ì„ ì–¼ë ¤ ì´ë™ì†ë„ë¥¼ ê°ì†Œì‹œí‚µë‹ˆë‹¤.',
                'Lightning': 'ë²ˆê°œë¥¼ ì†Œí™˜í•˜ì—¬ ì ì„ ê´€í†µí•˜ë©° ì—°ì‡„ í”¼í•´ë¥¼ ì…í™ë‹ˆë‹¤.',
                'Heal': 'ì²´ë ¥ì„ íšŒë³µí•˜ê³  ìƒíƒœì´ìƒì„ ì¹˜ë£Œí•©ë‹ˆë‹¤.',
                'Shield': 'ë§ˆë²• ë°©ì–´ë§‰ì„ ìƒì„±í•˜ì—¬ í”¼í•´ë¥¼ í¡ìˆ˜í•©ë‹ˆë‹¤.',
                'Meteor': 'í•˜ëŠ˜ì—ì„œ ìš´ì„ì„ ë–¨ì–´ëœ¨ë ¤ ê´‘ì—­ í”¼í•´ë¥¼ ì…í™ë‹ˆë‹¤.',
                'Blizzard': 'ëˆˆë³´ë¼ë¥¼ ì¼ìœ¼ì¼œ ê´‘ë²”ìœ„í•œ ë¹™ê²° í”¼í•´ë¥¼ ì…í™ë‹ˆë‹¤.',
                'Earthquake': 'ëŒ€ì§€ë¥¼ í”ë“¤ì–´ ëª¨ë“  ì ì—ê²Œ í”¼í•´ë¥¼ ì…í™ë‹ˆë‹¤.',
                'Wind Blade': 'ë°”ëŒ ì¹¼ë‚ ë¡œ ì ì„ ë² ì–´ ì¶œí˜ˆ íš¨ê³¼ë¥¼ ë¶€ì—¬í•©ë‹ˆë‹¤.',
                'Holy Light': 'ì‹ ì„±í•œ ë¹›ìœ¼ë¡œ ì–¸ë°ë“œì—ê²Œ ì¶”ê°€ í”¼í•´ë¥¼ ì…í™ë‹ˆë‹¤.',
                'Dark Magic': 'ì–´ë‘ ì˜ í˜ìœ¼ë¡œ ì ì˜ ìƒëª…ë ¥ì„ í¡ìˆ˜í•©ë‹ˆë‹¤.',
                'Teleport': 'ì¦‰ì‹œ ë‹¤ë¥¸ ìœ„ì¹˜ë¡œ ìˆœê°„ì´ë™í•©ë‹ˆë‹¤.',
                'Time Stop': 'ì‹œê°„ì„ ì •ì§€ì‹œì¼œ ì ì˜ ì›€ì§ì„ì„ ë©ˆì¶¥ë‹ˆë‹¤.',
                'Phoenix': 'ë¶ˆì‚¬ì¡°ë¥¼ ì†Œí™˜í•˜ì—¬ ì¬ìƒê³¼ í™”ì—¼ í”¼í•´ë¥¼ ë™ì‹œì— ì œê³µí•©ë‹ˆë‹¤.',
                'Dragon Breath': 'ìš©ì˜ ìˆ¨ê²°ë¡œ ì§ì„ ìƒì˜ ëª¨ë“  ì ì„ ë¶ˆíƒœì›ë‹ˆë‹¤.'
            };

            const skillElement = document.getElementById('skillElement');
            const skillDescription = document.getElementById('skillDescription');

            if (skillElement) {
                skillElement.textContent = elementNames[skill.element] || 'ì•Œ ìˆ˜ ì—†ëŠ” ì†ì„±';
                skillElement.style.color = isFinal ? '#ff9800' : 'rgba(255, 152, 0, 0.7)';
            }

            if (skillDescription) {
                skillDescription.textContent = isFinal ?
                    (skillDescriptions[skill.name] || 'ìŠ¤í‚¬ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.') :
                    'ìŠ¤í‚¬ ë¶„ì„ ì¤‘...';
                skillDescription.style.color = isFinal ? 'rgba(255, 255, 255, 0.9)' : 'rgba(255, 255, 255, 0.5)';
            }
        }

        function displayFinalSkillResult(skill, accuracy) {
            // ìµœì¢… ê²°ê³¼ë¥¼ ì• ë‹ˆë©”ì´ì…˜ê³¼ í•¨ê»˜ í‘œì‹œ
            displaySkillNameWithAnimation(skill, accuracy);

            // ê²°ê³¼ ë‹¨ê³„ë¡œ ì „í™˜
            voiceCurrentStage = 2;
            showVoiceStage(2);

            // ìµœì¢… ì •í™•ë„ í‘œì‹œ
            const accuracyElement = document.getElementById('accuracyPercent');
            if (accuracyElement) {
                accuracyElement.textContent = accuracy + '%';
            }
        }

        function updateRightPanelInfo(skill, accuracy) {
            updateAccuracyDisplay(accuracy, true);
            updateSkillInfo(skill, true);
        }

        function updateProgressStatus(status, percentage = 0) {
            const statusElement = document.getElementById('voiceMainTitle');
            const progressFill = document.getElementById('progressFill');
            const progressPercent = document.getElementById('progressPercent');

            if (statusElement) statusElement.textContent = status;

            if (percentage > 0) {
                if (progressFill) progressFill.style.width = percentage + '%';
                if (progressPercent) progressPercent.textContent = percentage + '%';
            }
        }

        function showListeningState() {
            updateProgressStatus('LISTENING...', 25);

            // ìŒì„± íŒŒí˜• ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘
            const soundWaves = document.getElementById('soundWaves');
            if (soundWaves) {
                soundWaves.style.display = 'flex';
                soundWaves.classList.add('listening');
            }

            // ì•„ì´ì½˜ ë³€ê²½
            const voiceIcon = document.getElementById('voiceIcon');
            if (voiceIcon) voiceIcon.textContent = 'REC';

            // ì •í™•ë„ ì„¹ì…˜ ìˆ¨ê¸°ê¸°
            const accuracySection = document.getElementById('accuracySection');
            const skillInfoSection = document.getElementById('skillInfoSection');
            if (accuracySection) accuracySection.style.display = 'none';
            if (skillInfoSection) skillInfoSection.style.display = 'none';
        }

        function showProcessingState() {
            updateProgressStatus('PROCESSING...', 75);

            // íŒŒí˜• ì• ë‹ˆë©”ì´ì…˜ ë³€ê²½
            const soundWaves = document.getElementById('soundWaves');
            if (soundWaves) {
                soundWaves.classList.remove('listening');
                soundWaves.classList.add('processing');
            }

            // ì•„ì´ì½˜ ë³€ê²½
            const voiceIcon = document.getElementById('voiceIcon');
            if (voiceIcon) voiceIcon.textContent = 'PROC';
        }

        function showCompletedState() {
            updateProgressStatus('COMPLETED', 100);

            // íŒŒí˜• ì• ë‹ˆë©”ì´ì…˜ ì™„ë£Œ ìƒíƒœ
            const soundWaves = document.getElementById('soundWaves');
            if (soundWaves) {
                soundWaves.classList.remove('listening', 'processing');
                soundWaves.classList.add('completed');

                // 3ì´ˆ í›„ ì• ë‹ˆë©”ì´ì…˜ ì´ˆê¸°í™”
                setTimeout(() => {
                    soundWaves.style.display = 'none';
                    soundWaves.classList.remove('completed');
                }, 3000);
            }

            // ì•„ì´ì½˜ ë³€ê²½
            const voiceIcon = document.getElementById('voiceIcon');
            if (voiceIcon) voiceIcon.textContent = 'DONE';
        }

        function showVoiceStage(stageNumber) {
            if (stageNumber === 1) {
                // ë“£ê¸° ë‹¨ê³„ ì‹œì‘
                showListeningState();

                // ì²« ë²ˆì§¸ ë‹¨ê³„: ì¤€ë¹„ -> ì¸ì‹ ì¤‘ìœ¼ë¡œ ì œëª© ë³€ê²½
                setTimeout(() => {
                    updateProgressStatus('VOICE RECOGNITION...', 25);
                }, 1000);

                // 1ì´ˆ í›„ ì§„í–‰ë°” ì—…ë°ì´íŠ¸
                setTimeout(() => {
                    updateProgressStatus('RECEIVING AUDIO...', 50);
                }, 2000);

                // 3ì´ˆ í›„ ì™„ì „í•œ ì§„í–‰
                setTimeout(() => {
                    updateProgressStatus('PROCESSING AUDIO...', 75);
                }, 3000);
            } else if (stageNumber === 2) {
                // ê²°ê³¼ ë‹¨ê³„ - ì™„ë£Œ ìƒíƒœë¡œ ì „í™˜
                showCompletedState();

                // ê²°ê³¼ í‘œì‹œ í›„ ì •ë³´ ì„¹ì…˜ë“¤ ë³´ì´ê¸°
                setTimeout(() => {
                    const accuracySection = document.getElementById('accuracySection');
                    const skillInfoSection = document.getElementById('skillInfoSection');
                    if (accuracySection) accuracySection.style.display = 'block';
                    if (skillInfoSection) skillInfoSection.style.display = 'block';
                }, 500);
            }
        }

        // ìë™ìœ¼ë¡œ 4ì´ˆ í›„ ë‹«ê¸°
        function autoCloseVoice() {
            setTimeout(() => {
                hidePopup('voicePopup');
                voiceIsProcessing = false;
            }, 4000);
        }

        // ========== ëŒ€í™” ì‹œìŠ¤í…œ ==========
        let dialogueSystem = {
            isActive: false,
            currentDialogue: null,
            currentIndex: 0,
            isTyping: false,
            typingSpeed: 50, // ê¸€ìë‹¹ ms

            // ëŒ€í™” ë°ì´í„° ì˜ˆì‹œ
            sampleDialogues: {
                intro: [
                    {
                        character: 'narrator',
                        name: 'ë‚˜ë ˆì´ì…˜',
                        text: 'ì–´ë‘  ì†ì—ì„œ ìƒˆë¡œìš´ ëª¨í—˜ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¹ì‹ ì€ ê³ ëŒ€ ë§ˆë²•ì˜ í˜ì„ ê°€ì§„ ë§ˆë²•ì‚¬ì…ë‹ˆë‹¤.'
                    },
                    {
                        character: 'player',
                        name: 'í”Œë ˆì´ì–´',
                        text: 'ì´ê³³ì€... ì–´ë””ì¸ê°€? ì´ìƒí•œ ê¸°ìš´ì´ ëŠê»´ì§„ë‹¤.'
                    },
                    {
                        character: 'narrator',
                        name: 'ë‚˜ë ˆì´ì…˜',
                        text: 'ê°‘ìê¸° ì–´ë‘  ì†ì—ì„œ ë¶‰ì€ ëˆˆì´ ë¹›ë‚˜ê¸° ì‹œì‘í•©ë‹ˆë‹¤. ê°•ë ¥í•œ ë³´ìŠ¤ê°€ ë‚˜íƒ€ë‚¬ìŠµë‹ˆë‹¤!'
                    },
                    {
                        character: 'boss',
                        name: 'ì–´ë‘ ì˜ êµ°ì£¼',
                        text: 'ì˜¤ëœë§Œì´êµ°... ì¸ê°„ì´ì—¬. ì´ê³³ì€ ë„¤ê°€ ì˜¬ ê³³ì´ ì•„ë‹ˆë‹¤. ëŒì•„ê°€ê±°ë¼!'
                    },
                    {
                        character: 'player',
                        name: 'í”Œë ˆì´ì–´',
                        text: 'ë¬¼ëŸ¬ì„œì§€ ì•Šê² ë‹¤. ì´ ì„¸ê³„ë¥¼ êµ¬í•˜ê¸° ìœ„í•´ ì™”ë‹¤!'
                    }
                ],

                battle: [
                    {
                        character: 'boss',
                        name: 'ì–´ë‘ ì˜ êµ°ì£¼',
                        text: 'ì–´ë¦¬ì„ì€ ê²ƒ... ê·¸ë ‡ë‹¤ë©´ ë‚´ í˜ì„ ë³´ì—¬ì£¼ë§ˆ!'
                    },
                    {
                        character: 'narrator',
                        name: 'ë‚˜ë ˆì´ì…˜',
                        text: 'ì „íˆ¬ê°€ ì‹œì‘ë©ë‹ˆë‹¤! ìŒì„±ìœ¼ë¡œ ìŠ¤í‚¬ì„ ì‹œì „í•˜ì—¬ ë³´ìŠ¤ë¥¼ ë¬¼ë¦¬ì¹˜ì„¸ìš”.'
                    }
                ]
            }
        };

        // ëŒ€í™” ì‹œì‘
        function startDialogue(dialogueKey) {
            const dialogueData = dialogueSystem.sampleDialogues[dialogueKey];
            if (!dialogueData) return;

            dialogueSystem.isActive = true;
            dialogueSystem.currentDialogue = dialogueData;
            dialogueSystem.currentIndex = 0;

            document.getElementById('dialogueBox').style.display = 'block';
            showCurrentDialogue();
        }

        // í˜„ì¬ ëŒ€í™” í‘œì‹œ
        function showCurrentDialogue() {
            const dialogue = dialogueSystem.currentDialogue[dialogueSystem.currentIndex];
            const characterElement = document.querySelector('.dialogue-character');
            const portraitElement = document.getElementById('characterPortrait');
            const nameElement = document.getElementById('characterName');
            const typeElement = document.getElementById('characterType');
            const textElement = document.getElementById('dialogueText');
            const counterElement = document.getElementById('dialogueCounter');

            // ìºë¦­í„° ì •ë³´ ì—…ë°ì´íŠ¸
            characterElement.className = `dialogue-character ${dialogue.character}`;
            nameElement.textContent = dialogue.name;

            // ìºë¦­í„° íƒ€ì…ê³¼ í¬íŠ¸ë ˆì´íŠ¸ ì„¤ì •
            switch (dialogue.character) {
                case 'narrator':
                    typeElement.textContent = 'NARRATOR';
                    portraitElement.textContent = 'ğŸ“–';
                    break;
                case 'player':
                    typeElement.textContent = 'PLAYER';
                    portraitElement.textContent = 'âš”ï¸';
                    break;
                case 'boss':
                    typeElement.textContent = 'BOSS';
                    portraitElement.textContent = 'ğŸ‘¹';
                    break;
            }

            // ì§„í–‰ë„ ì—…ë°ì´íŠ¸
            counterElement.textContent = `${dialogueSystem.currentIndex + 1} / ${dialogueSystem.currentDialogue.length}`;

            // íƒ€ì´í•‘ íš¨ê³¼ë¡œ í…ìŠ¤íŠ¸ í‘œì‹œ
            typeText(dialogue.text, textElement);
        }

        // íƒ€ì´í•‘ íš¨ê³¼
        function typeText(text, element) {
            dialogueSystem.isTyping = true;
            element.textContent = '';
            element.classList.add('typing');

            let i = 0;
            function typeCharacter() {
                if (i < text.length) {
                    element.textContent += text.charAt(i);
                    i++;
                    setTimeout(typeCharacter, dialogueSystem.typingSpeed);
                } else {
                    element.classList.remove('typing');
                    dialogueSystem.isTyping = false;
                }
            }

            typeCharacter();
        }

        // ë‹¤ìŒ ëŒ€í™”ë¡œ ì§„í–‰
        function nextDialogue() {
            if (!dialogueSystem.isActive) return;

            // íƒ€ì´í•‘ ì¤‘ì´ë©´ ì¦‰ì‹œ ì™„ë£Œ
            if (dialogueSystem.isTyping) {
                dialogueSystem.isTyping = false;
                const dialogue = dialogueSystem.currentDialogue[dialogueSystem.currentIndex];
                document.getElementById('dialogueText').textContent = dialogue.text;
                document.getElementById('dialogueText').classList.remove('typing');
                return;
            }

            // ë‹¤ìŒ ëŒ€í™”ë¡œ ì§„í–‰
            dialogueSystem.currentIndex++;

            if (dialogueSystem.currentIndex < dialogueSystem.currentDialogue.length) {
                showCurrentDialogue();
            } else {
                endDialogue();
            }
        }

        // ëŒ€í™” ì¢…ë£Œ
        function endDialogue() {
            dialogueSystem.isActive = false;
            dialogueSystem.currentDialogue = null;
            dialogueSystem.currentIndex = 0;
            document.getElementById('dialogueBox').style.display = 'none';
        }

        // ëŒ€í™” ê±´ë„ˆë›°ê¸°
        function skipDialogue() {
            if (dialogueSystem.isActive) {
                endDialogue();
            }
        }

        // ë£¬ì—…ê·¸ë ˆì´ë“œ ê´€ë ¨ ë³€ìˆ˜
        let runeCount = 50;

        function upgradeSkill(skillName, cost) {
            if (runeCount >= cost) {
                runeCount -= cost;
                document.getElementById('runeCount').textContent = runeCount;

                // ì—…ê·¸ë ˆì´ë“œ íš¨ê³¼ í‘œì‹œ
                showUpgradeEffect(skillName);

                // í•´ë‹¹ ìŠ¤í‚¬ ì¹´ë“œ ì—…ë°ì´íŠ¸ (ì„ íƒì‚¬í•­)
                console.log(`${skillName} ìŠ¤í‚¬ì´ ì—…ê·¸ë ˆì´ë“œë˜ì—ˆìŠµë‹ˆë‹¤!`);
            } else {
                alert('ë£¬ì„ì´ ë¶€ì¡±í•©ë‹ˆë‹¤!');
            }
        }

        function showUpgradeEffect(skillName) {
            // ê°„ë‹¨í•œ ì—…ê·¸ë ˆì´ë“œ íš¨ê³¼ ì• ë‹ˆë©”ì´ì…˜
            const skillCard = document.querySelector(`[data-skill="${skillName}"]`);
            if (skillCard) {
                skillCard.style.transform = 'scale(1.05)';
                skillCard.style.boxShadow = '0 0 30px rgba(76, 175, 80, 0.8)';

                setTimeout(() => {
                    skillCard.style.transform = '';
                    skillCard.style.boxShadow = '';
                }, 500);
            }
        }
    </script>
</body>

</html>