<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lost Spells - Í≤åÏûÑ ÌîåÎ†àÏù¥</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="game-container">
        <!-- ÏÉÅÎã® Ìó§Îçî -->
        <header class="game-header">
            <div class="header-left">
                <button class="menu-btn">
                    <span class="menu-icon">‚ò∞</span>
                </button>
                <div class="chapter-info">
                    <span class="chapter-icon">üìö</span>
                    <span class="chapter-name">Chapter 1: ÏûäÌòÄÏßÑ Ïà≤</span>
                </div>
            </div>

            <div class="header-center">
                <div class="wave-info">
                    <span class="wave-icon">‚ö°</span>
                    <span class="wave-text">Wave</span>
                    <span class="wave-number">3</span>
                    <span class="wave-separator">/</span>
                    <span class="wave-total">10</span>
                </div>
                <div class="enemies-info">
                    <span class="enemies-icon">üëπ</span>
                    <span class="enemies-text">ÎÇ®ÏùÄ Ï†Å</span>
                    <span class="enemies-number">7</span>
                </div>
            </div>

            <div class="header-right">
                <div class="score-info">
                    <span class="score-icon">‚≠ê</span>
                    <span class="score-label">Score</span>
                    <span class="score-number">12,450</span>
                </div>
            </div>
        </header>

        <!-- Î©îÏù∏ Í≤åÏûÑ ÏòÅÏó≠ -->
        <main class="game-area">
            <!-- HP/MP Î∞î -->
            <div class="health-mana-bars">
                <div class="health-bar-container">
                    <span class="bar-icon">‚ù§Ô∏è</span>
                    <span class="bar-text">HP</span>
                    <div class="health-bar">
                        <div class="health-fill" style="width: 85%"></div>
                        <span class="bar-value-overlay">85 / 100</span>
                    </div>
                </div>

                <div class="mana-bar-container">
                    <span class="bar-icon">üß™</span>
                    <span class="bar-text">MP</span>
                    <div class="mana-bar">
                        <div class="mana-fill" style="width: 56.25%"></div>
                        <span class="bar-value-overlay">45 / 80</span>
                    </div>
                </div>
            </div>

            <div class="game-screen">
                <!-- Í≤åÏûÑ ÌôîÎ©¥ -->
                <div class="game-placeholder">
                    <!-- Í≤åÏûÑ ÌôîÎ©¥Ïù¥ Ïó¨Í∏∞Ïóê Î†åÎçîÎßÅÎê©ÎãàÎã§ -->
                </div>


            </div>

            <!-- ÌåùÏóÖ Ïò§Î≤ÑÎ†àÏù¥Îì§ -->
            <div class="popup-overlay" id="voicePopup">
                <div class="voice-container">
                    <!-- ÏôºÏ™Ω: ÏãúÍ∞ÅÏ†Å ÌîºÎìúÎ∞± -->
                    <div class="voice-left-panel">
                        <div class="voice-header">
                            <div class="voice-icon" id="voiceIcon">MIC</div>
                            <div class="voice-status-text" id="voiceMainTitle">ÏùåÏÑ± Ïù∏Ïãù Ï§ë...</div>
                        </div>

                        <div class="sound-waves" id="soundWaves">
                            <div class="wave-bar"></div>
                            <div class="wave-bar"></div>
                            <div class="wave-bar"></div>
                            <div class="wave-bar"></div>
                            <div class="wave-bar"></div>
                            <div class="wave-bar"></div>
                            <div class="wave-bar"></div>
                            <div class="wave-bar"></div>
                            <div class="wave-bar"></div>
                            <div class="wave-bar"></div>
                            <div class="wave-bar"></div>
                            <div class="wave-bar"></div>
                            <div class="wave-bar"></div>
                            <div class="wave-bar"></div>
                            <div class="wave-bar"></div>
                        </div>

                        <div class="voice-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" id="progressFill"></div>
                            </div>
                            <div class="progress-percent" id="progressPercent">0%</div>
                        </div>
                    </div>

                    <!-- Ïò§Î•∏Ï™Ω: Í≤∞Í≥º Î∞è Ï†ïÎ≥¥ -->
                    <div class="voice-right-panel">
                        <!-- Ïù∏Ïãù Í≤∞Í≥º -->
                        <div class="result-display">
                            <div class="result-title" id="resultTitle">Ïä§ÌÇ¨ Î∂ÑÏÑù Ï§ë...</div>
                            <div class="skill-name-result" id="skillNameResult">
                                <!-- ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ±Îê† Í∏ÄÏûêÎì§ -->
                            </div>
                        </div>

                        <!-- Ï†ïÌôïÎèÑ -->
                        <div class="accuracy-info" id="accuracySection" style="display: none;">
                            <div class="accuracy-title">Ï†ïÌôïÎèÑ: <span id="accuracyPercent">0%</span></div>
                            <div class="accuracy-grid">
                                <div class="accuracy-item">
                                    <span class="label">Î∞úÏùå</span>
                                    <span id="pronunciationScore" class="value">0%</span>
                                </div>
                                <div class="accuracy-item">
                                    <span class="label">ÏÜçÎèÑ</span>
                                    <span id="speedScore" class="value">0%</span>
                                </div>
                                <div class="accuracy-item">
                                    <span class="label">Î™ÖÎ£åÎèÑ</span>
                                    <span id="clarityScore" class="value">0%</span>
                                </div>
                            </div>
                        </div>

                        <!-- Ïä§ÌÇ¨ Ï†ïÎ≥¥ -->
                        <div class="skill-info" id="skillInfoSection" style="display: none;">
                            <div id="skillElement" class="skill-element">ÌôîÏóº ÏÜçÏÑ±</div>
                            <div id="skillDescription" class="skill-desc">Ïä§ÌÇ¨ ÏÑ§Î™ÖÏù¥ ÌëúÏãúÎê©ÎãàÎã§</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ÎåÄÌôîÏ∞Ω UI -->
            <div class="dialogue-overlay" id="dialogueBox" style="display: none;">
                <div class="dialogue-container">
                    <div class="dialogue-content">
                        <!-- Ï∫êÎ¶≠ÌÑ∞ Ï†ïÎ≥¥ -->
                        <div class="dialogue-character">
                            <div class="character-portrait" id="characterPortrait">
                                <!-- Ï∫êÎ¶≠ÌÑ∞ Ïù¥ÎØ∏ÏßÄÍ∞Ä Îì§Ïñ¥Í∞à Í≥≥ -->
                            </div>
                            <div class="character-info">
                                <div class="character-name" id="characterName">ÎÇòÎ†àÏù¥ÏÖò</div>
                                <div class="character-type" id="characterType">NARRATOR</div>
                            </div>
                        </div>

                        <!-- ÎåÄÏÇ¨ ÏòÅÏó≠ -->
                        <div class="dialogue-text-area">
                            <div class="dialogue-text" id="dialogueText">
                                ÏïàÎÖïÌïòÏÑ∏Ïöî. Ïù¥Í≤ÉÏùÄ ÎåÄÌôî ÏãúÏä§ÌÖú ÌÖåÏä§Ìä∏ÏûÖÎãàÎã§.
                            </div>
                        </div>

                        <!-- Ïª®Ìä∏Î°§ ÏòÅÏó≠ -->
                        <div class="dialogue-controls">
                            <div class="dialogue-progress">
                                <span class="dialogue-counter" id="dialogueCounter">1 / 5</span>
                            </div>
                            <div class="dialogue-hints">
                                <span class="control-hint">SPACE: Îã§Ïùå ÎåÄÌôî</span>
                                <span class="control-hint">ESC: ÎåÄÌôî Í±¥ÎÑàÎõ∞Í∏∞</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>



            <div class="popup-overlay" id="skillPopup">
                <div class="skill-container">
                    <!-- Îí§Î°úÍ∞ÄÍ∏∞ Î≤ÑÌäº -->
                    <button class="back-btn" onclick="hidePopup('skillPopup')">
                        <span class="back-icon">‚Üê</span>
                        <span class="back-text">Í≤åÏûÑÏúºÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞</span>
                    </button>

                    <!-- Ïä§ÌÇ¨Î∂Å Ìó§Îçî -->
                    <div class="skill-header">
                        <h2 class="skill-title">
                            <span class="skill-icon">‚ú®</span>
                            Ïä§ÌÇ¨ Î∂Å
                        </h2>
                        <div class="skill-controls">
                            <span>WASD: Ïù¥Îèô | Q/E: Ïπ¥ÌÖåÍ≥†Î¶¨ | ESC: ÎèåÏïÑÍ∞ÄÍ∏∞</span>
                        </div>
                    </div>

                    <div class="skill-content">
                        <!-- Ïπ¥ÌÖåÍ≥†Î¶¨ -->
                        <div class="skill-categories">
                            <div class="skill-category active" data-category="all">
                                <span class="category-icon">üìã</span>
                                <span class="category-name">Ï†ÑÏ≤¥</span>
                            </div>
                            <div class="skill-category" data-category="attack">
                                <span class="category-icon">‚öîÔ∏è</span>
                                <span class="category-name">Í≥µÍ≤©</span>
                            </div>
                            <div class="skill-category" data-category="defense">
                                <span class="category-icon">üõ°Ô∏è</span>
                                <span class="category-name">Î∞©Ïñ¥</span>
                            </div>
                            <div class="skill-category" data-category="healing">
                                <span class="category-icon">üíö</span>
                                <span class="category-name">ÏπòÏú†</span>
                            </div>
                        </div>

                        <!-- Ïä§ÌÇ¨ Í∑∏Î¶¨Îìú -->
                        <div class="skill-grid" id="skillGrid">
                            <!-- Í≥µÍ≤© Ïä§ÌÇ¨ -->
                            <div class="skill-card unlocked" data-category="attack">
                                <div class="skill-card-icon">üî•</div>
                                <div class="skill-card-name">Fireball</div>
                                <div class="skill-card-level">Lv.3</div>
                                <div class="skill-card-pronunciation">üîä "ÌååÏù¥Ïñ¥Î≥º"</div>
                                <div class="skill-card-desc">ÌôîÏóº Íµ¨Ï≤¥Î•º Î∞úÏÇ¨ÌïòÏó¨ Ï†ÅÏùÑ Í≥µÍ≤©Ìï©ÎãàÎã§</div>
                                <div class="skill-card-stats">
                                    <div class="stat">Í≥µÍ≤©Î†•: <span class="stat-damage">120</span></div>
                                    <div class="stat">ÎßàÎÇò: <span class="stat-mana">25</span></div>
                                </div>
                            </div>

                            <div class="skill-card unlocked" data-category="attack">
                                <div class="skill-card-icon">‚ùÑÔ∏è</div>
                                <div class="skill-card-name">Ice Bolt</div>
                                <div class="skill-card-level">Lv.2</div>
                                <div class="skill-card-pronunciation">üîä "ÏïÑÏù¥Ïä§ Î≥ºÌä∏"</div>
                                <div class="skill-card-desc">ÏñºÏùå ÌôîÏÇ¥ÏùÑ Î∞úÏÇ¨ÌïòÏó¨ Ï†ÅÏùÑ ÎßàÎπÑÏãúÌÇµÎãàÎã§</div>
                                <div class="skill-card-stats">
                                    <div class="stat">Í≥µÍ≤©Î†•: <span class="stat-damage">100</span></div>
                                    <div class="stat">ÎßàÎÇò: <span class="stat-mana">20</span></div>
                                </div>
                            </div>

                            <div class="skill-card unlocked" data-category="attack">
                                <div class="skill-card-icon">‚ö°</div>
                                <div class="skill-card-name">Lightning Bolt</div>
                                <div class="skill-card-level">Lv.2</div>
                                <div class="skill-card-pronunciation">üîä "ÎùºÏù¥Ìä∏Îãù Î≥ºÌä∏"</div>
                                <div class="skill-card-desc">Î≤àÍ∞úÎ•º Î∞úÏÇ¨ÌïòÏó¨ Ï†ÅÏùÑ Í∞êÏ†ÑÏãúÌÇµÎãàÎã§</div>
                                <div class="skill-card-stats">
                                    <div class="stat">Í≥µÍ≤©Î†•: <span class="stat-damage">140</span></div>
                                    <div class="stat">ÎßàÎÇò: <span class="stat-mana">30</span></div>
                                </div>
                            </div>

                            <div class="skill-card locked" data-category="attack">
                                <div class="skill-card-icon">üîí</div>
                                <div class="skill-card-name">Meteor</div>
                                <div class="skill-card-level">Ïû†ÍπÄ</div>
                                <div class="skill-card-pronunciation">üîä "Î©îÌÖåÏò§"</div>
                                <div class="skill-card-desc">Î†àÎ≤® 15 Îã¨ÏÑ± Ïãú Ìï¥Ï†úÎê©ÎãàÎã§</div>
                                <div class="skill-card-stats">
                                    <div class="stat">Í≥µÍ≤©Î†•: <span class="stat-damage">300</span></div>
                                    <div class="stat">ÎßàÎÇò: <span class="stat-mana">60</span></div>
                                </div>
                            </div>

                            <!-- Î∞©Ïñ¥ Ïä§ÌÇ¨ -->
                            <div class="skill-card unlocked" data-category="defense">
                                <div class="skill-card-icon">üõ°Ô∏è</div>
                                <div class="skill-card-name">Magic Shield</div>
                                <div class="skill-card-level">Lv.4</div>
                                <div class="skill-card-pronunciation">üîä "Îß§ÏßÅ Ïâ¥Îìú"</div>
                                <div class="skill-card-desc">ÎßàÎ≤ï Î∞©Ïñ¥ÎßâÏùÑ ÏÉùÏÑ±ÌïòÏó¨ ÌîºÌï¥Î•º Í∞êÏÜåÏãúÌÇµÎãàÎã§</div>
                                <div class="skill-card-stats">
                                    <div class="stat">Î∞©Ïñ¥Î†•: <span class="stat-defense">80</span></div>
                                    <div class="stat">ÎßàÎÇò: <span class="stat-mana">35</span></div>
                                </div>
                            </div>

                            <div class="skill-card unlocked" data-category="defense">
                                <div class="skill-card-icon">üí®</div>
                                <div class="skill-card-name">Wind Barrier</div>
                                <div class="skill-card-level">Lv.2</div>
                                <div class="skill-card-pronunciation">üîä "ÏúàÎìú Î∞∞Î¶¨Ïñ¥"</div>
                                <div class="skill-card-desc">Î∞îÎûå Î∞©Î≤ΩÏùÑ ÎßåÎì§Ïñ¥ Ìà¨ÏÇ¨Ï≤¥Î•º ÎßâÏäµÎãàÎã§</div>
                                <div class="skill-card-stats">
                                    <div class="stat">Î∞©Ïñ¥Î†•: <span class="stat-defense">60</span></div>
                                    <div class="stat">ÎßàÎÇò: <span class="stat-mana">25</span></div>
                                </div>
                            </div>

                            <!-- ÏπòÏú† Ïä§ÌÇ¨ -->
                            <div class="skill-card unlocked" data-category="healing">
                                <div class="skill-card-icon">üíö</div>
                                <div class="skill-card-name">Heal</div>
                                <div class="skill-card-level">Lv.5</div>
                                <div class="skill-card-pronunciation">üîä "Ìûê"</div>
                                <div class="skill-card-desc">Ï≤¥Î†•ÏùÑ ÌöåÎ≥µÌï©ÎãàÎã§</div>
                                <div class="skill-card-stats">
                                    <div class="stat">ÌöåÎ≥µÎüâ: <span class="stat-healing">150</span></div>
                                    <div class="stat">ÎßàÎÇò: <span class="stat-mana">40</span></div>
                                </div>
                            </div>

                            <div class="skill-card unlocked" data-category="healing">
                                <div class="skill-card-icon">üåü</div>
                                <div class="skill-card-name">Regeneration</div>
                                <div class="skill-card-level">Lv.3</div>
                                <div class="skill-card-pronunciation">üîä "Î¶¨Ï†úÎÑàÎ†àÏù¥ÏÖò"</div>
                                <div class="skill-card-desc">ÏßÄÏÜçÏ†ÅÏúºÎ°ú Ï≤¥Î†•ÏùÑ ÌöåÎ≥µÌï©ÎãàÎã§</div>
                                <div class="skill-card-stats">
                                    <div class="stat">ÌöåÎ≥µÎüâ: <span class="stat-healing">30/Ï¥à</span></div>
                                    <div class="stat">ÎßàÎÇò: <span class="stat-mana">50</span></div>
                                </div>
                            </div>

                            <div class="skill-card locked" data-category="healing">
                                <div class="skill-card-icon">üîí</div>
                                <div class="skill-card-name">Resurrection</div>
                                <div class="skill-card-level">Ïû†ÍπÄ</div>
                                <div class="skill-card-pronunciation">üîä "Î†àÏ†ÄÎ†âÏÖò"</div>
                                <div class="skill-card-desc">Î†àÎ≤® 20 Îã¨ÏÑ± Ïãú Ìï¥Ï†úÎê©ÎãàÎã§</div>
                                <div class="skill-card-stats">
                                    <div class="stat">ÌöåÎ≥µÎüâ: <span class="stat-healing">Full</span></div>
                                    <div class="stat">ÎßàÎÇò: <span class="stat-mana">100</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="popup-overlay" id="runePopup">
                <div class="rune-container">
                    <!-- Îí§Î°úÍ∞ÄÍ∏∞ Î≤ÑÌäº -->
                    <button class="back-btn" onclick="hidePopup('runePopup')">
                        <span class="back-icon">‚Üê</span>
                        <span class="back-text">Í≤åÏûÑÏúºÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞</span>
                    </button>

                    <!-- Î£¨ ÏóÖÍ∑∏Î†àÏù¥Îìú Ìó§Îçî -->
                    <div class="rune-header">
                        <div class="rune-title">
                            <span class="rune-icon">üîÆ</span>
                            <h2>Î£¨ ÏóÖÍ∑∏Î†àÏù¥Îìú</h2>
                        </div>
                        <div class="rune-currency">
                            <span class="rune-stone-icon">üîÆ</span>
                            <span class="rune-count" id="runeCount">50</span>
                            <span class="rune-text">Î£¨ÏÑù</span>
                        </div>
                    </div>

                    <div class="rune-content">
                        <div class="rune-description">
                            <p>Ïõ®Ïù¥Î∏å ÌÅ¥Î¶¨Ïñ¥ Î≥¥ÏÉÅÏúºÎ°ú Î£¨ÏÑùÏùÑ ÌöçÎìùÌñàÏäµÎãàÎã§!</p>
                            <p>Ïä§ÌÇ¨ÏùÑ Í∞ïÌôîÌïòÍ±∞ÎÇò ÏÉàÎ°úÏö¥ Ïä§ÌÇ¨ÏùÑ Ìï¥Ï†úÌïòÏÑ∏Ïöî.</p>
                        </div>

                        <!-- Ïä§ÌÇ¨ ÏóÖÍ∑∏Î†àÏù¥Îìú Î¶¨Ïä§Ìä∏ -->
                        <div class="rune-skills" id="runeSkills">
                            <!-- Ìï¥Ï†úÎêú Ïä§ÌÇ¨Îì§ -->
                            <div class="skill-upgrade-card" data-skill="fireball">
                                <div class="skill-upgrade-header">
                                    <div class="skill-upgrade-info">
                                        <span class="skill-upgrade-icon">üî•</span>
                                        <div class="skill-upgrade-details">
                                            <div class="skill-upgrade-name">ÌååÏù¥Ïñ¥Î≥º</div>
                                            <div class="skill-upgrade-level">Level 3</div>
                                        </div>
                                    </div>
                                    <div class="skill-upgrade-cost">
                                        <span class="cost-icon">üîÆ</span>
                                        <span class="cost-amount">15</span>
                                    </div>
                                </div>
                                <div class="skill-upgrade-desc">Í≥µÍ≤©Î†•: 120 ‚Üí 150 (+25%)</div>
                                <button class="upgrade-btn" onclick="upgradeSkill('fireball', 15)">ÏóÖÍ∑∏Î†àÏù¥Îìú</button>
                            </div>

                            <div class="skill-upgrade-card" data-skill="icebolt">
                                <div class="skill-upgrade-header">
                                    <div class="skill-upgrade-info">
                                        <span class="skill-upgrade-icon">‚ùÑÔ∏è</span>
                                        <div class="skill-upgrade-details">
                                            <div class="skill-upgrade-name">ÏïÑÏù¥Ïä§ Î≥ºÌä∏</div>
                                            <div class="skill-upgrade-level">Level 2</div>
                                        </div>
                                    </div>
                                    <div class="skill-upgrade-cost">
                                        <span class="cost-icon">üîÆ</span>
                                        <span class="cost-amount">10</span>
                                    </div>
                                </div>
                                <div class="skill-upgrade-desc">Í≥µÍ≤©Î†•: 100 ‚Üí 130 (+30%)</div>
                                <button class="upgrade-btn" onclick="upgradeSkill('icebolt', 10)">ÏóÖÍ∑∏Î†àÏù¥Îìú</button>
                            </div>

                            <div class="skill-upgrade-card locked" data-skill="meteor">
                                <div class="skill-upgrade-header">
                                    <div class="skill-upgrade-info">
                                        <span class="skill-upgrade-icon">üîí</span>
                                        <div class="skill-upgrade-details">
                                            <div class="skill-upgrade-name">Î©îÌÖåÏò§</div>
                                            <div class="skill-upgrade-level">Ïû†Í∏àÎê®</div>
                                        </div>
                                    </div>
                                    <div class="skill-upgrade-cost">
                                        <span class="cost-icon">üîÆ</span>
                                        <span class="cost-amount">30</span>
                                    </div>
                                </div>
                                <div class="skill-upgrade-desc">Î†àÎ≤® 15 Îã¨ÏÑ± Ïãú Ìï¥Ï†ú Í∞ÄÎä•</div>
                                <button class="upgrade-btn disabled" disabled>Ïû†Í∏àÎê®</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ÏäπÎ¶¨ ÌåùÏóÖ -->
            <div class="popup-overlay" id="victoryPopup">
                <div class="victory-container">
                    <!-- ÏäπÎ¶¨ Ìó§Îçî -->
                    <div class="victory-header">
                        <div class="victory-title">
                            <span class="victory-crown">üëë</span>
                            <h2>VICTORY!</h2>
                            <span class="victory-crown">üëë</span>
                        </div>
                        <div class="victory-subtitle">Ï±ïÌÑ∞Î•º ÏÑ±Í≥µÏ†ÅÏúºÎ°ú ÏôÑÎ£åÌñàÏäµÎãàÎã§!</div>
                    </div>

                    <!-- ÏäπÎ¶¨ ÌÜµÍ≥Ñ -->
                    <div class="victory-stats">
                        <div class="stat-card score-stat">
                            <div class="stat-icon">‚≠ê</div>
                            <div class="stat-content">
                                <div class="stat-label">ÏµúÏ¢Ö Ï†êÏàò</div>
                                <div class="stat-value" id="finalScore">127,450</div>
                            </div>
                        </div>

                        <div class="stat-card wave-stat">
                            <div class="stat-icon">üåä</div>
                            <div class="stat-content">
                                <div class="stat-label">ÌÅ¥Î¶¨Ïñ¥Ìïú Ïõ®Ïù¥Î∏å</div>
                                <div class="stat-value" id="clearedWaves">10 / 10</div>
                            </div>
                        </div>

                        <div class="stat-card time-stat">
                            <div class="stat-icon">‚è∞</div>
                            <div class="stat-content">
                                <div class="stat-label">ÌîåÎ†àÏù¥ ÏãúÍ∞Ñ</div>
                                <div class="stat-value" id="playTime">15:34</div>
                            </div>
                        </div>
                    </div>

                    <!-- ÏÇ¨Ïö©Ìïú Ïä§ÌÇ¨ -->
                    <div class="used-skills-section">
                        <h3 class="skills-title">
                            <span class="skills-icon">‚ú®</span>
                            ÏÇ¨Ïö©Ìïú Ïä§ÌÇ¨
                        </h3>
                        <div class="skills-grid" id="usedSkillsGrid">
                            <div class="skill-usage-item">
                                <span class="skill-emoji">üî•</span>
                                <div class="skill-info">
                                    <span class="skill-name">ÌååÏù¥Ïñ¥Î≥º</span>
                                    <span class="skill-count">23Ìöå</span>
                                </div>
                                <div class="skill-accuracy">87%</div>
                            </div>
                            <div class="skill-usage-item">
                                <span class="skill-emoji">‚ùÑÔ∏è</span>
                                <div class="skill-info">
                                    <span class="skill-name">ÏïÑÏù¥Ïä§Î≥ºÌä∏</span>
                                    <span class="skill-count">18Ìöå</span>
                                </div>
                                <div class="skill-accuracy">92%</div>
                            </div>
                            <div class="skill-usage-item">
                                <span class="skill-emoji">‚ö°</span>
                                <div class="skill-info">
                                    <span class="skill-name">ÎùºÏù¥Ìä∏Îãù</span>
                                    <span class="skill-count">15Ìöå</span>
                                </div>
                                <div class="skill-accuracy">84%</div>
                            </div>
                            <div class="skill-usage-item">
                                <span class="skill-emoji">üíö</span>
                                <div class="skill-info">
                                    <span class="skill-name">Ìûê</span>
                                    <span class="skill-count">7Ìöå</span>
                                </div>
                                <div class="skill-accuracy">95%</div>
                            </div>
                        </div>
                    </div>

                    <!-- Î≥¥ÏÉÅ Ï†ïÎ≥¥ -->
                    <div class="rewards-section">
                        <h3 class="rewards-title">üéÅ ÌöçÎìùÌïú Î≥¥ÏÉÅ</h3>
                        <div class="rewards-grid">
                            <div class="reward-item">
                                <span class="reward-icon">üîÆ</span>
                                <div class="reward-info">
                                    <span class="reward-name">Î£¨ÏÑù</span>
                                    <span class="reward-amount" id="earnedRunes">+15</span>
                                </div>
                            </div>
                            <div class="reward-item">
                                <span class="reward-icon">üíé</span>
                                <div class="reward-info">
                                    <span class="reward-name">ÌÅ¨Î¶¨Ïä§ÌÉà</span>
                                    <span class="reward-amount" id="earnedCrystals">+2</span>
                                </div>
                            </div>
                            <div class="reward-item">
                                <span class="reward-icon">‚≠ê</span>
                                <div class="reward-info">
                                    <span class="reward-name">Í≤ΩÌóòÏπò</span>
                                    <span class="reward-amount" id="earnedExp">+850</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Ïï°ÏÖò Î≤ÑÌäºÎì§ -->
                    <div class="victory-actions">
                        <button class="victory-btn retry-btn" onclick="retryChapter()">
                            <span class="btn-icon">üîÑ</span>
                            <span class="btn-text">Îã§ÏãúÌïòÍ∏∞</span>
                        </button>
                        <button class="victory-btn next-btn" onclick="nextChapter()">
                            <span class="btn-icon">‚û°Ô∏è</span>
                            <span class="btn-text">Îã§Ïùå Ï±ïÌÑ∞</span>
                        </button>
                        <button class="victory-btn menu-btn" onclick="goToMainMenu()">
                            <span class="btn-icon">üè†</span>
                            <span class="btn-text">Î©îÏù∏ÏúºÎ°ú</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Í≤åÏûÑÏò§Î≤Ñ ÌåùÏóÖ -->
            <div class="popup-overlay" id="gameOverPopup">
                <div class="gameover-container">
                    <!-- Í≤åÏûÑÏò§Î≤Ñ Ìó§Îçî -->
                    <div class="gameover-header">
                        <div class="gameover-title">
                            <span class="gameover-skull">üíÄ</span>
                            <h2>GAME OVER</h2>
                            <span class="gameover-skull">üíÄ</span>
                        </div>
                        <div class="gameover-subtitle">Îã§ÏùåÏóêÎäî Îçî ÏûòÌï† Ïàò ÏûàÏùÑ Í±∞ÏòàÏöî!</div>
                    </div>

                    <!-- Í≤åÏûÑÏò§Î≤Ñ ÌÜµÍ≥Ñ -->
                    <div class="gameover-stats">
                        <div class="stat-card score-stat">
                            <div class="stat-icon">‚≠ê</div>
                            <div class="stat-content">
                                <div class="stat-label">ÏµúÏ¢Ö Ï†êÏàò</div>
                                <div class="stat-value" id="gameOverScore">45,230</div>
                            </div>
                        </div>

                        <div class="stat-card wave-stat">
                            <div class="stat-icon">üåä</div>
                            <div class="stat-content">
                                <div class="stat-label">ÎèÑÎã¨Ìïú Ïõ®Ïù¥Î∏å</div>
                                <div class="stat-value" id="gameOverWave">7 / 10</div>
                            </div>
                        </div>

                        <div class="stat-card time-stat">
                            <div class="stat-icon">‚è∞</div>
                            <div class="stat-content">
                                <div class="stat-label">ÌîåÎ†àÏù¥ ÏãúÍ∞Ñ</div>
                                <div class="stat-value" id="gameOverTime">8:42</div>
                            </div>
                        </div>
                    </div>

                    <!-- Ïã§Ìå® ÏõêÏù∏ -->
                    <div class="failure-reason-section">
                        <h3 class="failure-title">
                            <span class="failure-icon">üí•</span>
                            Ìå®Î∞∞ ÏõêÏù∏
                        </h3>
                        <div class="failure-info">
                            <div class="failure-item">
                                <span class="failure-label">HP ÏÜåÎ™®:</span>
                                <span class="failure-value" id="hpLost">100%</span>
                            </div>
                            <div class="failure-item">
                                <span class="failure-label">ÎßàÏßÄÎßâ Ï†Å:</span>
                                <span class="failure-value" id="lastEnemy">Í≥†Î∏îÎ¶∞ ÏõåÎ¶¨Ïñ¥</span>
                            </div>
                        </div>
                    </div>

                    <!-- Î∂ÄÌôúÏÑù Ï†ïÎ≥¥ -->
                    <div class="revival-stone-section">
                        <h3 class="revival-title">
                            <span class="revival-icon">üîÆ</span>
                            Î∂ÄÌôúÏÑùÏúºÎ°ú Ïù¥Ïñ¥ÏÑú ÌïòÍ∏∞
                        </h3>
                        <div class="revival-info">
                            <div class="stone-count">
                                <span class="stone-icon">üîÆ</span>
                                <span class="stone-text">Î≥¥Ïú† Î∂ÄÌôúÏÑù:</span>
                                <span class="stone-number" id="revivalStoneCount">3</span>
                                <span class="stone-cost" id="stoneCostIndicator">-1</span>
                            </div>
                            <div class="revival-benefit">
                                <span class="benefit-text">HP 100% ÌöåÎ≥µÌïòÏó¨ ÌòÑÏû¨ Ïõ®Ïù¥Î∏åÏóêÏÑú Ïû¨ÏãúÏûë</span>
                            </div>
                        </div>
                    </div>

                    <!-- Ïï°ÏÖò Î≤ÑÌäºÎì§ -->
                    <div class="gameover-actions">
                        <button class="gameover-btn retry-btn" onclick="retryGame()">
                            <span class="btn-icon">üîÑ</span>
                            <span class="btn-text">Îã§ÏãúÌïòÍ∏∞</span>
                        </button>
                        <button class="gameover-btn revival-btn" onclick="reviveWithStone()" id="revivalBtn">
                            <span class="btn-icon">üîÆ</span>
                            <span class="btn-text">Î∂ÄÌôú</span>
                        </button>
                        <button class="gameover-btn menu-btn" onclick="goToMainFromGameOver()">
                            <span class="btn-icon">üè†</span>
                            <span class="btn-text">Î©îÏù∏ÏúºÎ°ú</span>
                        </button>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <script>
        // ÌÇ§Î≥¥Îìú Ïù¥Î≤§Ìä∏ Ï≤òÎ¶¨
        document.addEventListener('keydown', function (event) {
            const key = event.key.toLowerCase();

            // ÎåÄÌôî ÏãúÏä§ÌÖú Ïö∞ÏÑ† Ï≤òÎ¶¨
            if (dialogueSystem.isActive) {
                switch (key) {
                    case ' ':
                        event.preventDefault();
                        nextDialogue();
                        break;
                    case 'escape':
                        event.preventDefault();
                        skipDialogue();
                        break;
                }
                return; // ÎåÄÌôî Ï§ëÏùº ÎïåÎäî Îã§Î•∏ ÌÇ§ Î¨¥Ïãú
            }

            // ÏùºÎ∞ò Í≤åÏûÑ ÌÇ§ Ï≤òÎ¶¨
            switch (key) {
                case 'w':
                    console.log('ÏúÑÎ°ú Ïù¥Îèô');
                    break;
                case 'a':
                    console.log('ÏôºÏ™ΩÏúºÎ°ú Ïù¥Îèô');
                    break;
                case 's':
                    console.log('ÏïÑÎûòÎ°ú Ïù¥Îèô');
                    break;
                case 'd':
                    console.log('Ïò§Î•∏Ï™ΩÏúºÎ°ú Ïù¥Îèô');
                    break;
                case 'q':
                    console.log('ÏôºÏ™Ω ÎèåÍ∏∞');
                    break;
                case 'e':
                    console.log('Ïò§Î•∏Ï™Ω ÎèåÍ∏∞');
                    break;
                case ' ':
                    event.preventDefault();
                    goToVoice();
                    break;
                case 'shift':
                    event.preventDefault();
                    goToSkillBook();
                    break;
                case 'r':
                    goToRuneUpgrade();
                    break;
                case 't':
                    // ÌÖåÏä§Ìä∏Ïö©: TÌÇ§Î°ú ÎåÄÌôî ÏãúÏûë
                    event.preventDefault();
                    startDialogue('intro');
                    break;
                case 'y':
                    // ÌÖåÏä§Ìä∏Ïö©: YÌÇ§Î°ú Ï†ÑÌà¨ ÎåÄÌôî ÏãúÏûë
                    event.preventDefault();
                    startDialogue('battle');
                    break;
                case 'v':
                    // VÌÇ§Î°ú ÏäπÎ¶¨ ÌôîÎ©¥ ÌëúÏãú (ÌÖåÏä§Ìä∏Ïö©)
                    event.preventDefault();
                    showVictory();
                    break;
                case 'g':
                    // GÌÇ§Î°ú Í≤åÏûÑÏò§Î≤Ñ ÌôîÎ©¥ ÌëúÏãú (ÌÖåÏä§Ìä∏Ïö©)
                    event.preventDefault();
                    showGameOver();
                    break;
            }
        });

        // ÌåùÏóÖ Ï†úÏñ¥ Ìï®ÏàòÎì§
        function goToVoice() {
            showPopup('voicePopup');
        }

        function goToSkillBook() {
            showPopup('skillPopup');
        }

        function goToRuneUpgrade() {
            showPopup('runePopup');
        }

        // ÏäπÎ¶¨ Í¥ÄÎ†® Ìï®ÏàòÎì§
        function showVictory() {
            showPopup('victoryPopup');
            updateVictoryStats();
        }

        function updateVictoryStats() {
            // Ïã§Ï†ú Í≤åÏûÑÏóêÏÑúÎäî Ïã§Ï†ú ÌîåÎ†àÏù¥ Îç∞Ïù¥ÌÑ∞Î•º ÏÇ¨Ïö©
            const gameStats = {
                finalScore: Math.floor(Math.random() * 200000) + 100000,
                clearedWaves: '10 / 10',
                playTime: generateRandomTime(),
                earnedRunes: Math.floor(Math.random() * 20) + 10,
                earnedCrystals: Math.floor(Math.random() * 5) + 1,
                earnedExp: Math.floor(Math.random() * 1000) + 500
            };

            // UI ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('finalScore').textContent = gameStats.finalScore.toLocaleString();
            document.getElementById('clearedWaves').textContent = gameStats.clearedWaves;
            document.getElementById('playTime').textContent = gameStats.playTime;
            document.getElementById('earnedRunes').textContent = '+' + gameStats.earnedRunes;
            document.getElementById('earnedCrystals').textContent = '+' + gameStats.earnedCrystals;
            document.getElementById('earnedExp').textContent = '+' + gameStats.earnedExp;

            // ÏÇ¨Ïö©Ìïú Ïä§ÌÇ¨ Îç∞Ïù¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏
            updateUsedSkills();
        }

        function updateUsedSkills() {
            const skillsData = [
                { emoji: 'üî•', name: 'ÌååÏù¥Ïñ¥Î≥º', count: Math.floor(Math.random() * 30) + 10, accuracy: Math.floor(Math.random() * 20) + 80 },
                { emoji: '‚ùÑÔ∏è', name: 'ÏïÑÏù¥Ïä§Î≥ºÌä∏', count: Math.floor(Math.random() * 25) + 8, accuracy: Math.floor(Math.random() * 20) + 80 },
                { emoji: '‚ö°', name: 'ÎùºÏù¥Ìä∏Îãù', count: Math.floor(Math.random() * 20) + 5, accuracy: Math.floor(Math.random() * 20) + 80 },
                { emoji: 'üíö', name: 'Ìûê', count: Math.floor(Math.random() * 10) + 3, accuracy: Math.floor(Math.random() * 15) + 85 },
                { emoji: 'üõ°Ô∏è', name: 'Ïâ¥Îìú', count: Math.floor(Math.random() * 8) + 2, accuracy: Math.floor(Math.random() * 10) + 90 }
            ];

            const container = document.getElementById('usedSkillsGrid');
            container.innerHTML = '';

            // Ïã§Ï†úÎ°ú ÏÇ¨Ïö©Ìïú Ïä§ÌÇ¨Îßå ÌëúÏãú (count > 0)
            const usedSkills = skillsData.filter(skill => skill.count > 0).slice(0, 4); // ÏµúÎåÄ 4Í∞ú

            usedSkills.forEach(skill => {
                const skillElement = document.createElement('div');
                skillElement.className = 'skill-usage-item';
                skillElement.innerHTML = `
                    <span class="skill-emoji">${skill.emoji}</span>
                    <div class="skill-info">
                        <span class="skill-name">${skill.name}</span>
                        <span class="skill-count">${skill.count}Ìöå</span>
                    </div>
                    <div class="skill-accuracy">${skill.accuracy}%</div>
                `;
                container.appendChild(skillElement);
            });
        }

        function retryChapter() {
            hidePopup('victoryPopup');
            // ÌòÑÏû¨ Ï±ïÌÑ∞ Îã§Ïãú ÏãúÏûë Î°úÏßÅ
            console.log('Ï±ïÌÑ∞ Ïû¨ÏãúÏûë');
            // Ïã§Ï†úÎ°úÎäî Í≤åÏûÑ ÏÉÅÌÉúÎ•º Ï¥àÍ∏∞ÌôîÌïòÍ≥† Îã§Ïãú ÏãúÏûë
        }

        function nextChapter() {
            hidePopup('victoryPopup');
            // Îã§Ïùå Ï±ïÌÑ∞Î°ú Ïù¥Îèô Î°úÏßÅ
            console.log('Îã§Ïùå Ï±ïÌÑ∞Î°ú Ïù¥Îèô');
            // Ïã§Ï†úÎ°úÎäî Îã§Ïùå Ï±ïÌÑ∞ Îç∞Ïù¥ÌÑ∞Î•º Î°úÎìúÌïòÍ≥† ÏãúÏûë
        }

        function goToMainMenu() {
            hidePopup('victoryPopup');
            // Î©îÏù∏ Î©îÎâ¥Î°ú Ïù¥Îèô
            window.location.href = '../../Î©îÏù∏Î©îÎâ¥/Í∏∞Î≥∏ÏÉÅÌÉú/index.html';
        }

        // Í≤åÏûÑÏò§Î≤Ñ Í¥ÄÎ†® Ìï®ÏàòÎì§
        function showGameOver() {
            showPopup('gameOverPopup');
            updateGameOverStats();
        }

        function updateGameOverStats() {
            // Ïã§Ï†ú Í≤åÏûÑÏóêÏÑúÎäî Ïã§Ï†ú ÌîåÎ†àÏù¥ Îç∞Ïù¥ÌÑ∞Î•º ÏÇ¨Ïö©
            const gameOverStats = {
                finalScore: Math.floor(Math.random() * 100000) + 20000,
                reachedWave: Math.floor(Math.random() * 8) + 3,
                totalWaves: 10,
                playTime: generateRandomTime(),
                hpLost: '100%',
                lastEnemy: getRandomEnemy()
            };

            // UI ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('gameOverScore').textContent = gameOverStats.finalScore.toLocaleString();
            document.getElementById('gameOverWave').textContent = `${gameOverStats.reachedWave} / ${gameOverStats.totalWaves}`;
            document.getElementById('gameOverTime').textContent = gameOverStats.playTime;
            document.getElementById('hpLost').textContent = gameOverStats.hpLost;
            document.getElementById('lastEnemy').textContent = gameOverStats.lastEnemy;
            
            // Î∂ÄÌôúÏÑù ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
            updateRevivalStoneDisplay();
        }

        function getRandomEnemy() {
            const enemies = ['Í≥†Î∏îÎ¶∞ Ï†ÑÏÇ¨', 'Ïò§ÌÅ¨ ÏõåÎ¶¨Ïñ¥', 'Îã§ÌÅ¨ Î©îÏù¥ÏßÄ', 'Ïä§ÏºàÎ†àÌÜ§ ÏïÑÏ≤ò', 'Ìä∏Î°§ Í∞ÄÎîîÏñ∏', 'ÎìúÎûòÍ≥§ Ïä§Ìè∞'];
            return enemies[Math.floor(Math.random() * enemies.length)];
        }

        function retryGame() {
            hidePopup('gameOverPopup');
            // Í≤åÏûÑ Ïû¨ÏãúÏûë Î°úÏßÅ
            console.log('Í≤åÏûÑ Ïû¨ÏãúÏûë');
            // Ïã§Ï†úÎ°úÎäî Í≤åÏûÑ ÏÉÅÌÉúÎ•º Ï¥àÍ∏∞ÌôîÌïòÍ≥† Îã§Ïãú ÏãúÏûë
        }

        function goToMainFromGameOver() {
            hidePopup('gameOverPopup');
            // Î©îÏù∏ Î©îÎâ¥Î°ú Ïù¥Îèô
            window.location.href = '../../Î©îÏù∏Î©îÎâ¥/Í∏∞Î≥∏ÏÉÅÌÉú/index.html';
        }

        // Î∂ÄÌôúÏÑù Í¥ÄÎ†® Î≥ÄÏàò (Ïã§Ï†ú Í≤åÏûÑÏóêÏÑúÎäî Í≤åÏûÑ Îç∞Ïù¥ÌÑ∞ÏóêÏÑú Í∞ÄÏ†∏Ïò¥)
        let revivalStones = 3; // Ï¥àÍ∏∞ Î∂ÄÌôúÏÑù Í∞úÏàò

        function reviveWithStone() {
            if (revivalStones > 0) {
                revivalStones--;
                hidePopup('gameOverPopup');
                console.log('Î∂ÄÌôúÏÑù ÏÇ¨Ïö©! ÎÇ®ÏùÄ Í∞úÏàò:', revivalStones);
                // Ïã§Ï†úÎ°úÎäî HPÎ•º 100%Î°ú ÌöåÎ≥µÌïòÍ≥† ÌòÑÏû¨ Ïõ®Ïù¥Î∏åÏóêÏÑú Ïû¨ÏãúÏûë
                alert(`Î∂ÄÌôúÏÑùÏùÑ ÏÇ¨Ïö©ÌñàÏäµÎãàÎã§! HPÍ∞Ä 100% ÌöåÎ≥µÎêòÏóàÏäµÎãàÎã§.\nÎÇ®ÏùÄ Î∂ÄÌôúÏÑù: ${revivalStones}Í∞ú`);
            } else {
                alert('Î∂ÄÌôúÏÑùÏù¥ Î∂ÄÏ°±Ìï©ÎãàÎã§!');
            }
        }

        function updateRevivalStoneDisplay() {
            // Î∂ÄÌôúÏÑù Í∞úÏàò ÏóÖÎç∞Ïù¥Ìä∏
            const stoneCountElement = document.getElementById('revivalStoneCount');
            const revivalBtn = document.getElementById('revivalBtn');
            const stoneCostIndicator = document.getElementById('stoneCostIndicator');
            
            if (stoneCountElement) {
                stoneCountElement.textContent = revivalStones;
            }
            
            // -1 ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
            if (stoneCostIndicator) {
                if (revivalStones <= 0) {
                    stoneCostIndicator.style.display = 'none';
                } else {
                    stoneCostIndicator.style.display = 'inline';
                }
            }
            
            // Î∂ÄÌôúÏÑùÏù¥ ÏóÜÏúºÎ©¥ Î≤ÑÌäº ÎπÑÌôúÏÑ±Ìôî
            if (revivalBtn) {
                if (revivalStones <= 0) {
                    revivalBtn.disabled = true;
                    revivalBtn.classList.add('disabled');
                    revivalBtn.innerHTML = `
                        <span class="btn-icon">üîÆ</span>
                        <span class="btn-text">Î∂ÄÌôú Î∂àÍ∞Ä</span>
                    `;
                } else {
                    revivalBtn.disabled = false;
                    revivalBtn.classList.remove('disabled');
                    revivalBtn.innerHTML = `
                        <span class="btn-icon">üîÆ</span>
                        <span class="btn-text">Î∂ÄÌôú</span>
                    `;
                }
            }
        }



        // Ï§ëÎ≥µ Ìï®Ïàò Ï†úÍ±∞Îê® - ÏïÑÎûòÏùò ÌÜµÌï©Îêú showPopup Ìï®ÏàòÎ•º ÏÇ¨Ïö©

        // ÌåùÏóÖ Ïô∏Î∂Ä ÌÅ¥Î¶≠Ïãú Îã´Í∏∞
        document.querySelectorAll('.popup-overlay').forEach(overlay => {
            overlay.addEventListener('click', function (e) {
                if (e.target === overlay) {
                    overlay.classList.remove('show');
                }
            });
        });

        // ESC ÌÇ§Î°ú ÌåùÏóÖ Îã´Í∏∞
        document.addEventListener('keydown', function (event) {
            if (event.key === 'Escape') {
                document.querySelectorAll('.popup-overlay.show').forEach(overlay => {
                    overlay.classList.remove('show');
                });
            }
        });

        // ÌåùÏóÖÏóêÏÑú Îã´Í∏∞ Î©îÏãúÏßÄ ÏàòÏã†
        window.addEventListener('message', function (event) {
            if (event.data === 'closePopup') {
                document.querySelectorAll('.popup-overlay.show').forEach(overlay => {
                    overlay.classList.remove('show');
                });
            }
        });

        // Ïä§ÌÇ¨Î∂Å Í¥ÄÎ†® Î≥ÄÏàò
        let currentCategory = 'all';
        let selectedCardIndex = 0;
        let skillPopupActive = false;

        // Ïä§ÌÇ¨Î∂Å ÌÇ§Î≥¥Îìú Ïù¥Î≤§Ìä∏ Ï≤òÎ¶¨
        document.addEventListener('keydown', function (event) {
            if (skillPopupActive && document.getElementById('skillPopup').classList.contains('show')) {
                const key = event.key.toLowerCase();

                switch (key) {
                    case 'w':
                        event.preventDefault();
                        navigateSkillCards('up');
                        break;
                    case 'a':
                        event.preventDefault();
                        navigateSkillCards('left');
                        break;
                    case 's':
                        event.preventDefault();
                        navigateSkillCards('down');
                        break;
                    case 'd':
                        event.preventDefault();
                        navigateSkillCards('right');
                        break;
                    case 'q':
                        event.preventDefault();
                        switchSkillCategory(-1);
                        break;
                    case 'e':
                        event.preventDefault();
                        switchSkillCategory(1);
                        break;
                }
            }
        });

        // Ïä§ÌÇ¨Î∂Å ÌåùÏóÖ ÌëúÏãú Ïãú Ï¥àÍ∏∞Ìôî
        function showPopup(popupId) {
            document.getElementById(popupId).classList.add('show');
            if (popupId === 'skillPopup') {
                skillPopupActive = true;
                showSkillCategory('all');
                selectedCardIndex = 0;
                highlightSelectedSkillCard();
            } else if (popupId === 'voicePopup') {
                startVoiceRecognition();
            }
        }

        function hidePopup(popupId) {
            document.getElementById(popupId).classList.remove('show');
            if (popupId === 'skillPopup') {
                skillPopupActive = false;
            } else if (popupId === 'voicePopup') {
                // ÏùåÏÑ± Ïù∏Ïãù ÏÉÅÌÉú Î¶¨ÏÖã
                voiceIsProcessing = false;

                // UI Ï¥àÍ∏∞Ìôî
                const soundWaves = document.getElementById('soundWaves');
                if (soundWaves) {
                    soundWaves.style.display = 'none';
                    soundWaves.classList.remove('listening', 'processing', 'completed');
                }

                // ÏßÑÌñâÎ•† Î¶¨ÏÖã
                updateProgressStatus('STANDBY', 0);

                // Í≤∞Í≥º ÏÑπÏÖò Ïà®Í∏∞Í∏∞
                const accuracySection = document.getElementById('accuracySection');
                const skillInfoSection = document.getElementById('skillInfoSection');
                if (accuracySection) accuracySection.style.display = 'none';
                if (skillInfoSection) skillInfoSection.style.display = 'none';

                // Ïä§ÌÇ¨ Í≤∞Í≥º Ï¥àÍ∏∞Ìôî
                const skillNameResult = document.getElementById('skillNameResult');
                const resultTitle = document.getElementById('resultTitle');
                if (skillNameResult) skillNameResult.innerHTML = '';
                if (resultTitle) {
                    resultTitle.textContent = 'ANALYZING...';
                    resultTitle.style.color = 'rgba(255, 255, 255, 0.8)';
                    resultTitle.style.textShadow = 'none';
                }
            }
        }

        // Ïä§ÌÇ¨ Ïπ¥ÌÖåÍ≥†Î¶¨ Ï†ÑÌôò
        function switchSkillCategory(direction) {
            const categories = ['all', 'attack', 'defense', 'healing'];
            const currentIndex = categories.indexOf(currentCategory);
            let newIndex = currentIndex + direction;

            if (newIndex < 0) newIndex = categories.length - 1;
            if (newIndex >= categories.length) newIndex = 0;

            currentCategory = categories[newIndex];
            showSkillCategory(currentCategory);
            selectedCardIndex = 0;
            highlightSelectedSkillCard();
        }

        function showSkillCategory(category) {
            // Ïπ¥ÌÖåÍ≥†Î¶¨ Î≤ÑÌäº ÏóÖÎç∞Ïù¥Ìä∏
            document.querySelectorAll('.skill-category').forEach(cat => {
                cat.classList.remove('active');
            });
            const activeCategory = document.querySelector(`[data-category="${category}"]`);
            if (activeCategory) {
                activeCategory.classList.add('active');
            }

            // Ïä§ÌÇ¨ Ïπ¥Îìú ÌïÑÌÑ∞ÎßÅ
            const skillCards = document.querySelectorAll('.skill-card');
            skillCards.forEach(card => {
                if (category === 'all' || card.dataset.category === category) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });

            currentCategory = category;
        }

        function navigateSkillCards(direction) {
            const visibleCards = Array.from(document.querySelectorAll('.skill-card'))
                .filter(card => card.style.display !== 'none');

            if (visibleCards.length === 0) return;

            const cols = 3; // Ìïú Ï§ÑÏóê 3Í∞úÏî©

            switch (direction) {
                case 'up':
                    selectedCardIndex = Math.max(0, selectedCardIndex - cols);
                    break;
                case 'down':
                    selectedCardIndex = Math.min(visibleCards.length - 1, selectedCardIndex + cols);
                    break;
                case 'left':
                    selectedCardIndex = Math.max(0, selectedCardIndex - 1);
                    break;
                case 'right':
                    selectedCardIndex = Math.min(visibleCards.length - 1, selectedCardIndex + 1);
                    break;
            }

            highlightSelectedSkillCard();
        }

        function highlightSelectedSkillCard() {
            const visibleCards = Array.from(document.querySelectorAll('.skill-card'))
                .filter(card => card.style.display !== 'none');

            // Î™®Îì† Ïπ¥ÎìúÏóêÏÑú selected ÌÅ¥ÎûòÏä§ Ï†úÍ±∞
            document.querySelectorAll('.skill-card').forEach(card => {
                card.classList.remove('selected');
            });

            // ÏÑ†ÌÉùÎêú Ïπ¥ÎìúÏóê selected ÌÅ¥ÎûòÏä§ Ï∂îÍ∞Ä
            if (visibleCards[selectedCardIndex]) {
                visibleCards[selectedCardIndex].classList.add('selected');
                visibleCards[selectedCardIndex].scrollIntoView({
                    behavior: 'smooth',
                    block: 'center'
                });
            }
        }

        // ÏùåÏÑ±Ïù∏Ïãù Í¥ÄÎ†® Î≥ÄÏàò
        let voiceCurrentStage = 1;
        let voiceIsProcessing = false;

        // ÏÇ¨Ïö© Í∞ÄÎä•Ìïú Ïä§ÌÇ¨ Î™©Î°ù (ÏòÅÏñ¥ Ïù¥Î¶Ñ)
        const availableSkills = [
            { name: 'Fireball', korean: 'ÌååÏù¥Ïñ¥Î≥º', pronunciation: 'ÌååÏù¥Ïñ¥Î≥º', element: 'fire' },
            { name: 'Ice Bolt', korean: 'ÏïÑÏù¥Ïä§ Î≥ºÌä∏', pronunciation: 'ÏïÑÏù¥Ïä§ Î≥ºÌä∏', element: 'ice' },
            { name: 'Lightning', korean: 'ÎùºÏù¥Ìä∏Îãù', pronunciation: 'ÎùºÏù¥Ìä∏Îãù', element: 'lightning' },
            { name: 'Heal', korean: 'Ìûê', pronunciation: 'Ìûê', element: 'holy' },
            { name: 'Shield', korean: 'Ïâ¥Îìú', pronunciation: 'Ïâ¥Îìú', element: 'holy' },
            { name: 'Meteor', korean: 'Î©îÌÖåÏò§', pronunciation: 'Î©îÌÖåÏò§', element: 'fire' },
            { name: 'Blizzard', korean: 'Î∏îÎ¶¨ÏûêÎìú', pronunciation: 'Î∏îÎ¶¨ÏûêÎìú', element: 'ice' },
            { name: 'Earthquake', korean: 'Ïñ¥Ïä§ÌÄòÏù¥ÌÅ¨', pronunciation: 'Ïñ¥Ïä§ÌÄòÏù¥ÌÅ¨', element: 'earth' },
            { name: 'Wind Blade', korean: 'ÏúàÎìú Î∏îÎ†àÏù¥Îìú', pronunciation: 'ÏúàÎìú Î∏îÎ†àÏù¥Îìú', element: 'wind' },
            { name: 'Holy Light', korean: 'ÌôÄÎ¶¨ ÎùºÏù¥Ìä∏', pronunciation: 'ÌôÄÎ¶¨ ÎùºÏù¥Ìä∏', element: 'holy' },
            { name: 'Dark Magic', korean: 'Îã§ÌÅ¨ Îß§ÏßÅ', pronunciation: 'Îã§ÌÅ¨ Îß§ÏßÅ', element: 'dark' },
            { name: 'Teleport', korean: 'ÌÖîÎ†àÌè¨Ìä∏', pronunciation: 'ÌÖîÎ†àÌè¨Ìä∏', element: 'arcane' },
            { name: 'Time Stop', korean: 'ÌÉÄÏûÑ Ïä§ÌÜ±', pronunciation: 'ÌÉÄÏûÑ Ïä§ÌÜ±', element: 'arcane' },
            { name: 'Phoenix', korean: 'ÌîºÎãâÏä§', pronunciation: 'ÌîºÎãâÏä§', element: 'fire' },
            { name: 'Dragon Breath', korean: 'ÎìúÎûòÍ≥§ Î∏åÎ†àÏä§', pronunciation: 'ÎìúÎûòÍ≥§ Î∏åÎ†àÏä§', element: 'fire' }
        ];

        function startVoiceRecognition() {
            if (voiceIsProcessing) return;
            voiceIsProcessing = true;

            // Ï¥àÍ∏∞Ìôî
            const accuracySection = document.getElementById('accuracySection');
            const skillInfoSection = document.getElementById('skillInfoSection');
            const skillNameResult = document.getElementById('skillNameResult');
            const resultTitle = document.getElementById('resultTitle');

            if (accuracySection) accuracySection.style.display = 'none';
            if (skillInfoSection) skillInfoSection.style.display = 'none';
            if (skillNameResult) skillNameResult.innerHTML = '';
            if (resultTitle) {
                resultTitle.textContent = 'ANALYZING...';
                resultTitle.style.color = 'rgba(255, 255, 255, 0.8)';
                resultTitle.style.textShadow = 'none';
            }

            voiceCurrentStage = 1;
            showVoiceStage(1);

            // 4Ï¥à ÌõÑ Ïù∏Ïãù ÏãúÏûë
            setTimeout(() => {
                if (voiceCurrentStage === 1) {
                    simulateVoiceRecognition();
                }
            }, 4000);
        }

        function simulateVoiceRecognition() {
            // ÏùåÏÑ± Îì£Í∏∞ ÏÉÅÌÉúÎ°ú Ï†ÑÌôò
            showListeningState();

            setTimeout(() => {
                // ÏùåÏÑ± Î∂ÑÏÑù ÏÉÅÌÉúÎ°ú Ï†ÑÌôò
                showProcessingState();

                // Ïã§ÏãúÍ∞Ñ Ïä§ÌÇ¨ Î∂ÑÏÑù ÏãúÏûë
                startRealTimeSkillAnalysis();

            }, 2000); // 2Ï¥à Îì£Í∏∞
        }

        function startRealTimeSkillAnalysis() {
            // ÏµúÏ¢Ö Î™©Ìëú Ïä§ÌÇ¨ ÏÑ†ÌÉù
            const finalSkill = availableSkills[Math.floor(Math.random() * availableSkills.length)];
            const finalAccuracy = Math.floor(Math.random() * 30) + 70; // 70-100% ÏµúÏ¢Ö Ï†ïÌôïÎèÑ

            // Î∂ÑÏÑù Í≥ºÏ†ïÏóêÏÑú Î≥¥Ïó¨Ï§Ñ ÌõÑÎ≥¥ Ïä§ÌÇ¨Îì§ (ÏµúÏ¢Ö Ïä§ÌÇ¨ Ìè¨Ìï®)
            const candidateSkills = [];

            // ÎûúÎç§Ìïú ÌõÑÎ≥¥Îì§ Ï∂îÍ∞Ä (3-5Í∞ú)
            const numCandidates = Math.floor(Math.random() * 3) + 3;
            for (let i = 0; i < numCandidates - 1; i++) {
                let randomSkill;
                do {
                    randomSkill = availableSkills[Math.floor(Math.random() * availableSkills.length)];
                } while (randomSkill === finalSkill || candidateSkills.includes(randomSkill));
                candidateSkills.push(randomSkill);
            }

            // ÏµúÏ¢Ö Ïä§ÌÇ¨ÏùÑ ÎßàÏßÄÎßâÏóê Ï∂îÍ∞Ä
            candidateSkills.push(finalSkill);

            // Ï†ïÌôïÎèÑ Î∞è Ïä§ÌÇ¨ Ï†ïÎ≥¥ ÏÑπÏÖò ÌëúÏãú
            const accuracySection = document.getElementById('accuracySection');
            const skillInfoSection = document.getElementById('skillInfoSection');
            if (accuracySection) accuracySection.style.display = 'block';
            if (skillInfoSection) skillInfoSection.style.display = 'block';

            let currentIndex = 0;

            function showNextCandidate() {
                if (currentIndex < candidateSkills.length) {
                    const currentSkill = candidateSkills[currentIndex];
                    const isLastSkill = currentIndex === candidateSkills.length - 1;

                    // Ï†ïÌôïÎèÑ Í≥ÑÏÇ∞ (ÎßàÏßÄÎßâ Ïä§ÌÇ¨Ïù¥Î©¥ ÏµúÏ¢Ö Ï†ïÌôïÎèÑ, ÏïÑÎãàÎ©¥ ÎÇÆÏùÄ Ï†ïÌôïÎèÑ)
                    const accuracy = isLastSkill ? finalAccuracy : Math.floor(Math.random() * 40) + 30;

                    // Ïä§ÌÇ¨ Ïù¥Î¶ÑÍ≥º Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
                    displaySkillCandidate(currentSkill, accuracy, isLastSkill);

                    currentIndex++;

                    if (isLastSkill) {
                        // ÏµúÏ¢Ö Ïä§ÌÇ¨ Î∞úÍ≤¨ - ÏôÑÎ£å ÏÉÅÌÉúÎ°ú Ï†ÑÌôò
                        setTimeout(() => {
                            showCompletedState();
                            displayFinalSkillResult(currentSkill, accuracy);

                            // 4Ï¥à ÌõÑ ÏûêÎèôÏúºÎ°ú Í≤åÏûÑÏúºÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞
                            autoCloseVoice();
                        }, 1000);
                    } else {
                        // Îã§Ïùå ÌõÑÎ≥¥Î°ú Ïù¥Îèô
                        setTimeout(showNextCandidate, Math.random() * 800 + 400); // 0.4-1.2Ï¥à Í∞ÑÍ≤©
                    }
                }
            }

            // Ï≤´ Î≤àÏß∏ ÌõÑÎ≥¥ ÌëúÏãú
            showNextCandidate();
        }

        function displaySkillNameWithAnimation(skill, overallAccuracy) {
            const container = document.getElementById('skillNameResult');
            container.innerHTML = '';

            // ÏÜçÏÑ±Î≥Ñ Í∏∞Î≥∏ ÏÉâÏÉÅ Ï†ïÏùò
            const elementColors = {
                fire: { r: 255, g: 71, b: 87 },      // Îπ®Í∞ÑÏÉâ (ÌååÏù¥Ïñ¥Î≥º)
                ice: { r: 79, g: 195, b: 247 },      // ÌååÎûÄÏÉâ (ÏïÑÏù¥Ïä§)
                lightning: { r: 255, g: 235, b: 59 }, // ÎÖ∏ÎûÄÏÉâ (ÎùºÏù¥Ìä∏Îãù)
                holy: { r: 255, g: 255, b: 255 },    // Ìù∞ÏÉâ (Ìûê, Ïâ¥Îìú)
                earth: { r: 139, g: 69, b: 19 },     // Í∞àÏÉâ (Ïñ¥Ïä§ÌÄòÏù¥ÌÅ¨)
                wind: { r: 144, g: 238, b: 144 },    // Ïó∞Ìïú ÎÖπÏÉâ (ÏúàÎìú)
                dark: { r: 138, g: 43, b: 226 },     // Î≥¥ÎùºÏÉâ (Îã§ÌÅ¨ Îß§ÏßÅ)
                arcane: { r: 255, g: 20, b: 147 }    // ÎßàÏ††ÌÉÄ (ÌÖîÎ†àÌè¨Ìä∏, ÌÉÄÏûÑÏä§ÌÜ±)
            };

            const baseColor = elementColors[skill.element] || { r: 255, g: 255, b: 255 };
            const letters = skill.name.split('');

            letters.forEach((letter, index) => {
                const span = document.createElement('span');
                span.className = 'skill-letter';
                span.textContent = letter === ' ' ? '\u00A0' : letter; // Í≥µÎ∞± Ï≤òÎ¶¨
                span.style.animationDelay = (index * 0.1) + 's';

                // Í∞Å Í∏ÄÏûêÎ≥Ñ Í∞úÎ≥Ñ Ï†ïÌôïÎèÑ (Ï†ÑÏ≤¥ Ï†ïÌôïÎèÑ Í∏∞Ï§ÄÏúºÎ°ú ¬±20% ÎûúÎç§)
                const letterAccuracy = Math.max(20, Math.min(100, overallAccuracy + (Math.random() - 0.5) * 40));

                // Ï†ïÌôïÎèÑÏóê Îî∞Î•∏ Ìà¨Î™ÖÎèÑ Î∞è Ï±ÑÎèÑ Ï°∞Ï†ï
                const opacity = letterAccuracy / 100; // 20% = 0.2, 100% = 1.0
                const saturation = letterAccuracy / 100; // Ï†ïÌôïÎèÑÍ∞Ä ÎÇÆÏúºÎ©¥ Ï±ÑÎèÑÎèÑ ÎÇÆÏïÑÏßê

                // Ïñ¥ÎëêÏö¥ ÏÉâÏÉÅÏúºÎ°ú Î≥ÄÌôò (Ï†ïÌôïÎèÑÍ∞Ä ÎÇÆÏùÑÏàòÎ°ù Ïñ¥ÎëêÏõåÏßê)
                const darkR = Math.floor(baseColor.r * saturation);
                const darkG = Math.floor(baseColor.g * saturation);
                const darkB = Math.floor(baseColor.b * saturation);

                span.style.color = `rgba(${darkR}, ${darkG}, ${darkB}, ${opacity})`;
                span.style.textShadow = `0 0 15px rgba(${darkR}, ${darkG}, ${darkB}, ${opacity * 0.6})`;

                container.appendChild(span);
            });

            // Ïö∞Ï∏° Ìå®ÎÑê Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
            updateRightPanelInfo(skill, overallAccuracy);
        }

        function displaySkillCandidate(skill, accuracy, isFinal = false) {
            // Í≤∞Í≥º Ï†úÎ™© ÏóÖÎç∞Ïù¥Ìä∏
            const resultTitle = document.getElementById('resultTitle');
            if (resultTitle) {
                if (isFinal) {
                    resultTitle.textContent = 'Ïù∏Ïãù ÏôÑÎ£å!';
                    resultTitle.style.color = '#4fc3f7';
                    resultTitle.style.textShadow = '0 0 15px rgba(79, 195, 247, 0.6)';
                } else {
                    resultTitle.textContent = `Ïä§ÌÇ¨ Î∂ÑÏÑù Ï§ë... (${Math.floor(accuracy)}% ÏùºÏπò)`;
                    resultTitle.style.color = 'rgba(255, 255, 255, 0.8)';
                    resultTitle.style.textShadow = 'none';
                }
            }

            // Ïä§ÌÇ¨ Ïù¥Î¶ÑÏùÑ Îπ†Î•¥Í≤å Î≥ÄÌôîÏãúÌÇ§Î©∞ ÌëúÏãú
            const container = document.getElementById('skillNameResult');
            container.innerHTML = '';

            // ÌõÑÎ≥¥ Ïä§ÌÇ¨ Ïù¥Î¶ÑÏùÑ ÌÖçÏä§Ìä∏Î°ú ÌëúÏãú (Ïï†ÎãàÎ©îÏù¥ÏÖò ÏóÜÏù¥)
            const skillText = document.createElement('div');
            skillText.className = isFinal ? 'skill-final' : 'skill-candidate';
            skillText.textContent = skill.name;
            skillText.style.cssText = `
                font-size: ${isFinal ? '1.8rem' : '1.4rem'};
                color: ${isFinal ? '#4fc3f7' : 'rgba(255, 255, 255, 0.7)'};
                text-align: center;
                font-weight: bold;
                transition: all 0.3s ease;
                ${isFinal ? 'text-shadow: 0 0 20px rgba(79, 195, 247, 0.6);' : ''}
                ${!isFinal ? 'animation: skillFlicker 0.3s ease-in-out;' : ''}
            `;
            container.appendChild(skillText);

            // Ï†ïÌôïÎèÑ ÏóÖÎç∞Ïù¥Ìä∏
            updateAccuracyDisplay(accuracy, isFinal);

            // Ïä§ÌÇ¨ Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
            updateSkillInfo(skill, isFinal);
        }

        function updateAccuracyDisplay(accuracy, isFinal = false) {
            // Ï†ÑÏ≤¥ Ï†ïÌôïÎèÑ ÌëúÏãú
            const accuracyElement = document.getElementById('accuracyPercent');
            if (accuracyElement) {
                accuracyElement.textContent = accuracy + '%';
                accuracyElement.style.color = isFinal ? '#4fc3f7' : 'rgba(255, 255, 255, 0.7)';
            }

            // ÏÑ∏Î∂Ä Ï†êÏàò Í≥ÑÏÇ∞ (Ïã§ÏãúÍ∞ÑÏúºÎ°ú Î≥ÄÌôî)
            const pronunciationScore = Math.max(20, Math.min(100, accuracy + (Math.random() - 0.5) * 30));
            const speedScore = Math.max(20, Math.min(100, accuracy + (Math.random() - 0.5) * 40));
            const clarityScore = Math.max(20, Math.min(100, accuracy + (Math.random() - 0.5) * 35));

            // Ï†ïÌôïÎèÑ Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
            const pronElement = document.getElementById('pronunciationScore');
            const speedElement = document.getElementById('speedScore');
            const clarityElement = document.getElementById('clarityScore');

            if (pronElement) {
                pronElement.textContent = Math.round(pronunciationScore) + '%';
                pronElement.style.color = isFinal ? '#4fc3f7' : 'rgba(255, 255, 255, 0.7)';
            }
            if (speedElement) {
                speedElement.textContent = Math.round(speedScore) + '%';
                speedElement.style.color = isFinal ? '#4fc3f7' : 'rgba(255, 255, 255, 0.7)';
            }
            if (clarityElement) {
                clarityElement.textContent = Math.round(clarityScore) + '%';
                clarityElement.style.color = isFinal ? '#4fc3f7' : 'rgba(255, 255, 255, 0.7)';
            }
        }

        function updateSkillInfo(skill, isFinal = false) {
            // Ïä§ÌÇ¨ Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
            const elementNames = {
                fire: 'FIRE ÌôîÏóº ÏÜçÏÑ±',
                ice: 'ICE ÎπôÍ≤∞ ÏÜçÏÑ±',
                lightning: 'LIGHTNING Ï†ÑÍ∏∞ ÏÜçÏÑ±',
                holy: 'HOLY Ïã†ÏÑ± ÏÜçÏÑ±',
                earth: 'EARTH ÎåÄÏßÄ ÏÜçÏÑ±',
                wind: 'WIND Î∞îÎûå ÏÜçÏÑ±',
                dark: 'DARK Ïñ¥Îë† ÏÜçÏÑ±',
                arcane: 'ARCANE ÎπÑÏ†Ñ ÏÜçÏÑ±'
            };

            const skillDescriptions = {
                'Fireball': 'Í∞ïÎ†•Ìïú ÌôîÏóº Íµ¨Ï≤¥Î•º Î∞úÏÇ¨ÌïòÏó¨ Ï†ÅÏóêÍ≤å ÌôîÏÉÅ ÌîºÌï¥Î•º ÏûÖÌûôÎãàÎã§.',
                'Ice Bolt': 'ÏñºÏùå ÌôîÏÇ¥ÏùÑ Î∞úÏÇ¨ÌïòÏó¨ Ï†ÅÏùÑ ÏñºÎ†§ Ïù¥ÎèôÏÜçÎèÑÎ•º Í∞êÏÜåÏãúÌÇµÎãàÎã§.',
                'Lightning': 'Î≤àÍ∞úÎ•º ÏÜåÌôòÌïòÏó¨ Ï†ÅÏùÑ Í¥ÄÌÜµÌïòÎ©∞ Ïó∞ÏáÑ ÌîºÌï¥Î•º ÏûÖÌûôÎãàÎã§.',
                'Heal': 'Ï≤¥Î†•ÏùÑ ÌöåÎ≥µÌïòÍ≥† ÏÉÅÌÉúÏù¥ÏÉÅÏùÑ ÏπòÎ£åÌï©ÎãàÎã§.',
                'Shield': 'ÎßàÎ≤ï Î∞©Ïñ¥ÎßâÏùÑ ÏÉùÏÑ±ÌïòÏó¨ ÌîºÌï¥Î•º Ìù°ÏàòÌï©ÎãàÎã§.',
                'Meteor': 'ÌïòÎäòÏóêÏÑú Ïö¥ÏÑùÏùÑ Îñ®Ïñ¥Îú®Î†§ Í¥ëÏó≠ ÌîºÌï¥Î•º ÏûÖÌûôÎãàÎã§.',
                'Blizzard': 'ÎààÎ≥¥ÎùºÎ•º ÏùºÏúºÏºú Í¥ëÎ≤îÏúÑÌïú ÎπôÍ≤∞ ÌîºÌï¥Î•º ÏûÖÌûôÎãàÎã§.',
                'Earthquake': 'ÎåÄÏßÄÎ•º ÌùîÎì§Ïñ¥ Î™®Îì† Ï†ÅÏóêÍ≤å ÌîºÌï¥Î•º ÏûÖÌûôÎãàÎã§.',
                'Wind Blade': 'Î∞îÎûå ÏπºÎÇ†Î°ú Ï†ÅÏùÑ Î≤†Ïñ¥ Ï∂úÌòà Ìö®Í≥ºÎ•º Î∂ÄÏó¨Ìï©ÎãàÎã§.',
                'Holy Light': 'Ïã†ÏÑ±Ìïú ÎπõÏúºÎ°ú Ïñ∏Îç∞ÎìúÏóêÍ≤å Ï∂îÍ∞Ä ÌîºÌï¥Î•º ÏûÖÌûôÎãàÎã§.',
                'Dark Magic': 'Ïñ¥Îë†Ïùò ÌûòÏúºÎ°ú Ï†ÅÏùò ÏÉùÎ™ÖÎ†•ÏùÑ Ìù°ÏàòÌï©ÎãàÎã§.',
                'Teleport': 'Ï¶âÏãú Îã§Î•∏ ÏúÑÏπòÎ°ú ÏàúÍ∞ÑÏù¥ÎèôÌï©ÎãàÎã§.',
                'Time Stop': 'ÏãúÍ∞ÑÏùÑ Ï†ïÏßÄÏãúÏºú Ï†ÅÏùò ÏõÄÏßÅÏûÑÏùÑ Î©àÏ∂•ÎãàÎã§.',
                'Phoenix': 'Î∂àÏÇ¨Ï°∞Î•º ÏÜåÌôòÌïòÏó¨ Ïû¨ÏÉùÍ≥º ÌôîÏóº ÌîºÌï¥Î•º ÎèôÏãúÏóê Ï†úÍ≥µÌï©ÎãàÎã§.',
                'Dragon Breath': 'Ïö©Ïùò Ïà®Í≤∞Î°ú ÏßÅÏÑ†ÏÉÅÏùò Î™®Îì† Ï†ÅÏùÑ Î∂àÌÉúÏõÅÎãàÎã§.'
            };

            const skillElement = document.getElementById('skillElement');
            const skillDescription = document.getElementById('skillDescription');

            if (skillElement) {
                skillElement.textContent = elementNames[skill.element] || 'Ïïå Ïàò ÏóÜÎäî ÏÜçÏÑ±';
                skillElement.style.color = isFinal ? '#ff9800' : 'rgba(255, 152, 0, 0.7)';
            }

            if (skillDescription) {
                skillDescription.textContent = isFinal ?
                    (skillDescriptions[skill.name] || 'Ïä§ÌÇ¨ Ï†ïÎ≥¥Î•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.') :
                    'Ïä§ÌÇ¨ Î∂ÑÏÑù Ï§ë...';
                skillDescription.style.color = isFinal ? 'rgba(255, 255, 255, 0.9)' : 'rgba(255, 255, 255, 0.5)';
            }
        }

        function displayFinalSkillResult(skill, accuracy) {
            // ÏµúÏ¢Ö Í≤∞Í≥ºÎ•º Ïï†ÎãàÎ©îÏù¥ÏÖòÍ≥º Ìï®Íªò ÌëúÏãú
            displaySkillNameWithAnimation(skill, accuracy);

            // Í≤∞Í≥º Îã®Í≥ÑÎ°ú Ï†ÑÌôò
            voiceCurrentStage = 2;
            showVoiceStage(2);

            // ÏµúÏ¢Ö Ï†ïÌôïÎèÑ ÌëúÏãú
            const accuracyElement = document.getElementById('accuracyPercent');
            if (accuracyElement) {
                accuracyElement.textContent = accuracy + '%';
            }
        }

        function updateRightPanelInfo(skill, accuracy) {
            updateAccuracyDisplay(accuracy, true);
            updateSkillInfo(skill, true);
        }

        function updateProgressStatus(status, percentage = 0) {
            const statusElement = document.getElementById('voiceMainTitle');
            const progressFill = document.getElementById('progressFill');
            const progressPercent = document.getElementById('progressPercent');

            if (statusElement) statusElement.textContent = status;

            if (percentage > 0) {
                if (progressFill) progressFill.style.width = percentage + '%';
                if (progressPercent) progressPercent.textContent = percentage + '%';
            }
        }

        function showListeningState() {
            updateProgressStatus('LISTENING...', 25);

            // ÏùåÏÑ± ÌååÌòï Ïï†ÎãàÎ©îÏù¥ÏÖò ÏãúÏûë
            const soundWaves = document.getElementById('soundWaves');
            if (soundWaves) {
                soundWaves.style.display = 'flex';
                soundWaves.classList.add('listening');
            }

            // ÏïÑÏù¥ÏΩò Î≥ÄÍ≤Ω
            const voiceIcon = document.getElementById('voiceIcon');
            if (voiceIcon) voiceIcon.textContent = 'REC';

            // Ï†ïÌôïÎèÑ ÏÑπÏÖò Ïà®Í∏∞Í∏∞
            const accuracySection = document.getElementById('accuracySection');
            const skillInfoSection = document.getElementById('skillInfoSection');
            if (accuracySection) accuracySection.style.display = 'none';
            if (skillInfoSection) skillInfoSection.style.display = 'none';
        }

        function showProcessingState() {
            updateProgressStatus('PROCESSING...', 75);

            // ÌååÌòï Ïï†ÎãàÎ©îÏù¥ÏÖò Î≥ÄÍ≤Ω
            const soundWaves = document.getElementById('soundWaves');
            if (soundWaves) {
                soundWaves.classList.remove('listening');
                soundWaves.classList.add('processing');
            }

            // ÏïÑÏù¥ÏΩò Î≥ÄÍ≤Ω
            const voiceIcon = document.getElementById('voiceIcon');
            if (voiceIcon) voiceIcon.textContent = 'PROC';
        }

        function showCompletedState() {
            updateProgressStatus('COMPLETED', 100);

            // ÌååÌòï Ïï†ÎãàÎ©îÏù¥ÏÖò ÏôÑÎ£å ÏÉÅÌÉú
            const soundWaves = document.getElementById('soundWaves');
            if (soundWaves) {
                soundWaves.classList.remove('listening', 'processing');
                soundWaves.classList.add('completed');

                // 3Ï¥à ÌõÑ Ïï†ÎãàÎ©îÏù¥ÏÖò Ï¥àÍ∏∞Ìôî
                setTimeout(() => {
                    soundWaves.style.display = 'none';
                    soundWaves.classList.remove('completed');
                }, 3000);
            }

            // ÏïÑÏù¥ÏΩò Î≥ÄÍ≤Ω
            const voiceIcon = document.getElementById('voiceIcon');
            if (voiceIcon) voiceIcon.textContent = 'DONE';
        }

        function showVoiceStage(stageNumber) {
            if (stageNumber === 1) {
                // Îì£Í∏∞ Îã®Í≥Ñ ÏãúÏûë
                showListeningState();

                // Ï≤´ Î≤àÏß∏ Îã®Í≥Ñ: Ï§ÄÎπÑ -> Ïù∏Ïãù Ï§ëÏúºÎ°ú Ï†úÎ™© Î≥ÄÍ≤Ω
                setTimeout(() => {
                    updateProgressStatus('VOICE RECOGNITION...', 25);
                }, 1000);

                // 1Ï¥à ÌõÑ ÏßÑÌñâÎ∞î ÏóÖÎç∞Ïù¥Ìä∏
                setTimeout(() => {
                    updateProgressStatus('RECEIVING AUDIO...', 50);
                }, 2000);

                // 3Ï¥à ÌõÑ ÏôÑÏ†ÑÌïú ÏßÑÌñâ
                setTimeout(() => {
                    updateProgressStatus('PROCESSING AUDIO...', 75);
                }, 3000);
            } else if (stageNumber === 2) {
                // Í≤∞Í≥º Îã®Í≥Ñ - ÏôÑÎ£å ÏÉÅÌÉúÎ°ú Ï†ÑÌôò
                showCompletedState();

                // Í≤∞Í≥º ÌëúÏãú ÌõÑ Ï†ïÎ≥¥ ÏÑπÏÖòÎì§ Î≥¥Ïù¥Í∏∞
                setTimeout(() => {
                    const accuracySection = document.getElementById('accuracySection');
                    const skillInfoSection = document.getElementById('skillInfoSection');
                    if (accuracySection) accuracySection.style.display = 'block';
                    if (skillInfoSection) skillInfoSection.style.display = 'block';
                }, 500);
            }
        }

        // ÏûêÎèôÏúºÎ°ú 4Ï¥à ÌõÑ Îã´Í∏∞
        function autoCloseVoice() {
            setTimeout(() => {
                hidePopup('voicePopup');
                voiceIsProcessing = false;
            }, 4000);
        }

        // ========== ÎåÄÌôî ÏãúÏä§ÌÖú ==========
        let dialogueSystem = {
            isActive: false,
            currentDialogue: null,
            currentIndex: 0,
            isTyping: false,
            typingSpeed: 50, // Í∏ÄÏûêÎãπ ms

            // ÎåÄÌôî Îç∞Ïù¥ÌÑ∞ ÏòàÏãú
            sampleDialogues: {
                intro: [
                    {
                        character: 'narrator',
                        name: 'ÎÇòÎ†àÏù¥ÏÖò',
                        text: 'Ïñ¥Îë† ÏÜçÏóêÏÑú ÏÉàÎ°úÏö¥ Î™®ÌóòÏù¥ ÏãúÏûëÎêòÏóàÏäµÎãàÎã§. ÎãπÏã†ÏùÄ Í≥†ÎåÄ ÎßàÎ≤ïÏùò ÌûòÏùÑ Í∞ÄÏßÑ ÎßàÎ≤ïÏÇ¨ÏûÖÎãàÎã§.'
                    },
                    {
                        character: 'player',
                        name: 'ÌîåÎ†àÏù¥Ïñ¥',
                        text: 'Ïù¥Í≥≥ÏùÄ... Ïñ¥ÎîîÏù∏Í∞Ä? Ïù¥ÏÉÅÌïú Í∏∞Ïö¥Ïù¥ ÎäêÍª¥ÏßÑÎã§.'
                    },
                    {
                        character: 'narrator',
                        name: 'ÎÇòÎ†àÏù¥ÏÖò',
                        text: 'Í∞ëÏûêÍ∏∞ Ïñ¥Îë† ÏÜçÏóêÏÑú Î∂âÏùÄ ÎààÏù¥ ÎπõÎÇòÍ∏∞ ÏãúÏûëÌï©ÎãàÎã§. Í∞ïÎ†•Ìïú Î≥¥Ïä§Í∞Ä ÎÇòÌÉÄÎÇ¨ÏäµÎãàÎã§!'
                    },
                    {
                        character: 'boss',
                        name: 'Ïñ¥Îë†Ïùò Íµ∞Ï£º',
                        text: 'Ïò§ÎûúÎßåÏù¥Íµ∞... Ïù∏Í∞ÑÏù¥Ïó¨. Ïù¥Í≥≥ÏùÄ ÎÑ§Í∞Ä Ïò¨ Í≥≥Ïù¥ ÏïÑÎãàÎã§. ÎèåÏïÑÍ∞ÄÍ±∞Îùº!'
                    },
                    {
                        character: 'player',
                        name: 'ÌîåÎ†àÏù¥Ïñ¥',
                        text: 'Î¨ºÎü¨ÏÑúÏßÄ ÏïäÍ≤†Îã§. Ïù¥ ÏÑ∏Í≥ÑÎ•º Íµ¨ÌïòÍ∏∞ ÏúÑÌï¥ ÏôîÎã§!'
                    }
                ],

                battle: [
                    {
                        character: 'boss',
                        name: 'Ïñ¥Îë†Ïùò Íµ∞Ï£º',
                        text: 'Ïñ¥Î¶¨ÏÑùÏùÄ Í≤É... Í∑∏Î†áÎã§Î©¥ ÎÇ¥ ÌûòÏùÑ Î≥¥Ïó¨Ï£ºÎßà!'
                    },
                    {
                        character: 'narrator',
                        name: 'ÎÇòÎ†àÏù¥ÏÖò',
                        text: 'Ï†ÑÌà¨Í∞Ä ÏãúÏûëÎê©ÎãàÎã§! ÏùåÏÑ±ÏúºÎ°ú Ïä§ÌÇ¨ÏùÑ ÏãúÏ†ÑÌïòÏó¨ Î≥¥Ïä§Î•º Î¨ºÎ¶¨ÏπòÏÑ∏Ïöî.'
                    }
                ]
            }
        };

        // ÎåÄÌôî ÏãúÏûë
        function startDialogue(dialogueKey) {
            const dialogueData = dialogueSystem.sampleDialogues[dialogueKey];
            if (!dialogueData) return;

            dialogueSystem.isActive = true;
            dialogueSystem.currentDialogue = dialogueData;
            dialogueSystem.currentIndex = 0;

            document.getElementById('dialogueBox').style.display = 'block';
            showCurrentDialogue();
        }

        // ÌòÑÏû¨ ÎåÄÌôî ÌëúÏãú
        function showCurrentDialogue() {
            const dialogue = dialogueSystem.currentDialogue[dialogueSystem.currentIndex];
            const characterElement = document.querySelector('.dialogue-character');
            const portraitElement = document.getElementById('characterPortrait');
            const nameElement = document.getElementById('characterName');
            const typeElement = document.getElementById('characterType');
            const textElement = document.getElementById('dialogueText');
            const counterElement = document.getElementById('dialogueCounter');

            // Ï∫êÎ¶≠ÌÑ∞ Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
            characterElement.className = `dialogue-character ${dialogue.character}`;
            nameElement.textContent = dialogue.name;

            // Ï∫êÎ¶≠ÌÑ∞ ÌÉÄÏûÖÍ≥º Ìè¨Ìä∏Î†àÏù¥Ìä∏ ÏÑ§Ï†ï
            switch (dialogue.character) {
                case 'narrator':
                    typeElement.textContent = 'NARRATOR';
                    portraitElement.textContent = 'üìñ';
                    break;
                case 'player':
                    typeElement.textContent = 'PLAYER';
                    portraitElement.textContent = '‚öîÔ∏è';
                    break;
                case 'boss':
                    typeElement.textContent = 'BOSS';
                    portraitElement.textContent = 'üëπ';
                    break;
            }

            // ÏßÑÌñâÎèÑ ÏóÖÎç∞Ïù¥Ìä∏
            counterElement.textContent = `${dialogueSystem.currentIndex + 1} / ${dialogueSystem.currentDialogue.length}`;

            // ÌÉÄÏù¥Ìïë Ìö®Í≥ºÎ°ú ÌÖçÏä§Ìä∏ ÌëúÏãú
            typeText(dialogue.text, textElement);
        }

        // ÌÉÄÏù¥Ìïë Ìö®Í≥º
        function typeText(text, element) {
            dialogueSystem.isTyping = true;
            element.textContent = '';
            element.classList.add('typing');

            let i = 0;
            function typeCharacter() {
                if (i < text.length) {
                    element.textContent += text.charAt(i);
                    i++;
                    setTimeout(typeCharacter, dialogueSystem.typingSpeed);
                } else {
                    element.classList.remove('typing');
                    dialogueSystem.isTyping = false;
                }
            }

            typeCharacter();
        }

        // Îã§Ïùå ÎåÄÌôîÎ°ú ÏßÑÌñâ
        function nextDialogue() {
            if (!dialogueSystem.isActive) return;

            // ÌÉÄÏù¥Ìïë Ï§ëÏù¥Î©¥ Ï¶âÏãú ÏôÑÎ£å
            if (dialogueSystem.isTyping) {
                dialogueSystem.isTyping = false;
                const dialogue = dialogueSystem.currentDialogue[dialogueSystem.currentIndex];
                document.getElementById('dialogueText').textContent = dialogue.text;
                document.getElementById('dialogueText').classList.remove('typing');
                return;
            }

            // Îã§Ïùå ÎåÄÌôîÎ°ú ÏßÑÌñâ
            dialogueSystem.currentIndex++;

            if (dialogueSystem.currentIndex < dialogueSystem.currentDialogue.length) {
                showCurrentDialogue();
            } else {
                endDialogue();
            }
        }

        // ÎåÄÌôî Ï¢ÖÎ£å
        function endDialogue() {
            dialogueSystem.isActive = false;
            dialogueSystem.currentDialogue = null;
            dialogueSystem.currentIndex = 0;
            document.getElementById('dialogueBox').style.display = 'none';
        }

        // ÎåÄÌôî Í±¥ÎÑàÎõ∞Í∏∞
        function skipDialogue() {
            if (dialogueSystem.isActive) {
                endDialogue();
            }
        }

        // Î£¨ÏóÖÍ∑∏Î†àÏù¥Îìú Í¥ÄÎ†® Î≥ÄÏàò
        let runeCount = 50;

        function upgradeSkill(skillName, cost) {
            if (runeCount >= cost) {
                runeCount -= cost;
                document.getElementById('runeCount').textContent = runeCount;

                // ÏóÖÍ∑∏Î†àÏù¥Îìú Ìö®Í≥º ÌëúÏãú
                showUpgradeEffect(skillName);

                // Ìï¥Îãπ Ïä§ÌÇ¨ Ïπ¥Îìú ÏóÖÎç∞Ïù¥Ìä∏ (ÏÑ†ÌÉùÏÇ¨Ìï≠)
                console.log(`${skillName} Ïä§ÌÇ¨Ïù¥ ÏóÖÍ∑∏Î†àÏù¥ÎìúÎêòÏóàÏäµÎãàÎã§!`);
            } else {
                alert('Î£¨ÏÑùÏù¥ Î∂ÄÏ°±Ìï©ÎãàÎã§!');
            }
        }

        function showUpgradeEffect(skillName) {
            // Í∞ÑÎã®Ìïú ÏóÖÍ∑∏Î†àÏù¥Îìú Ìö®Í≥º Ïï†ÎãàÎ©îÏù¥ÏÖò
            const skillCard = document.querySelector(`[data-skill="${skillName}"]`);
            if (skillCard) {
                skillCard.style.transform = 'scale(1.05)';
                skillCard.style.boxShadow = '0 0 30px rgba(76, 175, 80, 0.8)';

                setTimeout(() => {
                    skillCard.style.transform = '';
                    skillCard.style.boxShadow = '';
                }, 500);
            }
        }
    </script>
</body>

</html>